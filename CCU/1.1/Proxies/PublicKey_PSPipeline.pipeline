<?xml version="1.0" encoding="UTF-8"?>
<con:pipelineEntry xmlns:con="http://www.bea.com/wli/sb/pipeline/config" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con2="http://www.bea.com/wli/sb/stages/config" xmlns:con3="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con4="http://www.bea.com/wli/sb/stages/routing/config">
    <con:coreEntry>
        <con:binding type="Native REST" xsi:type="con:NativeRestBindingType"/>
        <con:xqConfiguration>
            <con:snippetVersion>1.0</con:snippetVersion>
        </con:xqConfiguration>
    </con:coreEntry>
    <con:router>
        <con:pipeline type="request" name="request-N3f57c7ff.N5c6fea04.0.1645fca4632.N7e57" errorHandler="error-N3f57c7ff.N5c6fea04.0.1645fca4632.N7e4c">
            <con:stage id="_StageId-N3f57c7ff.N5c6fea04.0.1645fca4632.N7e56" name="RequÃªte_cancelPublicKey">
                <con:context/>
                <con:actions>
                    <con3:assign varName="currentDatetime" xmlns:con4="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con6="http://www.bea.com/wli/sb/services/security/config" xmlns:con5="http://www.bea.com/wli/sb/typesystem/config" xmlns:ser="http://www.bea.com/wli/sb/services" xmlns:env="http://www.bea.com/wli/config/env" xmlns:http="http://www.bea.com/wli/sb/transports/http" xmlns:oper="http://xmlns.oracle.com/servicebus/pipeline/operations" xmlns:tran="http://www.bea.com/wli/sb/transports" xmlns:con1="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config">
                        <con2:id>_ActionId-N3f57c7ff.N5c6fea04.0.1645fca4632.N7e55</con2:id>
                        <con3:expr>
                            <con2:xqueryText>&lt;a>{fn:current-dateTime()}&lt;/a></con2:xqueryText>
                        </con3:expr>
                    </con3:assign>
                    <con3:assign varName="msgId" xmlns:con4="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con6="http://www.bea.com/wli/sb/services/security/config" xmlns:con5="http://www.bea.com/wli/sb/typesystem/config" xmlns:ser="http://www.bea.com/wli/sb/services" xmlns:env="http://www.bea.com/wli/config/env" xmlns:http="http://www.bea.com/wli/sb/transports/http" xmlns:oper="http://xmlns.oracle.com/servicebus/pipeline/operations" xmlns:tran="http://www.bea.com/wli/sb/transports" xmlns:con1="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config">
                        <con2:id>_ActionId-N3f57c7ff.N5c6fea04.0.1645fca4632.N7e54</con2:id>
                        <con3:expr>
                            <con2:xqueryText>&lt;a>{$messageID}&lt;/a></con2:xqueryText>
                        </con3:expr>
                    </con3:assign>
                    <con3:javaScript xmlns:con4="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con1="http://www.bea.com/wli/sb/stages/routing/config" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config">
                        <con2:id>_ActionId-N3f57c7ff.N5c6fea04.0.1645fca4632.N7c22</con2:id>
                        <con3:script><![CDATA[var content = process.body;
if(content != 'undefined' && content != null && content){
	var id = content.id;
	var basket = content.basket;
	var defaultChannel = content.defaultChannel;
	if(id != 'undefined' && id != null && id)
		process.idJS = id;
	if(basket != 'undefined' && basket != null && basket){
		if(basket.length)
		basket = basket[0];
		var basketId = basket.id;
		if(basketId != 'undefined' && basketId != null && basketId){
			process.basketIdJS = basketId;
		}
	}
	if(defaultChannel != 'undefined' && defaultChannel != null && defaultChannel)
		process.defaultChannelJS = defaultChannel;
}]]></con3:script>
                    </con3:javaScript>
                    <con3:assign varName="id" xmlns:con1="http://www.bea.com/wli/sb/stages/routing/config" xmlns:con4="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config">
                        <con2:id>_ActionId-N3f57c7ff.N5c6fea04.0.1645fca4632.N7c1f</con2:id>
                        <con3:expr>
                            <con2:xqueryText>&lt;id>
{fn:replace($idJS,
';', 
'|\$/')}
&lt;/id></con2:xqueryText>
                        </con3:expr>
                    </con3:assign>
                    <con3:assign varName="basketId" xmlns:con1="http://www.bea.com/wli/sb/stages/routing/config" xmlns:con4="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config">
                        <con2:id>_ActionId-N3f57c7ff.N5c6fea04.0.1645fca4632.N7c1c</con2:id>
                        <con3:expr>
                            <con2:xqueryText>&lt;basketId>
{fn:replace($basketIdJS,
';', 
'|\$/')}
&lt;/basketId></con2:xqueryText>
                        </con3:expr>
                    </con3:assign>
                    <con3:assign varName="defaultChannel" xmlns:con1="http://www.bea.com/wli/sb/stages/routing/config" xmlns:con4="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config">
                        <con2:id>_ActionId-N3f57c7ff.N5c6fea04.0.1645fca4632.N7c19</con2:id>
                        <con3:expr>
                            <con2:xqueryText>&lt;defaultChannel>
{fn:replace($defaultChannelJS,
';', 
'|\$/')}
&lt;/defaultChannel></con2:xqueryText>
                        </con3:expr>
                    </con3:assign>
                    <con1:log xmlns:con4="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con3="http://www.bea.com/wli/sb/stages/routing/config" xmlns:con6="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con5="http://www.bea.com/wli/sb/typesystem/config" xmlns:ser="http://www.bea.com/wli/sb/services" xmlns:env="http://www.bea.com/wli/config/env" xmlns:http="http://www.bea.com/wli/sb/transports/http" xmlns:oper="http://xmlns.oracle.com/servicebus/pipeline/operations" xmlns:tran="http://www.bea.com/wli/sb/transports" xmlns:con1="http://www.bea.com/wli/sb/stages/logging/config">
                        <con2:id>_ActionId-N3f57c7ff.N5c6fea04.0.1645fca4632.N7e51</con2:id>
                        <con1:logLevel>info</con1:logLevel>
                        <con1:expr>
                            <con2:xqueryText>&lt;root>
&lt;log>
{fn:concat(
data($msgId), '|$/', 
data($currentDatetime), '|$/', 
if($inbound/ctx:transport/ctx:request/tp:headers/tp:user-header[@name="X-Forwarded-For"])
then
($inbound/ctx:transport/ctx:request/tp:headers/tp:user-header[@name="X-Forwarded-For"]/@value)
else
($inbound/ctx:transport/ctx:request/http:client-address), '|$/', 
$inbound/@name,'|$/',
if($inbound/ctx:service/ctx:operation) 
then ($inbound/ctx:service/ctx:operation)
else (fn:concat($inbound/ctx:transport/ctx:request/http:http-method,' ',$inbound/ctx:transport/ctx:uri)), '|$/',
'id=',fn:replace($id,'\|\$\/',';'),
',basketId=',fn:replace($basketId,'\|\$\/',';'),
',defaultChannel=',fn:replace($defaultChannel,'\|\$\/',';')
)}
&lt;/log>
{$body}
&lt;/root></con2:xqueryText>
                        </con1:expr>
                        <con1:message>[Orange][CCU][1.1][PublicKey_PS][cancel][Entry]</con1:message>
                    </con1:log>
                    <con1:report xmlns:con4="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con3="http://www.bea.com/wli/sb/stages/routing/config" xmlns:con6="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con5="http://www.bea.com/wli/sb/typesystem/config" xmlns:ser="http://www.bea.com/wli/sb/services" xmlns:env="http://www.bea.com/wli/config/env" xmlns:http="http://www.bea.com/wli/sb/transports/http" xmlns:oper="http://xmlns.oracle.com/servicebus/pipeline/operations" xmlns:tran="http://www.bea.com/wli/sb/transports" xmlns:con1="http://www.bea.com/wli/sb/stages/logging/config">
                        <con2:id>_ActionId-N3f57c7ff.N5c6fea04.0.1645fca4632.N7e50</con2:id>
                        <con1:expr>
                            <con2:xqueryText>&lt;ReportRequest>
{$body}
&lt;/ReportRequest></con2:xqueryText>
                        </con1:expr>
                        <con1:labels>
                            <con1:key>messageId</con1:key>
                            <con1:varName>msgId</con1:varName>
                            <con1:value>
                                <con2:xpathText>.</con2:xpathText>
                            </con1:value>
                        </con1:labels>
                        <con1:labels>
                            <con1:key>startDateTime</con1:key>
                            <con1:varName>currentDatetime</con1:varName>
                            <con1:value>
                                <con2:xpathText>.</con2:xpathText>
                            </con1:value>
                        </con1:labels>
                        <con1:labels>
                            <con1:key>ipXForwardedFor</con1:key>
                            <con1:varName>inbound</con1:varName>
                            <con1:value>
                                <con2:xpathText>if(./ctx:transport/ctx:request/tp:headers/tp:user-header[@name="X-Forwarded-For"])
then
(./ctx:transport/ctx:request/tp:headers/tp:user-header[@name="X-Forwarded-For"]/@value)
else
(./ctx:transport/ctx:request/http:client-address)</con2:xpathText>
                            </con1:value>
                        </con1:labels>
                        <con1:labels>
                            <con1:key>operationName</con1:key>
                            <con1:varName>inbound</con1:varName>
                            <con1:value>
                                <con2:xpathText>if(./ctx:service/ctx:operation) 
then (./ctx:service/ctx:operation)
else (./ctx:transport/ctx:request/http:http-method)</con2:xpathText>
                            </con1:value>
                        </con1:labels>
                        <con1:labels>
                            <con1:key>id</con1:key>
                            <con1:varName>id</con1:varName>
                            <con1:value>
                                <con2:xpathText>.</con2:xpathText>
                            </con1:value>
                        </con1:labels>
                        <con1:labels>
                            <con1:key>basketId</con1:key>
                            <con1:varName>basketId</con1:varName>
                            <con1:value>
                                <con2:xpathText>.</con2:xpathText>
                            </con1:value>
                        </con1:labels>
                        <con1:labels>
                            <con1:key>defaultChannel</con1:key>
                            <con1:varName>defaultChannel</con1:varName>
                            <con1:value>
                                <con2:xpathText>.</con2:xpathText>
                            </con1:value>
                        </con1:labels>
                    </con1:report>
                    <con1:nxsdTranslation>
                        <con2:id>_ActionId-N53efef3d.3f35d53b.0.16b88fa0ffb.N7d47</con2:id>
                        <con1:type>Native-To-XML</con1:type>
                        <con1:sourceExpr>
                            <con2:xqueryText>data($body)</con2:xqueryText>
                        </con1:sourceExpr>
                        <con1:nxsd ref="CCU/Resources/nXSDs/PublicKey/api_YAML"/>
                        <con1:schemaElement xmlns:rest="http://orange.com/OrangeMaroc_APIs/api/publicKey/v0/model/rest">rest:cancelConstraints</con1:schemaElement>
                        <con1:replace-body-content/>
                    </con1:nxsdTranslation>
                    <con3:log>
                        <con2:id>_ActionId-N53efef3d.3f35d53b.0.16b88fa0ffb.N7d43</con2:id>
                        <con3:logLevel>info</con3:logLevel>
                        <con3:expr>
                            <con2:xqueryText>&lt;root>
&lt;log>
{fn:concat(
data($msgId), '|$/', 
fn:current-dateTime(), '|$/', 
if($inbound/ctx:transport/ctx:request/tp:headers/tp:user-header[@name="X-Forwarded-For"])
then
($inbound/ctx:transport/ctx:request/tp:headers/tp:user-header[@name="X-Forwarded-For"]/@value)
else
($inbound/ctx:transport/ctx:request/http:client-address), '|$/', 
$inbound/@name,'|$/',
if($inbound/ctx:service/ctx:operation) 
then ($inbound/ctx:service/ctx:operation)
else (fn:concat($inbound/ctx:transport/ctx:request/http:http-method,' ',$inbound/ctx:transport/ctx:uri)), '|$/',
'id=',fn:replace($id,'\|\$\/',';'),
',basketId=',fn:replace($basketId,'\|\$\/',';'),
',defaultChannel=',fn:replace($defaultChannel,'\|\$\/',';')
)}
&lt;/log>
{$body}
&lt;/root></con2:xqueryText>
                        </con3:expr>
                        <con3:message>[Orange][CCU][1.1][PublicKey_PS][cancel][Request][Body after translation]</con3:message>
                    </con3:log>
                    <con1:replace contents-only="true" varName="body">
                        <con2:id>_ActionId-N53efef3d.3f35d53b.0.16b88fa0ffb.N7d40</con2:id>
                        <con1:expr>
                            <con2:xqueryTransform>
                                <con2:resource ref="CCU/1.1/Resources/XQueries/PublicKey/PublicKeyCancel_TReq"/>
                                <con2:param name="req">
                                    <con2:path>$body/*</con2:path>
                                </con2:param>
                            </con2:xqueryTransform>
                        </con1:expr>
                    </con1:replace>
                    <con3:log>
                        <con2:id>_ActionId-N53efef3d.3f35d53b.0.16b88fa0ffb.N7d3d</con2:id>
                        <con3:logLevel>info</con3:logLevel>
                        <con3:expr>
                            <con2:xqueryText>&lt;root>
&lt;log>
{fn:concat(
data($msgId), '|$/', 
fn:current-dateTime(), '|$/', 
if($inbound/ctx:transport/ctx:request/tp:headers/tp:user-header[@name="X-Forwarded-For"])
then
($inbound/ctx:transport/ctx:request/tp:headers/tp:user-header[@name="X-Forwarded-For"]/@value)
else
($inbound/ctx:transport/ctx:request/http:client-address), '|$/', 
$inbound/@name,'|$/',
if($inbound/ctx:service/ctx:operation) 
then ($inbound/ctx:service/ctx:operation)
else (fn:concat($inbound/ctx:transport/ctx:request/http:http-method,' ',$inbound/ctx:transport/ctx:uri)), '|$/',
'id=',fn:replace($id,'\|\$\/',';'),
',basketId=',fn:replace($basketId,'\|\$\/',';'),
',defaultChannel=',fn:replace($defaultChannel,'\|\$\/',';')
)}
&lt;/log>
{$body}
&lt;/root></con2:xqueryText>
                        </con3:expr>
                        <con3:message>[Orange][CCU][1.1][PublicKey_PS][cancel][Request][Body after transformation]</con3:message>
                    </con3:log>
                </con:actions>
            </con:stage>
        </con:pipeline>
        <con:pipeline type="error" name="error-N53efef3d.3f35d53b.0.16b88fa0ffb.N7e14">
            <con:stage id="_StageId-N53efef3d.3f35d53b.0.16b88fa0ffb.N7d61" name="InvocationProblem_reservePublicKey">
                <con:context/>
                <con:actions>
                    <con3:assign varName="currentDatetime" xmlns:con1="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con4="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con6="http://www.bea.com/wli/sb/services/security/config" xmlns:con5="http://www.bea.com/wli/sb/typesystem/config" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config" xmlns:ser="http://www.bea.com/wli/sb/services" xmlns:env="http://www.bea.com/wli/config/env" xmlns:http="http://www.bea.com/wli/sb/transports/http" xmlns:oper="http://xmlns.oracle.com/servicebus/pipeline/operations" xmlns:tran="http://www.bea.com/wli/sb/transports">
                        <con2:id>_ActionId-N53efef3d.3f35d53b.0.16b88fa0ffb.N7d60</con2:id>
                        <con3:expr>
                            <con2:xqueryText>&lt;a>{fn:current-dateTime()}&lt;/a></con2:xqueryText>
                        </con3:expr>
                    </con3:assign>
                    <con7:log xmlns:con6="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con2="http://www.bea.com/wli/sb/stages/routing/config" xmlns:con3="http://www.bea.com/wli/sb/stages/config" xmlns:con7="http://www.bea.com/wli/sb/stages/logging/config" xmlns:aler="http://www.bea.com/wli/monitoring/alert" xmlns:ser="http://www.bea.com/wli/sb/services" xmlns:env="http://www.bea.com/wli/config/env" xmlns:http="http://www.bea.com/wli/sb/transports/http" xmlns:oper="http://xmlns.oracle.com/servicebus/pipeline/operations" xmlns:con5="http://www.bea.com/wli/sb/stages/alert/config" xmlns:tran="http://www.bea.com/wli/sb/transports">
                        <con3:id>_ActionId-N53efef3d.3f35d53b.0.16b88fa0ffb.N7d5f</con3:id>
                        <con6:logLevel>error</con6:logLevel>
                        <con6:expr>
                            <con3:xqueryText>&lt;root>
&lt;log>
{fn:concat(
data($msgId), '|$/', 
data($currentDatetime), '|$/', 
if($inbound/ctx:transport/ctx:request/tp:headers/tp:user-header[@name="X-Forwarded-For"])
then
($inbound/ctx:transport/ctx:request/tp:headers/tp:user-header[@name="X-Forwarded-For"]/@value)
else
($inbound/ctx:transport/ctx:request/http:client-address), '|$/', 
$inbound/@name,'|$/',
if($inbound/ctx:service/ctx:operation) 
then ($inbound/ctx:service/ctx:operation)
else (fn:concat($inbound/ctx:transport/ctx:request/http:http-method,' ',$inbound/ctx:transport/ctx:uri)), '|$/',
'id=',fn:replace($id,'\|\$\/',';'),
',basketId=',fn:replace($basketId,'\|\$\/',';'),
',defaultChannel=',fn:replace($defaultChannel,'\|\$\/',';')
)}
&lt;/log>
{$fault}
&lt;/root></con3:xqueryText>
                        </con6:expr>
                        <con6:message>[Orange][CCU][1.1][PublicKey_PS][reserve][Invocation][Fault]</con6:message>
                    </con7:log>
                    <con6:assign varName="ErrorTrace" xmlns:con2="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con1="http://www.bea.com/wli/sb/stages/config" xmlns:con4="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config" xmlns:ser="http://www.bea.com/wli/sb/services" xmlns:env="http://www.bea.com/wli/config/env" xmlns:http="http://www.bea.com/wli/sb/transports/http" xmlns:con6="http://www.bea.com/wli/sb/stages/transform/config" xmlns:oper="http://xmlns.oracle.com/servicebus/pipeline/operations" xmlns:con5="http://www.bea.com/wli/sb/stages/alert/config" xmlns:tran="http://www.bea.com/wli/sb/transports">
                        <con1:id>_ActionId-N53efef3d.3f35d53b.0.16b88fa0ffb.N7d5e</con1:id>
                        <con3:expr>
                            <con1:xqueryText><![CDATA[<soap-env:Fault>
         <faultcode>{fn:concat($fault/ctx:errorCode/text(), ' ', $body/soap-env:Fault/faultcode/text())}</faultcode>
         <faultstring>{fn:concat($body/soap-env:Fault/faultstring/text(), ' ' , $fault/ctx:reason/text())}</faultstring>
         <detail>
			{$body/soap-env:Fault/detail/*} { $fault/ctx:location}
         </detail>
</soap-env:Fault>]]></con1:xqueryText>
                        </con3:expr>
                    </con6:assign>
                    <con7:log xmlns:con6="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con2="http://www.bea.com/wli/sb/stages/routing/config" xmlns:con3="http://www.bea.com/wli/sb/stages/config" xmlns:con7="http://www.bea.com/wli/sb/stages/logging/config" xmlns:aler="http://www.bea.com/wli/monitoring/alert" xmlns:ser="http://www.bea.com/wli/sb/services" xmlns:env="http://www.bea.com/wli/config/env" xmlns:http="http://www.bea.com/wli/sb/transports/http" xmlns:oper="http://xmlns.oracle.com/servicebus/pipeline/operations" xmlns:con5="http://www.bea.com/wli/sb/stages/alert/config" xmlns:tran="http://www.bea.com/wli/sb/transports">
                        <con3:id>_ActionId-N53efef3d.3f35d53b.0.16b88fa0ffb.N7d5d</con3:id>
                        <con6:logLevel>error</con6:logLevel>
                        <con6:expr>
                            <con3:xqueryText>&lt;root>
&lt;log>
{fn:concat(
data($msgId), '|$/', 
fn:current-dateTime(), '|$/', 
if($inbound/ctx:transport/ctx:request/tp:headers/tp:user-header[@name="X-Forwarded-For"])
then
($inbound/ctx:transport/ctx:request/tp:headers/tp:user-header[@name="X-Forwarded-For"]/@value)
else
($inbound/ctx:transport/ctx:request/http:client-address), '|$/', 
$inbound/@name,'|$/',
if($inbound/ctx:service/ctx:operation) 
then ($inbound/ctx:service/ctx:operation)
else (fn:concat($inbound/ctx:transport/ctx:request/http:http-method,' ',$inbound/ctx:transport/ctx:uri)), '|$/',
'id=',fn:replace($id,'\|\$\/',';'),
',basketId=',fn:replace($basketId,'\|\$\/',';'),
',defaultChannel=',fn:replace($defaultChannel,'\|\$\/',';')
)}
&lt;/log>
{$ErrorTrace}
&lt;/root></con3:xqueryText>
                        </con6:expr>
                        <con6:message>[Orange][CCU][1.1][PublicKey_PS][reserve][Invocation][ErrorTrace]</con6:message>
                    </con7:log>
                    <con5:alert xmlns:con2="http://www.bea.com/wli/sb/stages/routing/config" xmlns:con1="http://www.bea.com/wli/sb/stages/config" xmlns:con4="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config" xmlns:ser="http://www.bea.com/wli/sb/services" xmlns:env="http://www.bea.com/wli/config/env" xmlns:http="http://www.bea.com/wli/sb/transports/http" xmlns:con6="http://www.bea.com/wli/sb/stages/transform/config" xmlns:oper="http://xmlns.oracle.com/servicebus/pipeline/operations" xmlns:con5="http://www.bea.com/wli/sb/stages/alert/config" xmlns:tran="http://www.bea.com/wli/sb/transports">
                        <con1:id>_ActionId-N53efef3d.3f35d53b.0.16b88fa0ffb.N7d5c</con1:id>
                        <con5:destination ref="Common/Resources/Alerts/Echange_AD"/>
                        <con5:description>[Orange][CCU][1.1][PublicKey_PS][reserve][Invocation][ErrorTrace]</con5:description>
                        <con5:severity>critical</con5:severity>
                        <con5:payload>
                            <con1:xqueryText>$ErrorTrace</con1:xqueryText>
                        </con5:payload>
                    </con5:alert>
                    <con1:report xmlns:con4="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con3="http://www.bea.com/wli/sb/stages/routing/config" xmlns:con6="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con5="http://www.bea.com/wli/sb/typesystem/config" xmlns:con1="http://www.bea.com/wli/sb/stages/logging/config" xmlns:ser="http://www.bea.com/wli/sb/services" xmlns:env="http://www.bea.com/wli/config/env" xmlns:http="http://www.bea.com/wli/sb/transports/http" xmlns:oper="http://xmlns.oracle.com/servicebus/pipeline/operations" xmlns:tran="http://www.bea.com/wli/sb/transports">
                        <con2:id>_ActionId-N53efef3d.3f35d53b.0.16b88fa0ffb.N7d5b</con2:id>
                        <con1:expr>
                            <con2:xqueryText>&lt;ReportInvocationError>
{$ErrorTrace}
&lt;/ReportInvocationError></con2:xqueryText>
                        </con1:expr>
                        <con1:labels>
                            <con1:key>messageId</con1:key>
                            <con1:varName>msgId</con1:varName>
                            <con1:value>
                                <con2:xpathText>.</con2:xpathText>
                            </con1:value>
                        </con1:labels>
                        <con1:labels>
                            <con1:key>startDateTime</con1:key>
                            <con1:varName>currentDatetime</con1:varName>
                            <con1:value>
                                <con2:xpathText>.</con2:xpathText>
                            </con1:value>
                        </con1:labels>
                        <con1:labels>
                            <con1:key>ipXForwardedFor</con1:key>
                            <con1:varName>inbound</con1:varName>
                            <con1:value>
                                <con2:xpathText>if(./ctx:transport/ctx:request/tp:headers/tp:user-header[@name="X-Forwarded-For"])
then
(./ctx:transport/ctx:request/tp:headers/tp:user-header[@name="X-Forwarded-For"]/@value)
else
(./ctx:transport/ctx:request/http:client-address)</con2:xpathText>
                            </con1:value>
                        </con1:labels>
                        <con1:labels>
                            <con1:key>operationName</con1:key>
                            <con1:varName>inbound</con1:varName>
                            <con1:value>
                                <con2:xpathText>if(./ctx:service/ctx:operation) 
then (./ctx:service/ctx:operation)
else (./ctx:transport/ctx:request/http:http-method)</con2:xpathText>
                            </con1:value>
                        </con1:labels>
                        <con1:labels>
                            <con1:key>id</con1:key>
                            <con1:varName>id</con1:varName>
                            <con1:value>
                                <con2:xpathText>.</con2:xpathText>
                            </con1:value>
                        </con1:labels>
                        <con1:labels>
                            <con1:key>basketId</con1:key>
                            <con1:varName>basketId</con1:varName>
                            <con1:value>
                                <con2:xpathText>.</con2:xpathText>
                            </con1:value>
                        </con1:labels>
                        <con1:labels>
                            <con1:key>defaultChannel</con1:key>
                            <con1:varName>defaultChannel</con1:varName>
                            <con1:value>
                                <con2:xpathText>.</con2:xpathText>
                            </con1:value>
                        </con1:labels>
                    </con1:report>
                    <con6:replace varName="body" contents-only="true" xmlns:con1="http://www.bea.com/wli/sb/stages/routing/config" xmlns:con4="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config" xmlns:ser="http://www.bea.com/wli/sb/services" xmlns:env="http://www.bea.com/wli/config/env" xmlns:http="http://www.bea.com/wli/sb/transports/http" xmlns:con6="http://www.bea.com/wli/sb/stages/transform/config" xmlns:oper="http://xmlns.oracle.com/servicebus/pipeline/operations" xmlns:con5="http://www.bea.com/wli/sb/stages/alert/config" xmlns:tran="http://www.bea.com/wli/sb/transports">
                        <con2:id>_ActionId-N53efef3d.3f35d53b.0.16b88fa0ffb.N7d5a</con2:id>
                        <con3:location>
                            <con2:xpathText>.</con2:xpathText>
                        </con3:location>
                        <con3:expr>
                            <con2:xqueryText>'{
	"code": "12501",
        "message": "Invocation problem",
	"infoURL": "",
	"description": ""
}'</con2:xqueryText>
                        </con3:expr>
                    </con6:replace>
                    <con6:transport-headers xmlns:con1="http://www.bea.com/wli/sb/stages/routing/config" xmlns:con4="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config" xmlns:ser="http://www.bea.com/wli/sb/services" xmlns:env="http://www.bea.com/wli/config/env" xmlns:http="http://www.bea.com/wli/sb/transports/http" xmlns:con6="http://www.bea.com/wli/sb/stages/transform/config" xmlns:oper="http://xmlns.oracle.com/servicebus/pipeline/operations" xmlns:con5="http://www.bea.com/wli/sb/stages/alert/config" xmlns:tran="http://www.bea.com/wli/sb/transports">
                        <con2:id>_ActionId-N53efef3d.3f35d53b.0.16b88fa0ffb.N7d59</con2:id>
                        <con3:header-set>inbound-response</con3:header-set>
                        <con3:header name="Content-Type" value="expression">
                            <con2:xqueryText>'application/json; charset=utf-8'</con2:xqueryText>
                        </con3:header>
                    </con6:transport-headers>
                    <con7:log xmlns:con6="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con2="http://www.bea.com/wli/sb/stages/routing/config" xmlns:con3="http://www.bea.com/wli/sb/stages/config" xmlns:con7="http://www.bea.com/wli/sb/stages/logging/config" xmlns:aler="http://www.bea.com/wli/monitoring/alert" xmlns:ser="http://www.bea.com/wli/sb/services" xmlns:env="http://www.bea.com/wli/config/env" xmlns:http="http://www.bea.com/wli/sb/transports/http" xmlns:oper="http://xmlns.oracle.com/servicebus/pipeline/operations" xmlns:con5="http://www.bea.com/wli/sb/stages/alert/config" xmlns:tran="http://www.bea.com/wli/sb/transports">
                        <con3:id>_ActionId-N53efef3d.3f35d53b.0.16b88fa0ffb.N7d58</con3:id>
                        <con6:logLevel>error</con6:logLevel>
                        <con6:expr>
                            <con3:xqueryText>&lt;root>
&lt;log>
{fn:concat(
data($msgId), '|$/', 
fn:current-dateTime(), '|$/', 
if($inbound/ctx:transport/ctx:request/tp:headers/tp:user-header[@name="X-Forwarded-For"])
then
($inbound/ctx:transport/ctx:request/tp:headers/tp:user-header[@name="X-Forwarded-For"]/@value)
else
($inbound/ctx:transport/ctx:request/http:client-address), '|$/', 
$inbound/@name,'|$/',
if($inbound/ctx:service/ctx:operation) 
then ($inbound/ctx:service/ctx:operation)
else (fn:concat($inbound/ctx:transport/ctx:request/http:http-method,' ',$inbound/ctx:transport/ctx:uri)), '|$/',
'id=',fn:replace($id,'\|\$\/',';'),
',basketId=',fn:replace($basketId,'\|\$\/',';'),
',defaultChannel=',fn:replace($defaultChannel,'\|\$\/',';')
)}
&lt;/log>
{$body}
&lt;/root></con3:xqueryText>
                        </con6:expr>
                        <con6:message>[Orange][CCU][1.1][PublicKey_PS][reserve][Invocation][Fault][Body after transformation]</con6:message>
                    </con7:log>
                    <con1:reply isError="true" xmlns:con2="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con1="http://www.bea.com/wli/sb/stages/config" xmlns:con4="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config" xmlns:ser="http://www.bea.com/wli/sb/services" xmlns:env="http://www.bea.com/wli/config/env" xmlns:http="http://www.bea.com/wli/sb/transports/http" xmlns:con6="http://www.bea.com/wli/sb/stages/transform/config" xmlns:oper="http://xmlns.oracle.com/servicebus/pipeline/operations" xmlns:con5="http://www.bea.com/wli/sb/stages/alert/config" xmlns:tran="http://www.bea.com/wli/sb/transports">
                        <con1:id>_ActionId-N53efef3d.3f35d53b.0.16b88fa0ffb.N7d57</con1:id>
                    </con1:reply>
                </con:actions>
            </con:stage>
        </con:pipeline>
        <con:pipeline type="error" name="error-N53efef3d.3f35d53b.0.16b88fa0ffb.N7e8a">
            <con:stage name="ResponseProblem_reservePublicKey" id="_StageId-N53efef3d.3f35d53b.0.16b88fa0ffb.N7e89" xmlns:ser="http://www.bea.com/wli/sb/services" xmlns:con1="http://www.bea.com/wli/sb/stages/routing/config" xmlns:http="http://www.bea.com/wli/sb/transports/http" xmlns:oper="http://xmlns.oracle.com/servicebus/pipeline/operations" xmlns:env="http://www.bea.com/wli/config/env" xmlns:con4="http://www.bea.com/wli/sb/stages/logging/config" xmlns:tran="http://www.bea.com/wli/sb/transports" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config">
                <con:context/>
                <con:actions>
                    <con4:assign varName="currentDatetime" xmlns:con1="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con4="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con6="http://www.bea.com/wli/sb/services/security/config" xmlns:con5="http://www.bea.com/wli/sb/typesystem/config">
                        <con2:id>_ActionId-N53efef3d.3f35d53b.0.16b88fa0ffb.N7e88</con2:id>
                        <con3:expr>
                            <con2:xqueryText>&lt;a>{fn:current-dateTime()}&lt;/a></con2:xqueryText>
                        </con3:expr>
                    </con4:assign>
                    <con6:log xmlns:con6="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con5="http://www.bea.com/wli/sb/stages/alert/config" xmlns:con2="http://www.bea.com/wli/sb/stages/routing/config" xmlns:con3="http://www.bea.com/wli/sb/stages/config" xmlns:con7="http://www.bea.com/wli/sb/stages/logging/config" xmlns:aler="http://www.bea.com/wli/monitoring/alert" xmlns:con4="http://www.bea.com/wli/sb/stages/routing/config">
                        <con3:id>_ActionId-N53efef3d.3f35d53b.0.16b88fa0ffb.N7e87</con3:id>
                        <con6:logLevel>error</con6:logLevel>
                        <con6:expr>
                            <con3:xqueryText>&lt;root>
&lt;log>
{fn:concat(
data($msgId), '|$/', 
data($currentDatetime), '|$/', 
if($inbound/ctx:transport/ctx:request/tp:headers/tp:user-header[@name="X-Forwarded-For"])
then
($inbound/ctx:transport/ctx:request/tp:headers/tp:user-header[@name="X-Forwarded-For"]/@value)
else
($inbound/ctx:transport/ctx:request/http:client-address), '|$/', 
$inbound/@name,'|$/',
if($inbound/ctx:service/ctx:operation) 
then ($inbound/ctx:service/ctx:operation)
else (fn:concat($inbound/ctx:transport/ctx:request/http:http-method,' ',$inbound/ctx:transport/ctx:uri)), '|$/',
'id=',fn:replace($id,'\|\$\/',';'),
',basketId=',fn:replace($basketId,'\|\$\/',';'),
',defaultChannel=',fn:replace($defaultChannel,'\|\$\/',';')
)}
&lt;/log>
{$fault}
&lt;/root></con3:xqueryText>
                        </con6:expr>
                        <con6:message>[Orange][CCU][1.1][PublicKey_PS][reserve][Response][Fault]</con6:message>
                    </con6:log>
                    <con3:assign varName="ErrorTrace" xmlns:con2="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con1="http://www.bea.com/wli/sb/stages/config">
                        <con1:id>_ActionId-N53efef3d.3f35d53b.0.16b88fa0ffb.N7e86</con1:id>
                        <con3:expr>
                            <con1:xqueryText><![CDATA[<soap-env:Fault>
         <faultcode>{fn:concat($fault/ctx:errorCode/text(), ' ', $body/soap-env:Fault/faultcode/text())}</faultcode>
         <faultstring>{fn:concat($body/soap-env:Fault/faultstring/text(), ' ' , $fault/ctx:reason/text())}</faultstring>
         <detail>
			{$body/soap-env:Fault/detail/*} { $fault/ctx:location}
         </detail>
</soap-env:Fault>]]></con1:xqueryText>
                        </con3:expr>
                    </con3:assign>
                    <con6:log xmlns:con6="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con5="http://www.bea.com/wli/sb/stages/alert/config" xmlns:con2="http://www.bea.com/wli/sb/stages/routing/config" xmlns:con3="http://www.bea.com/wli/sb/stages/config" xmlns:con7="http://www.bea.com/wli/sb/stages/logging/config" xmlns:aler="http://www.bea.com/wli/monitoring/alert" xmlns:con4="http://www.bea.com/wli/sb/stages/routing/config">
                        <con3:id>_ActionId-N53efef3d.3f35d53b.0.16b88fa0ffb.N7e85</con3:id>
                        <con6:logLevel>error</con6:logLevel>
                        <con6:expr>
                            <con3:xqueryText>&lt;root>
&lt;log>
{fn:concat(
data($msgId), '|$/', 
fn:current-dateTime(), '|$/', 
if($inbound/ctx:transport/ctx:request/tp:headers/tp:user-header[@name="X-Forwarded-For"])
then
($inbound/ctx:transport/ctx:request/tp:headers/tp:user-header[@name="X-Forwarded-For"]/@value)
else
($inbound/ctx:transport/ctx:request/http:client-address), '|$/', 
$inbound/@name,'|$/',
if($inbound/ctx:service/ctx:operation) 
then ($inbound/ctx:service/ctx:operation)
else (fn:concat($inbound/ctx:transport/ctx:request/http:http-method,' ',$inbound/ctx:transport/ctx:uri)), '|$/',
'id=',fn:replace($id,'\|\$\/',';'),
',basketId=',fn:replace($basketId,'\|\$\/',';'),
',defaultChannel=',fn:replace($defaultChannel,'\|\$\/',';')
)}
&lt;/log>
{$ErrorTrace}
&lt;/root></con3:xqueryText>
                        </con6:expr>
                        <con6:message>[Orange][CCU][1.1][PublicKey_PS][reserve][Response][ErrorTrace]</con6:message>
                    </con6:log>
                    <con5:alert xmlns:con2="http://www.bea.com/wli/sb/stages/routing/config" xmlns:con5="http://www.bea.com/wli/sb/stages/alert/config" xmlns:con1="http://www.bea.com/wli/sb/stages/config">
                        <con1:id>_ActionId-N53efef3d.3f35d53b.0.16b88fa0ffb.N7e84</con1:id>
                        <con5:destination ref="Common/Resources/Alerts/Echange_AD"/>
                        <con5:description>[Orange][CCU][1.1][PublicKey_PS][reserve][Response][ErrorTrace]</con5:description>
                        <con5:severity>critical</con5:severity>
                        <con5:payload>
                            <con1:xqueryText>$ErrorTrace</con1:xqueryText>
                        </con5:payload>
                    </con5:alert>
                    <con1:report xmlns:con4="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con3="http://www.bea.com/wli/sb/stages/routing/config" xmlns:con6="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con5="http://www.bea.com/wli/sb/typesystem/config" xmlns:con1="http://www.bea.com/wli/sb/stages/logging/config">
                        <con2:id>_ActionId-N53efef3d.3f35d53b.0.16b88fa0ffb.N7e83</con2:id>
                        <con1:expr>
                            <con2:xqueryText>&lt;ReportResponseError>
{$ErrorTrace}
&lt;/ReportResponseError></con2:xqueryText>
                        </con1:expr>
                        <con1:labels>
                            <con1:key>messageId</con1:key>
                            <con1:varName>msgId</con1:varName>
                            <con1:value>
                                <con2:xpathText>.</con2:xpathText>
                            </con1:value>
                        </con1:labels>
                        <con1:labels>
                            <con1:key>startDateTime</con1:key>
                            <con1:varName>currentDatetime</con1:varName>
                            <con1:value>
                                <con2:xpathText>.</con2:xpathText>
                            </con1:value>
                        </con1:labels>
                        <con1:labels>
                            <con1:key>ipXForwardedFor</con1:key>
                            <con1:varName>inbound</con1:varName>
                            <con1:value>
                                <con2:xpathText>if(./ctx:transport/ctx:request/tp:headers/tp:user-header[@name="X-Forwarded-For"])
then
(./ctx:transport/ctx:request/tp:headers/tp:user-header[@name="X-Forwarded-For"]/@value)
else
(./ctx:transport/ctx:request/http:client-address)</con2:xpathText>
                            </con1:value>
                        </con1:labels>
                        <con1:labels>
                            <con1:key>operationName</con1:key>
                            <con1:varName>inbound</con1:varName>
                            <con1:value>
                                <con2:xpathText>if(./ctx:service/ctx:operation) 
then (./ctx:service/ctx:operation)
else (./ctx:transport/ctx:request/http:http-method)</con2:xpathText>
                            </con1:value>
                        </con1:labels>
                        <con1:labels>
                            <con1:key>id</con1:key>
                            <con1:varName>id</con1:varName>
                            <con1:value>
                                <con2:xpathText>.</con2:xpathText>
                            </con1:value>
                        </con1:labels>
                        <con1:labels>
                            <con1:key>basketId</con1:key>
                            <con1:varName>basketId</con1:varName>
                            <con1:value>
                                <con2:xpathText>.</con2:xpathText>
                            </con1:value>
                        </con1:labels>
                        <con1:labels>
                            <con1:key>defaultChannel</con1:key>
                            <con1:varName>defaultChannel</con1:varName>
                            <con1:value>
                                <con2:xpathText>.</con2:xpathText>
                            </con1:value>
                        </con1:labels>
                    </con1:report>
                    <con3:replace varName="body" contents-only="true" xmlns:con2="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con1="http://www.bea.com/wli/sb/stages/config">
                        <con1:id>_ActionId-N53efef3d.3f35d53b.0.16b88fa0ffb.N7e82</con1:id>
                        <con3:location>
                            <con1:xpathText>.</con1:xpathText>
                        </con3:location>
                        <con3:expr>
                            <con1:xqueryText>'{
	"code": "12508",
        "message": "Response Problem",
	"infoURL": "",
	"description": ""
}'</con1:xqueryText>
                        </con3:expr>
                    </con3:replace>
                    <con3:transport-headers>
                        <con2:id>_ActionId-N53efef3d.3f35d53b.0.16b88fa0ffb.N7e81</con2:id>
                        <con3:header-set>inbound-response</con3:header-set>
                        <con3:header name="Content-Type" value="expression">
                            <con2:xqueryText>'application/json; charset=utf-8'</con2:xqueryText>
                        </con3:header>
                    </con3:transport-headers>
                    <con6:log xmlns:con6="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con5="http://www.bea.com/wli/sb/stages/alert/config" xmlns:con2="http://www.bea.com/wli/sb/stages/routing/config" xmlns:con3="http://www.bea.com/wli/sb/stages/config" xmlns:con7="http://www.bea.com/wli/sb/stages/logging/config" xmlns:aler="http://www.bea.com/wli/monitoring/alert" xmlns:con4="http://www.bea.com/wli/sb/stages/routing/config">
                        <con3:id>_ActionId-N53efef3d.3f35d53b.0.16b88fa0ffb.N7e80</con3:id>
                        <con6:logLevel>error</con6:logLevel>
                        <con6:expr>
                            <con3:xqueryText>&lt;root>
&lt;log>
{fn:concat(
data($msgId), '|$/', 
fn:current-dateTime(), '|$/', 
if($inbound/ctx:transport/ctx:request/tp:headers/tp:user-header[@name="X-Forwarded-For"])
then
($inbound/ctx:transport/ctx:request/tp:headers/tp:user-header[@name="X-Forwarded-For"]/@value)
else
($inbound/ctx:transport/ctx:request/http:client-address), '|$/', 
$inbound/@name,'|$/',
if($inbound/ctx:service/ctx:operation) 
then ($inbound/ctx:service/ctx:operation)
else (fn:concat($inbound/ctx:transport/ctx:request/http:http-method,' ',$inbound/ctx:transport/ctx:uri)), '|$/',
'id=',fn:replace($id,'\|\$\/',';'),
',basketId=',fn:replace($basketId,'\|\$\/',';'),
',defaultChannel=',fn:replace($defaultChannel,'\|\$\/',';')
)}
&lt;/log>
{$body}
&lt;/root></con3:xqueryText>
                        </con6:expr>
                        <con6:message>[Orange][CCU][1.1][PublicKey_PS][reserve][Response][Fault][Body after transformation]</con6:message>
                    </con6:log>
                    <con1:reply isError="true" xmlns:con2="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con1="http://www.bea.com/wli/sb/stages/config">
                        <con1:id>_ActionId-N53efef3d.3f35d53b.0.16b88fa0ffb.N7e7f</con1:id>
                    </con1:reply>
                </con:actions>
            </con:stage>
        </con:pipeline>
        <con:pipeline type="response" name="response-a80144d.N4531b017.0.161039720ae.N7e0d" errorHandler="error-a80144d.N4531b017.0.161039720ae.N7dfc">
            <con:stage id="_StageId-a80144d.N4531b017.0.161039720ae.N7e0c" name="Stage1">
                <con:context/>
                <con:actions>
                    <con3:assign varName="currentDatetime" xmlns:con4="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con6="http://www.bea.com/wli/sb/services/security/config" xmlns:con5="http://www.bea.com/wli/sb/typesystem/config" xmlns:ser="http://www.bea.com/wli/sb/services" xmlns:env="http://www.bea.com/wli/config/env" xmlns:http="http://www.bea.com/wli/sb/transports/http" xmlns:oper="http://xmlns.oracle.com/servicebus/pipeline/operations" xmlns:tran="http://www.bea.com/wli/sb/transports" xmlns:con1="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config">
                        <con2:id>_ActionId-a80144d.N4531b017.0.161039720ae.N7e0b</con2:id>
                        <con3:expr>
                            <con2:xqueryText>&lt;a>{fn:current-dateTime()}&lt;/a></con2:xqueryText>
                        </con3:expr>
                    </con3:assign>
                    <con1:log xmlns:con4="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con3="http://www.bea.com/wli/sb/stages/routing/config" xmlns:con6="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con5="http://www.bea.com/wli/sb/typesystem/config" xmlns:ser="http://www.bea.com/wli/sb/services" xmlns:env="http://www.bea.com/wli/config/env" xmlns:http="http://www.bea.com/wli/sb/transports/http" xmlns:oper="http://xmlns.oracle.com/servicebus/pipeline/operations" xmlns:tran="http://www.bea.com/wli/sb/transports" xmlns:con1="http://www.bea.com/wli/sb/stages/logging/config">
                        <con2:id>_ActionId-a80144d.N4531b017.0.161039720ae.N7e0a</con2:id>
                        <con1:logLevel>info</con1:logLevel>
                        <con1:expr>
                            <con2:xqueryText>&lt;root>
&lt;log>
{fn:concat(
data($msgId), '|$/', 
data($currentDatetime), '|$/', 
if($inbound/ctx:transport/ctx:request/tp:headers/tp:user-header[@name="X-Forwarded-For"])
then
($inbound/ctx:transport/ctx:request/tp:headers/tp:user-header[@name="X-Forwarded-For"]/@value)
else
($inbound/ctx:transport/ctx:request/http:client-address), '|$/', 
$inbound/@name,'|$/',
if($inbound/ctx:service/ctx:operation) 
then ($inbound/ctx:service/ctx:operation)
else (fn:concat($inbound/ctx:transport/ctx:request/http:http-method,' ',$inbound/ctx:transport/ctx:uri)), '|$/',
'name=',fn:replace($name,'\|\$\/',';'),
',affix=',fn:replace($affix,'\|\$\/',';')
)}
&lt;/log>
{$body}
&lt;/root></con2:xqueryText>
                        </con1:expr>
                        <con1:message>[Orange][CCU][1.1][PublicKey_PS][publicKeyFind][Response][Body before transformation]</con1:message>
                    </con1:log>
                    <con1:ifThenElse>
                        <con2:id>_ActionId-a80144d.N4531b017.0.161039720ae.N7e09</con2:id>
                        <con1:case id="_BranchId-a80144d.N4531b017.0.161039720ae.N7e08">
                            <con1:condition>
                                <con2:xqueryText>fn:local-name($body/*)!='publicKeyFindResponse'</con2:xqueryText>
                            </con1:condition>
                            <con1:actions>
                                <con1:nxsdTranslation>
                                    <con2:id>_ActionId-a80144d.N4531b017.0.161039720ae.N7e06</con2:id>
                                    <con1:type>XML-To-Native</con1:type>
                                    <con1:sourceExpr>
                                        <con2:xqueryText>$body/*</con2:xqueryText>
                                    </con1:sourceExpr>
                                    <con1:nxsd ref="CCU/Resources/nXSDs/PublicKey/api_YAML"/>
                                    <con1:schemaElement xmlns:rest="http://orange.com/OrangeMaroc_APIs/api/publicKey/v0/model/rest">rest:error</con1:schemaElement>
                                    <con1:replace-body-content/>
                                </con1:nxsdTranslation>
                                <con3:replace contents-only="true" varName="body" xmlns:con1="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config" xmlns:ser="http://www.bea.com/wli/sb/services" xmlns:http="http://www.bea.com/wli/sb/transports/http" xmlns:oper="http://xmlns.oracle.com/servicebus/pipeline/operations" xmlns:env="http://www.bea.com/wli/config/env" xmlns:tran="http://www.bea.com/wli/sb/transports">
                                    <con2:id>_ActionId-a801445.N4e4aa4c3.0.161419d4f2e.N7f88</con2:id>
                                    <con3:location>
                                        <con2:xpathText>.</con2:xpathText>
                                    </con3:location>
                                    <con3:expr>
                                        <con2:xqueryText>fn-bea:binary-to-text($body/*, 'UTF-8')</con2:xqueryText>
                                    </con3:expr>
                                </con3:replace>
                                <con3:insert varName="inbound" xmlns:ser="http://www.bea.com/wli/sb/services" xmlns:http="http://www.bea.com/wli/sb/transports/http" xmlns:oper="http://xmlns.oracle.com/servicebus/pipeline/operations" xmlns:env="http://www.bea.com/wli/config/env" xmlns:con4="http://www.bea.com/wli/sb/stages/logging/config" xmlns:tran="http://www.bea.com/wli/sb/transports" xmlns:con1="http://www.bea.com/wli/sb/stages/routing/config" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config">
                                    <con2:id>_ActionId-N3f57c7ff.46346a1f.0.163823b1586.N7f92</con2:id>
                                    <con3:location>
                                        <con2:xpathText>./ctx:transport/ctx:response</con2:xpathText>
                                    </con3:location>
                                    <con3:where>first-child</con3:where>
                                    <con3:expr>
                                        <con2:xqueryText>&lt;http:http-response-code>422&lt;/http:http-response-code></con2:xqueryText>
                                    </con3:expr>
                                </con3:insert>
                            </con1:actions>
                        </con1:case>
                        <con1:default>
                            <con1:replace contents-only="true" varName="body">
                                <con2:id>_ActionId-a801445.N4e4aa4c3.0.161419d4f2e.N7f8f</con2:id>
                                <con1:location>
                                    <con2:xpathText>.</con2:xpathText>
                                </con1:location>
                                <con1:expr>
                                    <con2:xqueryTransform>
                                        <con2:resource ref="CCU/Resources/XQueries/PublicKey/PublicKeyFind_TResp"/>
                                        <con2:param name="Resp">
                                            <con2:path>$body/*</con2:path>
                                        </con2:param>
                                    </con2:xqueryTransform>
                                </con1:expr>
                            </con1:replace>
                            <con1:nxsdTranslation>
                                <con2:id>_ActionId-a80144d.N4531b017.0.161039720ae.N7e04</con2:id>
                                <con1:type>XML-To-Native</con1:type>
                                <con1:sourceExpr>
                                    <con2:xqueryText>$body/*</con2:xqueryText>
                                </con1:sourceExpr>
                                <con1:nxsd ref="CCU/Resources/nXSDs/PublicKey/api_YAML"/>
                                <con1:schemaElement xmlns:rest="http://orange.com/OrangeMaroc_APIs/api/publicKey/v0/model/rest">rest:PublicKeyArray</con1:schemaElement>
                                <con1:replace-body-content/>
                            </con1:nxsdTranslation>
                            <con3:replace contents-only="true" varName="body" xmlns:con1="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config" xmlns:ser="http://www.bea.com/wli/sb/services" xmlns:http="http://www.bea.com/wli/sb/transports/http" xmlns:oper="http://xmlns.oracle.com/servicebus/pipeline/operations" xmlns:env="http://www.bea.com/wli/config/env" xmlns:tran="http://www.bea.com/wli/sb/transports">
                                <con2:id>_ActionId-a80144d.N4531b017.0.161039720ae.N7e03</con2:id>
                                <con3:location>
                                    <con2:xpathText>.</con2:xpathText>
                                </con3:location>
                                <con3:expr>
                                    <con2:xqueryText>fn-bea:binary-to-text($body/*, 'UTF-8')</con2:xqueryText>
                                </con3:expr>
                            </con3:replace>
                            <con1:javaScript>
                                <con2:id>_ActionId-a801445.N4e4aa4c3.0.161419d4f2e.N7f8c</con2:id>
                                <con1:script>var json = JSON.parse(process.body);
process.body = json.PublicKey;</con1:script>
                            </con1:javaScript>
                        </con1:default>
                    </con1:ifThenElse>
                    <con1:log xmlns:con4="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con3="http://www.bea.com/wli/sb/stages/routing/config" xmlns:con6="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con5="http://www.bea.com/wli/sb/typesystem/config" xmlns:ser="http://www.bea.com/wli/sb/services" xmlns:env="http://www.bea.com/wli/config/env" xmlns:http="http://www.bea.com/wli/sb/transports/http" xmlns:oper="http://xmlns.oracle.com/servicebus/pipeline/operations" xmlns:tran="http://www.bea.com/wli/sb/transports" xmlns:con1="http://www.bea.com/wli/sb/stages/logging/config">
                        <con2:id>_ActionId-a80144d.N4531b017.0.161039720ae.N7e02</con2:id>
                        <con1:logLevel>info</con1:logLevel>
                        <con1:expr>
                            <con2:xqueryText>&lt;root>
&lt;log>
{fn:concat(
data($msgId), '|$/', 
fn:current-dateTime(), '|$/', 
if($inbound/ctx:transport/ctx:request/tp:headers/tp:user-header[@name="X-Forwarded-For"])
then
($inbound/ctx:transport/ctx:request/tp:headers/tp:user-header[@name="X-Forwarded-For"]/@value)
else
($inbound/ctx:transport/ctx:request/http:client-address), '|$/', 
$inbound/@name,'|$/',
if($inbound/ctx:service/ctx:operation) 
then ($inbound/ctx:service/ctx:operation)
else (fn:concat($inbound/ctx:transport/ctx:request/http:http-method,' ',$inbound/ctx:transport/ctx:uri)), '|$/',
'name=',fn:replace($name,'\|\$\/',';'),
',affix=',fn:replace($affix,'\|\$\/',';')
)}
&lt;/log>
{$body}
&lt;/root></con2:xqueryText>
                        </con1:expr>
                        <con1:message>[Orange][CCU][1.1][PublicKey_PS][publicKeyFind][Response][Body after transformation]</con1:message>
                    </con1:log>
                    <con1:report xmlns:con4="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con3="http://www.bea.com/wli/sb/stages/routing/config" xmlns:con6="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con5="http://www.bea.com/wli/sb/typesystem/config" xmlns:ser="http://www.bea.com/wli/sb/services" xmlns:env="http://www.bea.com/wli/config/env" xmlns:http="http://www.bea.com/wli/sb/transports/http" xmlns:oper="http://xmlns.oracle.com/servicebus/pipeline/operations" xmlns:tran="http://www.bea.com/wli/sb/transports" xmlns:con1="http://www.bea.com/wli/sb/stages/logging/config">
                        <con2:id>_ActionId-a80144d.N4531b017.0.161039720ae.N7e00</con2:id>
                        <con1:expr>
                            <con2:xqueryText>&lt;ReportResponse>
{$body}
&lt;/ReportResponse></con2:xqueryText>
                        </con1:expr>
                        <con1:labels>
                            <con1:key>messageId</con1:key>
                            <con1:varName>msgId</con1:varName>
                            <con1:value>
                                <con2:xpathText>.</con2:xpathText>
                            </con1:value>
                        </con1:labels>
                        <con1:labels>
                            <con1:key>startDateTime</con1:key>
                            <con1:varName>currentDatetime</con1:varName>
                            <con1:value>
                                <con2:xpathText>.</con2:xpathText>
                            </con1:value>
                        </con1:labels>
                        <con1:labels>
                            <con1:key>ipXForwardedFor</con1:key>
                            <con1:varName>inbound</con1:varName>
                            <con1:value>
                                <con2:xpathText>if(./ctx:transport/ctx:request/tp:headers/tp:user-header[@name="X-Forwarded-For"])
then
(./ctx:transport/ctx:request/tp:headers/tp:user-header[@name="X-Forwarded-For"]/@value)
else
(./ctx:transport/ctx:request/http:client-address)</con2:xpathText>
                            </con1:value>
                        </con1:labels>
                        <con1:labels>
                            <con1:key>operationName</con1:key>
                            <con1:varName>inbound</con1:varName>
                            <con1:value>
                                <con2:xpathText>if(./ctx:service/ctx:operation) 
then (./ctx:service/ctx:operation)
else (./ctx:transport/ctx:request/http:http-method)</con2:xpathText>
                            </con1:value>
                        </con1:labels>
                        <con1:labels>
                            <con1:key>name</con1:key>
                            <con1:varName>name</con1:varName>
                            <con1:value>
                                <con2:xpathText>.</con2:xpathText>
                            </con1:value>
                        </con1:labels>
                        <con1:labels>
                            <con1:key>affix</con1:key>
                            <con1:varName>affix</con1:varName>
                            <con1:value>
                                <con2:xpathText>.</con2:xpathText>
                            </con1:value>
                        </con1:labels>
                    </con1:report>
                    <con3:transport-headers xmlns:ser="http://www.bea.com/wli/sb/services" xmlns:con1="http://www.bea.com/wli/sb/stages/routing/config" xmlns:http="http://www.bea.com/wli/sb/transports/http" xmlns:oper="http://xmlns.oracle.com/servicebus/pipeline/operations" xmlns:env="http://www.bea.com/wli/config/env" xmlns:con4="http://www.bea.com/wli/sb/stages/logging/config" xmlns:tran="http://www.bea.com/wli/sb/transports" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config">
                        <con2:id>_ActionId-a80144d.N4531b017.0.161039720ae.N7dff</con2:id>
                        <con3:header-set>inbound-response</con3:header-set>
                        <con3:header name="Content-Type" value="expression">
                            <con2:xqueryText>'application/json; charset=utf-8'</con2:xqueryText>
                        </con3:header>
                    </con3:transport-headers>
                    <con1:log xmlns:con4="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con3="http://www.bea.com/wli/sb/stages/routing/config" xmlns:con6="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con5="http://www.bea.com/wli/sb/typesystem/config" xmlns:ser="http://www.bea.com/wli/sb/services" xmlns:env="http://www.bea.com/wli/config/env" xmlns:http="http://www.bea.com/wli/sb/transports/http" xmlns:oper="http://xmlns.oracle.com/servicebus/pipeline/operations" xmlns:tran="http://www.bea.com/wli/sb/transports" xmlns:con1="http://www.bea.com/wli/sb/stages/logging/config">
                        <con2:id>_ActionId-a80144d.N4531b017.0.161039720ae.N7dfe</con2:id>
                        <con1:logLevel>info</con1:logLevel>
                        <con1:expr>
                            <con2:xqueryText>&lt;root>
&lt;log>
{fn:concat(
data($msgId), '|$/', 
fn:current-dateTime(), '|$/', 
if($inbound/ctx:transport/ctx:request/tp:headers/tp:user-header[@name="X-Forwarded-For"])
then
($inbound/ctx:transport/ctx:request/tp:headers/tp:user-header[@name="X-Forwarded-For"]/@value)
else
($inbound/ctx:transport/ctx:request/http:client-address), '|$/', 
$inbound/@name,'|$/',
if($inbound/ctx:service/ctx:operation) 
then ($inbound/ctx:service/ctx:operation)
else (fn:concat($inbound/ctx:transport/ctx:request/http:http-method,' ',$inbound/ctx:transport/ctx:uri)), '|$/',
'name=',fn:replace($name,'\|\$\/',';'),
',affix=',fn:replace($affix,'\|\$\/',';')
)}
&lt;/log>
&lt;/root></con2:xqueryText>
                        </con1:expr>
                        <con1:message>[Orange][CCU][1.1][PublicKey_PS][publicKeyFind][Response][Last]</con1:message>
                    </con1:log>
                </con:actions>
            </con:stage>
        </con:pipeline>
        <con:pipeline type="error" name="error-a80144d.N4531b017.0.161039720ae.N7e19">
            <con:stage name="RequestProblem" id="_StageId-a80144d.N4531b017.0.161039720ae.N7e18" xmlns:ser="http://www.bea.com/wli/sb/services" xmlns:con1="http://www.bea.com/wli/sb/stages/routing/config" xmlns:http="http://www.bea.com/wli/sb/transports/http" xmlns:oper="http://xmlns.oracle.com/servicebus/pipeline/operations" xmlns:env="http://www.bea.com/wli/config/env" xmlns:con4="http://www.bea.com/wli/sb/stages/logging/config" xmlns:tran="http://www.bea.com/wli/sb/transports" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config">
                <con:context/>
                <con:actions>
                    <con4:assign varName="currentDatetime" xmlns:con1="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con4="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con6="http://www.bea.com/wli/sb/services/security/config" xmlns:con5="http://www.bea.com/wli/sb/typesystem/config">
                        <con2:id>_ActionId-a80144d.N4531b017.0.161039720ae.N7e17</con2:id>
                        <con3:expr>
                            <con2:xqueryText>&lt;a>{fn:current-dateTime()}&lt;/a></con2:xqueryText>
                        </con3:expr>
                    </con4:assign>
                    <con6:log xmlns:con6="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con5="http://www.bea.com/wli/sb/stages/alert/config" xmlns:con2="http://www.bea.com/wli/sb/stages/routing/config" xmlns:con3="http://www.bea.com/wli/sb/stages/config" xmlns:con7="http://www.bea.com/wli/sb/stages/logging/config" xmlns:aler="http://www.bea.com/wli/monitoring/alert" xmlns:con4="http://www.bea.com/wli/sb/stages/routing/config">
                        <con3:id>_ActionId-a80144d.N4531b017.0.161039720ae.N7e16</con3:id>
                        <con6:logLevel>error</con6:logLevel>
                        <con6:expr>
                            <con3:xqueryText>&lt;root>
&lt;log>
{fn:concat(
data($msgId), '|$/', 
data($currentDatetime), '|$/', 
if($inbound/ctx:transport/ctx:request/tp:headers/tp:user-header[@name="X-Forwarded-For"])
then
($inbound/ctx:transport/ctx:request/tp:headers/tp:user-header[@name="X-Forwarded-For"]/@value)
else
($inbound/ctx:transport/ctx:request/http:client-address), '|$/', 
$inbound/@name,'|$/',
if($inbound/ctx:service/ctx:operation) 
then ($inbound/ctx:service/ctx:operation)
else (fn:concat($inbound/ctx:transport/ctx:request/http:http-method,' ',$inbound/ctx:transport/ctx:uri)), '|$/',
'name=',fn:replace($name,'\|\$\/',';'),
',affix=',fn:replace($affix,'\|\$\/',';')
)}
&lt;/log>
{$fault}
&lt;/root></con3:xqueryText>
                        </con6:expr>
                        <con6:message>[Orange][CCU][1.1][PublicKey_PS][publicKeyFind][Request][Fault]</con6:message>
                    </con6:log>
                    <con3:assign varName="ErrorTrace" xmlns:con2="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con1="http://www.bea.com/wli/sb/stages/config">
                        <con1:id>_ActionId-a80144d.N4531b017.0.161039720ae.N7e15</con1:id>
                        <con3:expr>
                            <con1:xqueryText><![CDATA[<soap-env:Fault>
         <faultcode>{fn:concat($fault/ctx:errorCode/text(), ' ', $body/soap-env:Fault/faultcode/text())}</faultcode>
         <faultstring>{fn:concat($body/soap-env:Fault/faultstring/text(), ' ' , $fault/ctx:reason/text())}</faultstring>
         <detail>
			{$body/soap-env:Fault/detail/*} { $fault/ctx:location}
         </detail>
</soap-env:Fault>]]></con1:xqueryText>
                        </con3:expr>
                    </con3:assign>
                    <con6:log xmlns:con6="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con5="http://www.bea.com/wli/sb/stages/alert/config" xmlns:con2="http://www.bea.com/wli/sb/stages/routing/config" xmlns:con3="http://www.bea.com/wli/sb/stages/config" xmlns:con7="http://www.bea.com/wli/sb/stages/logging/config" xmlns:aler="http://www.bea.com/wli/monitoring/alert" xmlns:con4="http://www.bea.com/wli/sb/stages/routing/config">
                        <con3:id>_ActionId-a80144d.N4531b017.0.161039720ae.N7e14</con3:id>
                        <con6:logLevel>error</con6:logLevel>
                        <con6:expr>
                            <con3:xqueryText>&lt;root>
&lt;log>
{fn:concat(
data($msgId), '|$/', 
fn:current-dateTime(), '|$/', 
if($inbound/ctx:transport/ctx:request/tp:headers/tp:user-header[@name="X-Forwarded-For"])
then
($inbound/ctx:transport/ctx:request/tp:headers/tp:user-header[@name="X-Forwarded-For"]/@value)
else
($inbound/ctx:transport/ctx:request/http:client-address), '|$/', 
$inbound/@name,'|$/',
if($inbound/ctx:service/ctx:operation) 
then ($inbound/ctx:service/ctx:operation)
else (fn:concat($inbound/ctx:transport/ctx:request/http:http-method,' ',$inbound/ctx:transport/ctx:uri)), '|$/',
'name=',fn:replace($name,'\|\$\/',';'),
',affix=',fn:replace($affix,'\|\$\/',';')
)}
&lt;/log>
{$ErrorTrace}
&lt;/root></con3:xqueryText>
                        </con6:expr>
                        <con6:message>[Orange][CCU][1.1][PublicKey_PS][publicKeyFind][Request][ErrorTrace]</con6:message>
                    </con6:log>
                    <con5:alert xmlns:con2="http://www.bea.com/wli/sb/stages/routing/config" xmlns:con5="http://www.bea.com/wli/sb/stages/alert/config" xmlns:con1="http://www.bea.com/wli/sb/stages/config">
                        <con1:id>_ActionId-a80144d.N4531b017.0.161039720ae.N7e13</con1:id>
                        <con5:destination ref="Common/Resources/Alerts/Echange_AD"/>
                        <con5:description>[Orange][CCU][1.1][PublicKey_PS][publicKeyFind][Request][ErrorTrace]</con5:description>
                        <con5:severity>critical</con5:severity>
                        <con5:payload>
                            <con1:xqueryText>$ErrorTrace</con1:xqueryText>
                        </con5:payload>
                    </con5:alert>
                    <con1:report xmlns:con4="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con3="http://www.bea.com/wli/sb/stages/routing/config" xmlns:con6="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con5="http://www.bea.com/wli/sb/typesystem/config" xmlns:con1="http://www.bea.com/wli/sb/stages/logging/config">
                        <con2:id>_ActionId-a80144d.N4531b017.0.161039720ae.N7e12</con2:id>
                        <con1:expr>
                            <con2:xqueryText>&lt;ReportRequestError>
{$ErrorTrace}
&lt;/ReportRequestError></con2:xqueryText>
                        </con1:expr>
                        <con1:labels>
                            <con1:key>messageId</con1:key>
                            <con1:varName>msgId</con1:varName>
                            <con1:value>
                                <con2:xpathText>.</con2:xpathText>
                            </con1:value>
                        </con1:labels>
                        <con1:labels>
                            <con1:key>startDateTime</con1:key>
                            <con1:varName>currentDatetime</con1:varName>
                            <con1:value>
                                <con2:xpathText>.</con2:xpathText>
                            </con1:value>
                        </con1:labels>
                        <con1:labels>
                            <con1:key>ipXForwardedFor</con1:key>
                            <con1:varName>inbound</con1:varName>
                            <con1:value>
                                <con2:xpathText>if(./ctx:transport/ctx:request/tp:headers/tp:user-header[@name="X-Forwarded-For"])
then
(./ctx:transport/ctx:request/tp:headers/tp:user-header[@name="X-Forwarded-For"]/@value)
else
(./ctx:transport/ctx:request/http:client-address)</con2:xpathText>
                            </con1:value>
                        </con1:labels>
                        <con1:labels>
                            <con1:key>operationName</con1:key>
                            <con1:varName>inbound</con1:varName>
                            <con1:value>
                                <con2:xpathText>if(./ctx:service/ctx:operation) 
then (./ctx:service/ctx:operation)
else (./ctx:transport/ctx:request/http:http-method)</con2:xpathText>
                            </con1:value>
                        </con1:labels>
                        <con1:labels>
                            <con1:key>name</con1:key>
                            <con1:varName>name</con1:varName>
                            <con1:value>
                                <con2:xpathText>.</con2:xpathText>
                            </con1:value>
                        </con1:labels>
                        <con1:labels>
                            <con1:key>affix</con1:key>
                            <con1:varName>affix</con1:varName>
                            <con1:value>
                                <con2:xpathText>.</con2:xpathText>
                            </con1:value>
                        </con1:labels>
                    </con1:report>
                    <con3:replace varName="body" contents-only="true">
                        <con2:id>_ActionId-a80144d.N4531b017.0.161039720ae.N7e11</con2:id>
                        <con3:location>
                            <con2:xpathText>.</con2:xpathText>
                        </con3:location>
                        <con3:expr>
                            <con2:xqueryText>'{
	"code": "12507",
        "message": "Request Problem",
	"infoURL": "",
	"description": ""
}'</con2:xqueryText>
                        </con3:expr>
                    </con3:replace>
                    <con3:transport-headers>
                        <con2:id>_ActionId-a80144d.N4531b017.0.161039720ae.N7e10</con2:id>
                        <con3:header-set>inbound-response</con3:header-set>
                        <con3:header name="Content-Type" value="expression">
                            <con2:xqueryText>'application/json; charset=utf-8'</con2:xqueryText>
                        </con3:header>
                    </con3:transport-headers>
                    <con6:log xmlns:con6="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con5="http://www.bea.com/wli/sb/stages/alert/config" xmlns:con2="http://www.bea.com/wli/sb/stages/routing/config" xmlns:con3="http://www.bea.com/wli/sb/stages/config" xmlns:con7="http://www.bea.com/wli/sb/stages/logging/config" xmlns:aler="http://www.bea.com/wli/monitoring/alert" xmlns:con4="http://www.bea.com/wli/sb/stages/routing/config">
                        <con3:id>_ActionId-a80144d.N4531b017.0.161039720ae.N7e0f</con3:id>
                        <con6:logLevel>error</con6:logLevel>
                        <con6:expr>
                            <con3:xqueryText>&lt;root>
&lt;log>
{fn:concat(
data($msgId), '|$/', 
fn:current-dateTime(), '|$/', 
if($inbound/ctx:transport/ctx:request/tp:headers/tp:user-header[@name="X-Forwarded-For"])
then
($inbound/ctx:transport/ctx:request/tp:headers/tp:user-header[@name="X-Forwarded-For"]/@value)
else
($inbound/ctx:transport/ctx:request/http:client-address), '|$/', 
$inbound/@name,'|$/',
if($inbound/ctx:service/ctx:operation) 
then ($inbound/ctx:service/ctx:operation)
else (fn:concat($inbound/ctx:transport/ctx:request/http:http-method,' ',$inbound/ctx:transport/ctx:uri)), '|$/',
'name=',fn:replace($name,'\|\$\/',';'),
',affix=',fn:replace($affix,'\|\$\/',';')
)}
&lt;/log>
{$body}
&lt;/root></con3:xqueryText>
                        </con6:expr>
                        <con6:message>[Orange][CCU][1.1][PublicKey_PS][publicKeyFind][Request][Fault][Body after transformation]</con6:message>
                    </con6:log>
                    <con1:reply isError="true" xmlns:con2="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con1="http://www.bea.com/wli/sb/stages/config">
                        <con1:id>_ActionId-a80144d.N4531b017.0.161039720ae.N7e0e</con1:id>
                    </con1:reply>
                </con:actions>
            </con:stage>
        </con:pipeline>
        <con:pipeline type="response" name="response-N53efef3d.3f35d53b.0.16b88fa0ffb.N7e9c" errorHandler="error-N53efef3d.3f35d53b.0.16b88fa0ffb.N7e8a">
            <con:stage id="_StageId-N53efef3d.3f35d53b.0.16b88fa0ffb.N7e9b" name="Response_reservePublicKey">
                <con:context/>
                <con:actions>
                    <con3:assign varName="currentDatetime" xmlns:con4="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con6="http://www.bea.com/wli/sb/services/security/config" xmlns:con5="http://www.bea.com/wli/sb/typesystem/config" xmlns:ser="http://www.bea.com/wli/sb/services" xmlns:env="http://www.bea.com/wli/config/env" xmlns:http="http://www.bea.com/wli/sb/transports/http" xmlns:oper="http://xmlns.oracle.com/servicebus/pipeline/operations" xmlns:tran="http://www.bea.com/wli/sb/transports" xmlns:con1="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config">
                        <con2:id>_ActionId-N53efef3d.3f35d53b.0.16b88fa0ffb.N7e9a</con2:id>
                        <con3:expr>
                            <con2:xqueryText>&lt;a>{fn:current-dateTime()}&lt;/a></con2:xqueryText>
                        </con3:expr>
                    </con3:assign>
                    <con1:log xmlns:con4="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con3="http://www.bea.com/wli/sb/stages/routing/config" xmlns:con6="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con5="http://www.bea.com/wli/sb/typesystem/config" xmlns:ser="http://www.bea.com/wli/sb/services" xmlns:env="http://www.bea.com/wli/config/env" xmlns:http="http://www.bea.com/wli/sb/transports/http" xmlns:oper="http://xmlns.oracle.com/servicebus/pipeline/operations" xmlns:tran="http://www.bea.com/wli/sb/transports" xmlns:con1="http://www.bea.com/wli/sb/stages/logging/config">
                        <con2:id>_ActionId-N53efef3d.3f35d53b.0.16b88fa0ffb.N7e99</con2:id>
                        <con1:logLevel>info</con1:logLevel>
                        <con1:expr>
                            <con2:xqueryText>&lt;root>
&lt;log>
{fn:concat(
data($msgId), '|$/', 
data($currentDatetime), '|$/', 
if($inbound/ctx:transport/ctx:request/tp:headers/tp:user-header[@name="X-Forwarded-For"])
then
($inbound/ctx:transport/ctx:request/tp:headers/tp:user-header[@name="X-Forwarded-For"]/@value)
else
($inbound/ctx:transport/ctx:request/http:client-address), '|$/', 
$inbound/@name,'|$/',
if($inbound/ctx:service/ctx:operation) 
then ($inbound/ctx:service/ctx:operation)
else (fn:concat($inbound/ctx:transport/ctx:request/http:http-method,' ',$inbound/ctx:transport/ctx:uri)), '|$/',
'id=',fn:replace($id,'\|\$\/',';'),
',basketId=',fn:replace($basketId,'\|\$\/',';'),
',defaultChannel=',fn:replace($defaultChannel,'\|\$\/',';')
)}
&lt;/log>
{$body}
&lt;/root></con2:xqueryText>
                        </con1:expr>
                        <con1:message>[Orange][CCU][1.1][PublicKey_PS][reserve][Response][Body before transformation]</con1:message>
                    </con1:log>
                    <con1:ifThenElse>
                        <con2:id>_ActionId-N53efef3d.3f35d53b.0.16b88fa0ffb.N7e98</con2:id>
                        <con1:case id="_BranchId-N53efef3d.3f35d53b.0.16b88fa0ffb.N7e97">
                            <con1:condition>
                                <con2:xqueryText>fn:local-name($body/*)='error'</con2:xqueryText>
                            </con1:condition>
                            <con1:actions>
                                <con1:nxsdTranslation>
                                    <con2:id>_ActionId-N53efef3d.3f35d53b.0.16b88fa0ffb.N7e96</con2:id>
                                    <con1:type>XML-To-Native</con1:type>
                                    <con1:sourceExpr>
                                        <con2:xqueryText>$body/*</con2:xqueryText>
                                    </con1:sourceExpr>
                                    <con1:nxsd ref="CCU/Resources/nXSDs/PublicKey/api_YAML"/>
                                    <con1:schemaElement xmlns:rest="http://orange.com/OrangeMaroc_APIs/api/publicKey/v0/model/rest">rest:error</con1:schemaElement>
                                    <con1:replace-body-content/>
                                    <con1:enforceSchemaOrder>false</con1:enforceSchemaOrder>
                                </con1:nxsdTranslation>
                                <con3:replace contents-only="true" varName="body" xmlns:con1="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config" xmlns:ser="http://www.bea.com/wli/sb/services" xmlns:http="http://www.bea.com/wli/sb/transports/http" xmlns:oper="http://xmlns.oracle.com/servicebus/pipeline/operations" xmlns:env="http://www.bea.com/wli/config/env" xmlns:tran="http://www.bea.com/wli/sb/transports">
                                    <con2:id>_ActionId-N53efef3d.3f35d53b.0.16b88fa0ffb.N7e95</con2:id>
                                    <con3:location>
                                        <con2:xpathText>.</con2:xpathText>
                                    </con3:location>
                                    <con3:expr>
                                        <con2:xqueryText>fn-bea:binary-to-text($body/*, 'UTF-8')</con2:xqueryText>
                                    </con3:expr>
                                </con3:replace>
                                <con3:insert varName="inbound" xmlns:ser="http://www.bea.com/wli/sb/services" xmlns:http="http://www.bea.com/wli/sb/transports/http" xmlns:oper="http://xmlns.oracle.com/servicebus/pipeline/operations" xmlns:env="http://www.bea.com/wli/config/env" xmlns:con4="http://www.bea.com/wli/sb/stages/logging/config" xmlns:tran="http://www.bea.com/wli/sb/transports" xmlns:con1="http://www.bea.com/wli/sb/stages/routing/config" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config">
                                    <con2:id>_ActionId-N53efef3d.3f35d53b.0.16b88fa0ffb.N7e94</con2:id>
                                    <con3:location>
                                        <con2:xpathText>./ctx:transport/ctx:response</con2:xpathText>
                                    </con3:location>
                                    <con3:where>first-child</con3:where>
                                    <con3:expr>
                                        <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">&lt;http:http-response-code>422&lt;/http:http-response-code></con:xqueryText>
                                    </con3:expr>
                                </con3:insert>
                            </con1:actions>
                        </con1:case>
                        <con1:default>
                            <con1:nxsdTranslation>
                                <con2:id>_ActionId-N53efef3d.3f35d53b.0.16b88fa0ffb.N7e91</con2:id>
                                <con1:type>XML-To-Native</con1:type>
                                <con1:sourceExpr>
                                    <con2:xqueryText>$body/*/*</con2:xqueryText>
                                </con1:sourceExpr>
                                <con1:nxsd ref="CCU/Resources/nXSDs/PublicKey/api_YAML"/>
                                <con1:schemaElement xmlns:rest="http://orange.com/OrangeMaroc_APIs/api/publicKey/v0/model/rest">rest:PublicKey</con1:schemaElement>
                                <con1:replace-body-content/>
                                <con1:enforceSchemaOrder>false</con1:enforceSchemaOrder>
                            </con1:nxsdTranslation>
                            <con3:replace contents-only="true" varName="body" xmlns:con1="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config" xmlns:ser="http://www.bea.com/wli/sb/services" xmlns:http="http://www.bea.com/wli/sb/transports/http" xmlns:oper="http://xmlns.oracle.com/servicebus/pipeline/operations" xmlns:env="http://www.bea.com/wli/config/env" xmlns:tran="http://www.bea.com/wli/sb/transports">
                                <con2:id>_ActionId-N53efef3d.3f35d53b.0.16b88fa0ffb.N7e90</con2:id>
                                <con3:location>
                                    <con2:xpathText>.</con2:xpathText>
                                </con3:location>
                                <con3:expr>
                                    <con2:xqueryText>fn-bea:binary-to-text($body/*, 'UTF-8')</con2:xqueryText>
                                </con3:expr>
                            </con3:replace>
                            <con1:javaScript>
                                <con2:id>_ActionId-N53efef3d.3f35d53b.0.16b88fa0ffb.N7e8f</con2:id>
                                <con1:script>var json = JSON.parse(process.body);
process.body = json.SimCard;</con1:script>
                            </con1:javaScript>
                        </con1:default>
                    </con1:ifThenElse>
                    <con1:log xmlns:con4="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con3="http://www.bea.com/wli/sb/stages/routing/config" xmlns:con6="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con5="http://www.bea.com/wli/sb/typesystem/config" xmlns:ser="http://www.bea.com/wli/sb/services" xmlns:env="http://www.bea.com/wli/config/env" xmlns:http="http://www.bea.com/wli/sb/transports/http" xmlns:oper="http://xmlns.oracle.com/servicebus/pipeline/operations" xmlns:tran="http://www.bea.com/wli/sb/transports" xmlns:con1="http://www.bea.com/wli/sb/stages/logging/config">
                        <con2:id>_ActionId-N53efef3d.3f35d53b.0.16b88fa0ffb.N7e8e</con2:id>
                        <con1:logLevel>info</con1:logLevel>
                        <con1:expr>
                            <con2:xqueryText>&lt;root>
&lt;log>
{fn:concat(
data($msgId), '|$/', 
fn:current-dateTime(), '|$/', 
if($inbound/ctx:transport/ctx:request/tp:headers/tp:user-header[@name="X-Forwarded-For"])
then
($inbound/ctx:transport/ctx:request/tp:headers/tp:user-header[@name="X-Forwarded-For"]/@value)
else
($inbound/ctx:transport/ctx:request/http:client-address), '|$/', 
$inbound/@name,'|$/',
if($inbound/ctx:service/ctx:operation) 
then ($inbound/ctx:service/ctx:operation)
else (fn:concat($inbound/ctx:transport/ctx:request/http:http-method,' ',$inbound/ctx:transport/ctx:uri)), '|$/',
'id=',fn:replace($id,'\|\$\/',';'),
',basketId=',fn:replace($basketId,'\|\$\/',';'),
',defaultChannel=',fn:replace($defaultChannel,'\|\$\/',';')
)}
&lt;/log>
{$body}
&lt;/root></con2:xqueryText>
                        </con1:expr>
                        <con1:message>[Orange][CCU][1.1][PublicKey_PS][reserve][Response][Body after transformation]</con1:message>
                    </con1:log>
                    <con1:report xmlns:con4="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con3="http://www.bea.com/wli/sb/stages/routing/config" xmlns:con6="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con5="http://www.bea.com/wli/sb/typesystem/config" xmlns:ser="http://www.bea.com/wli/sb/services" xmlns:env="http://www.bea.com/wli/config/env" xmlns:http="http://www.bea.com/wli/sb/transports/http" xmlns:oper="http://xmlns.oracle.com/servicebus/pipeline/operations" xmlns:tran="http://www.bea.com/wli/sb/transports" xmlns:con1="http://www.bea.com/wli/sb/stages/logging/config">
                        <con2:id>_ActionId-N53efef3d.3f35d53b.0.16b88fa0ffb.N7e8d</con2:id>
                        <con1:expr>
                            <con2:xqueryText>&lt;ReportResponse>
{$body}
&lt;/ReportResponse></con2:xqueryText>
                        </con1:expr>
                        <con1:labels>
                            <con1:key>messageId</con1:key>
                            <con1:varName>msgId</con1:varName>
                            <con1:value>
                                <con2:xpathText>.</con2:xpathText>
                            </con1:value>
                        </con1:labels>
                        <con1:labels>
                            <con1:key>startDateTime</con1:key>
                            <con1:varName>currentDatetime</con1:varName>
                            <con1:value>
                                <con2:xpathText>.</con2:xpathText>
                            </con1:value>
                        </con1:labels>
                        <con1:labels>
                            <con1:key>ipXForwardedFor</con1:key>
                            <con1:varName>inbound</con1:varName>
                            <con1:value>
                                <con2:xpathText>if(./ctx:transport/ctx:request/tp:headers/tp:user-header[@name="X-Forwarded-For"])
then
(./ctx:transport/ctx:request/tp:headers/tp:user-header[@name="X-Forwarded-For"]/@value)
else
(./ctx:transport/ctx:request/http:client-address)</con2:xpathText>
                            </con1:value>
                        </con1:labels>
                        <con1:labels>
                            <con1:key>operationName</con1:key>
                            <con1:varName>inbound</con1:varName>
                            <con1:value>
                                <con2:xpathText>if(./ctx:service/ctx:operation) 
then (./ctx:service/ctx:operation)
else (./ctx:transport/ctx:request/http:http-method)</con2:xpathText>
                            </con1:value>
                        </con1:labels>
                        <con1:labels>
                            <con1:key>id</con1:key>
                            <con1:varName>id</con1:varName>
                            <con1:value>
                                <con2:xpathText>.</con2:xpathText>
                            </con1:value>
                        </con1:labels>
                        <con1:labels>
                            <con1:key>basketId</con1:key>
                            <con1:varName>basketId</con1:varName>
                            <con1:value>
                                <con2:xpathText>.</con2:xpathText>
                            </con1:value>
                        </con1:labels>
                        <con1:labels>
                            <con1:key>defaultChannel</con1:key>
                            <con1:varName>defaultChannel</con1:varName>
                            <con1:value>
                                <con2:xpathText>.</con2:xpathText>
                            </con1:value>
                        </con1:labels>
                    </con1:report>
                    <con3:transport-headers copy-all="false" xmlns:ser="http://www.bea.com/wli/sb/services" xmlns:con1="http://www.bea.com/wli/sb/stages/routing/config" xmlns:http="http://www.bea.com/wli/sb/transports/http" xmlns:oper="http://xmlns.oracle.com/servicebus/pipeline/operations" xmlns:env="http://www.bea.com/wli/config/env" xmlns:con4="http://www.bea.com/wli/sb/stages/logging/config" xmlns:tran="http://www.bea.com/wli/sb/transports" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config">
                        <con2:id>_ActionId-N53efef3d.3f35d53b.0.16b88fa0ffb.N7e8c</con2:id>
                        <con3:header-set>inbound-response</con3:header-set>
                        <con3:header name="Content-Type" value="expression">
                            <con2:xqueryText>'application/json; charset=utf-8'</con2:xqueryText>
                        </con3:header>
                    </con3:transport-headers>
                </con:actions>
            </con:stage>
        </con:pipeline>
        <con:pipeline type="error" name="error-N3f57c7ff.N5c6fea04.0.1645fca4632.N7ce2">
            <con:stage id="_StageId-N3f57c7ff.N5c6fea04.0.1645fca4632.N7c2f" name="InvocationProblem_cancelPublicKey">
                <con:context/>
                <con:actions>
                    <con3:assign varName="currentDatetime" xmlns:con1="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con4="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con6="http://www.bea.com/wli/sb/services/security/config" xmlns:con5="http://www.bea.com/wli/sb/typesystem/config" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config" xmlns:ser="http://www.bea.com/wli/sb/services" xmlns:env="http://www.bea.com/wli/config/env" xmlns:http="http://www.bea.com/wli/sb/transports/http" xmlns:oper="http://xmlns.oracle.com/servicebus/pipeline/operations" xmlns:tran="http://www.bea.com/wli/sb/transports">
                        <con2:id>_ActionId-N3f57c7ff.N5c6fea04.0.1645fca4632.N7c2e</con2:id>
                        <con3:expr>
                            <con2:xqueryText>&lt;a>{fn:current-dateTime()}&lt;/a></con2:xqueryText>
                        </con3:expr>
                    </con3:assign>
                    <con7:log xmlns:con6="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con2="http://www.bea.com/wli/sb/stages/routing/config" xmlns:con3="http://www.bea.com/wli/sb/stages/config" xmlns:con7="http://www.bea.com/wli/sb/stages/logging/config" xmlns:aler="http://www.bea.com/wli/monitoring/alert" xmlns:ser="http://www.bea.com/wli/sb/services" xmlns:env="http://www.bea.com/wli/config/env" xmlns:http="http://www.bea.com/wli/sb/transports/http" xmlns:oper="http://xmlns.oracle.com/servicebus/pipeline/operations" xmlns:con5="http://www.bea.com/wli/sb/stages/alert/config" xmlns:tran="http://www.bea.com/wli/sb/transports">
                        <con3:id>_ActionId-N3f57c7ff.N5c6fea04.0.1645fca4632.N7c2d</con3:id>
                        <con6:logLevel>error</con6:logLevel>
                        <con6:expr>
                            <con3:xqueryText>&lt;root>
&lt;log>
{fn:concat(
data($msgId), '|$/', 
data($currentDatetime), '|$/', 
if($inbound/ctx:transport/ctx:request/tp:headers/tp:user-header[@name="X-Forwarded-For"])
then
($inbound/ctx:transport/ctx:request/tp:headers/tp:user-header[@name="X-Forwarded-For"]/@value)
else
($inbound/ctx:transport/ctx:request/http:client-address), '|$/', 
$inbound/@name,'|$/',
if($inbound/ctx:service/ctx:operation) 
then ($inbound/ctx:service/ctx:operation)
else (fn:concat($inbound/ctx:transport/ctx:request/http:http-method,' ',$inbound/ctx:transport/ctx:uri)), '|$/',
'id=',fn:replace($id,'\|\$\/',';'),
',basketId=',fn:replace($basketId,'\|\$\/',';'),
',defaultChannel=',fn:replace($defaultChannel,'\|\$\/',';')
)}
&lt;/log>
{$fault}
&lt;/root></con3:xqueryText>
                        </con6:expr>
                        <con6:message>[Orange][CCU][1.1][PublicKey_PS][cancel][Invocation][Fault]</con6:message>
                    </con7:log>
                    <con6:assign varName="ErrorTrace" xmlns:con2="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con1="http://www.bea.com/wli/sb/stages/config" xmlns:con4="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config" xmlns:ser="http://www.bea.com/wli/sb/services" xmlns:env="http://www.bea.com/wli/config/env" xmlns:http="http://www.bea.com/wli/sb/transports/http" xmlns:con6="http://www.bea.com/wli/sb/stages/transform/config" xmlns:oper="http://xmlns.oracle.com/servicebus/pipeline/operations" xmlns:con5="http://www.bea.com/wli/sb/stages/alert/config" xmlns:tran="http://www.bea.com/wli/sb/transports">
                        <con1:id>_ActionId-N3f57c7ff.N5c6fea04.0.1645fca4632.N7c2c</con1:id>
                        <con3:expr>
                            <con1:xqueryText><![CDATA[<soap-env:Fault>
         <faultcode>{fn:concat($fault/ctx:errorCode/text(), ' ', $body/soap-env:Fault/faultcode/text())}</faultcode>
         <faultstring>{fn:concat($body/soap-env:Fault/faultstring/text(), ' ' , $fault/ctx:reason/text())}</faultstring>
         <detail>
			{$body/soap-env:Fault/detail/*} { $fault/ctx:location}
         </detail>
</soap-env:Fault>]]></con1:xqueryText>
                        </con3:expr>
                    </con6:assign>
                    <con7:log xmlns:con6="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con2="http://www.bea.com/wli/sb/stages/routing/config" xmlns:con3="http://www.bea.com/wli/sb/stages/config" xmlns:con7="http://www.bea.com/wli/sb/stages/logging/config" xmlns:aler="http://www.bea.com/wli/monitoring/alert" xmlns:ser="http://www.bea.com/wli/sb/services" xmlns:env="http://www.bea.com/wli/config/env" xmlns:http="http://www.bea.com/wli/sb/transports/http" xmlns:oper="http://xmlns.oracle.com/servicebus/pipeline/operations" xmlns:con5="http://www.bea.com/wli/sb/stages/alert/config" xmlns:tran="http://www.bea.com/wli/sb/transports">
                        <con3:id>_ActionId-N3f57c7ff.N5c6fea04.0.1645fca4632.N7c2b</con3:id>
                        <con6:logLevel>error</con6:logLevel>
                        <con6:expr>
                            <con3:xqueryText>&lt;root>
&lt;log>
{fn:concat(
data($msgId), '|$/', 
fn:current-dateTime(), '|$/', 
if($inbound/ctx:transport/ctx:request/tp:headers/tp:user-header[@name="X-Forwarded-For"])
then
($inbound/ctx:transport/ctx:request/tp:headers/tp:user-header[@name="X-Forwarded-For"]/@value)
else
($inbound/ctx:transport/ctx:request/http:client-address), '|$/', 
$inbound/@name,'|$/',
if($inbound/ctx:service/ctx:operation) 
then ($inbound/ctx:service/ctx:operation)
else (fn:concat($inbound/ctx:transport/ctx:request/http:http-method,' ',$inbound/ctx:transport/ctx:uri)), '|$/',
'id=',fn:replace($id,'\|\$\/',';'),
',basketId=',fn:replace($basketId,'\|\$\/',';'),
',defaultChannel=',fn:replace($defaultChannel,'\|\$\/',';')
)}
&lt;/log>
{$ErrorTrace}
&lt;/root></con3:xqueryText>
                        </con6:expr>
                        <con6:message>[Orange][CCU][1.1][PublicKey_PS][cancel][Invocation][ErrorTrace]</con6:message>
                    </con7:log>
                    <con5:alert xmlns:con2="http://www.bea.com/wli/sb/stages/routing/config" xmlns:con1="http://www.bea.com/wli/sb/stages/config" xmlns:con4="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config" xmlns:ser="http://www.bea.com/wli/sb/services" xmlns:env="http://www.bea.com/wli/config/env" xmlns:http="http://www.bea.com/wli/sb/transports/http" xmlns:con6="http://www.bea.com/wli/sb/stages/transform/config" xmlns:oper="http://xmlns.oracle.com/servicebus/pipeline/operations" xmlns:con5="http://www.bea.com/wli/sb/stages/alert/config" xmlns:tran="http://www.bea.com/wli/sb/transports">
                        <con1:id>_ActionId-N3f57c7ff.N5c6fea04.0.1645fca4632.N7c2a</con1:id>
                        <con5:destination ref="Common/Resources/Alerts/Echange_AD"/>
                        <con5:description>[Orange][CCU][1.1][PublicKey_PS][cancel][Invocation][ErrorTrace]</con5:description>
                        <con5:severity>critical</con5:severity>
                        <con5:payload>
                            <con1:xqueryText>$ErrorTrace</con1:xqueryText>
                        </con5:payload>
                    </con5:alert>
                    <con1:report xmlns:con4="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con3="http://www.bea.com/wli/sb/stages/routing/config" xmlns:con6="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con5="http://www.bea.com/wli/sb/typesystem/config" xmlns:con1="http://www.bea.com/wli/sb/stages/logging/config" xmlns:ser="http://www.bea.com/wli/sb/services" xmlns:env="http://www.bea.com/wli/config/env" xmlns:http="http://www.bea.com/wli/sb/transports/http" xmlns:oper="http://xmlns.oracle.com/servicebus/pipeline/operations" xmlns:tran="http://www.bea.com/wli/sb/transports">
                        <con2:id>_ActionId-N3f57c7ff.N5c6fea04.0.1645fca4632.N7c29</con2:id>
                        <con1:expr>
                            <con2:xqueryText>&lt;ReportInvocationError>
{$ErrorTrace}
&lt;/ReportInvocationError></con2:xqueryText>
                        </con1:expr>
                        <con1:labels>
                            <con1:key>messageId</con1:key>
                            <con1:varName>msgId</con1:varName>
                            <con1:value>
                                <con2:xpathText>.</con2:xpathText>
                            </con1:value>
                        </con1:labels>
                        <con1:labels>
                            <con1:key>startDateTime</con1:key>
                            <con1:varName>currentDatetime</con1:varName>
                            <con1:value>
                                <con2:xpathText>.</con2:xpathText>
                            </con1:value>
                        </con1:labels>
                        <con1:labels>
                            <con1:key>ipXForwardedFor</con1:key>
                            <con1:varName>inbound</con1:varName>
                            <con1:value>
                                <con2:xpathText>if(./ctx:transport/ctx:request/tp:headers/tp:user-header[@name="X-Forwarded-For"])
then
(./ctx:transport/ctx:request/tp:headers/tp:user-header[@name="X-Forwarded-For"]/@value)
else
(./ctx:transport/ctx:request/http:client-address)</con2:xpathText>
                            </con1:value>
                        </con1:labels>
                        <con1:labels>
                            <con1:key>operationName</con1:key>
                            <con1:varName>inbound</con1:varName>
                            <con1:value>
                                <con2:xpathText>if(./ctx:service/ctx:operation) 
then (./ctx:service/ctx:operation)
else (./ctx:transport/ctx:request/http:http-method)</con2:xpathText>
                            </con1:value>
                        </con1:labels>
                        <con1:labels>
                            <con1:key>id</con1:key>
                            <con1:varName>id</con1:varName>
                            <con1:value>
                                <con2:xpathText>.</con2:xpathText>
                            </con1:value>
                        </con1:labels>
                        <con1:labels>
                            <con1:key>basketId</con1:key>
                            <con1:varName>basketId</con1:varName>
                            <con1:value>
                                <con2:xpathText>.</con2:xpathText>
                            </con1:value>
                        </con1:labels>
                        <con1:labels>
                            <con1:key>defaultChannel</con1:key>
                            <con1:varName>defaultChannel</con1:varName>
                            <con1:value>
                                <con2:xpathText>.</con2:xpathText>
                            </con1:value>
                        </con1:labels>
                    </con1:report>
                    <con6:replace varName="body" contents-only="true" xmlns:con1="http://www.bea.com/wli/sb/stages/routing/config" xmlns:con4="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config" xmlns:ser="http://www.bea.com/wli/sb/services" xmlns:env="http://www.bea.com/wli/config/env" xmlns:http="http://www.bea.com/wli/sb/transports/http" xmlns:con6="http://www.bea.com/wli/sb/stages/transform/config" xmlns:oper="http://xmlns.oracle.com/servicebus/pipeline/operations" xmlns:con5="http://www.bea.com/wli/sb/stages/alert/config" xmlns:tran="http://www.bea.com/wli/sb/transports">
                        <con2:id>_ActionId-N3f57c7ff.N5c6fea04.0.1645fca4632.N7c28</con2:id>
                        <con3:location>
                            <con2:xpathText>.</con2:xpathText>
                        </con3:location>
                        <con3:expr>
                            <con2:xqueryText>'{
	"code": "12501",
        "message": "Invocation problem",
	"infoURL": "",
	"description": ""
}'</con2:xqueryText>
                        </con3:expr>
                    </con6:replace>
                    <con6:transport-headers xmlns:con1="http://www.bea.com/wli/sb/stages/routing/config" xmlns:con4="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config" xmlns:ser="http://www.bea.com/wli/sb/services" xmlns:env="http://www.bea.com/wli/config/env" xmlns:http="http://www.bea.com/wli/sb/transports/http" xmlns:con6="http://www.bea.com/wli/sb/stages/transform/config" xmlns:oper="http://xmlns.oracle.com/servicebus/pipeline/operations" xmlns:con5="http://www.bea.com/wli/sb/stages/alert/config" xmlns:tran="http://www.bea.com/wli/sb/transports">
                        <con2:id>_ActionId-N3f57c7ff.N5c6fea04.0.1645fca4632.N7c27</con2:id>
                        <con3:header-set>inbound-response</con3:header-set>
                        <con3:header name="Content-Type" value="expression">
                            <con2:xqueryText>'application/json; charset=utf-8'</con2:xqueryText>
                        </con3:header>
                    </con6:transport-headers>
                    <con7:log xmlns:con6="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con2="http://www.bea.com/wli/sb/stages/routing/config" xmlns:con3="http://www.bea.com/wli/sb/stages/config" xmlns:con7="http://www.bea.com/wli/sb/stages/logging/config" xmlns:aler="http://www.bea.com/wli/monitoring/alert" xmlns:ser="http://www.bea.com/wli/sb/services" xmlns:env="http://www.bea.com/wli/config/env" xmlns:http="http://www.bea.com/wli/sb/transports/http" xmlns:oper="http://xmlns.oracle.com/servicebus/pipeline/operations" xmlns:con5="http://www.bea.com/wli/sb/stages/alert/config" xmlns:tran="http://www.bea.com/wli/sb/transports">
                        <con3:id>_ActionId-N3f57c7ff.N5c6fea04.0.1645fca4632.N7c26</con3:id>
                        <con6:logLevel>error</con6:logLevel>
                        <con6:expr>
                            <con3:xqueryText>&lt;root>
&lt;log>
{fn:concat(
data($msgId), '|$/', 
fn:current-dateTime(), '|$/', 
if($inbound/ctx:transport/ctx:request/tp:headers/tp:user-header[@name="X-Forwarded-For"])
then
($inbound/ctx:transport/ctx:request/tp:headers/tp:user-header[@name="X-Forwarded-For"]/@value)
else
($inbound/ctx:transport/ctx:request/http:client-address), '|$/', 
$inbound/@name,'|$/',
if($inbound/ctx:service/ctx:operation) 
then ($inbound/ctx:service/ctx:operation)
else (fn:concat($inbound/ctx:transport/ctx:request/http:http-method,' ',$inbound/ctx:transport/ctx:uri)), '|$/',
'id=',fn:replace($id,'\|\$\/',';'),
',basketId=',fn:replace($basketId,'\|\$\/',';'),
',defaultChannel=',fn:replace($defaultChannel,'\|\$\/',';')
)}
&lt;/log>
{$body}
&lt;/root></con3:xqueryText>
                        </con6:expr>
                        <con6:message>[Orange][CCU][1.1][PublicKey_PS][cancel][Invocation][Fault][Body after transformation]</con6:message>
                    </con7:log>
                    <con1:reply isError="true" xmlns:con2="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con1="http://www.bea.com/wli/sb/stages/config" xmlns:con4="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config" xmlns:ser="http://www.bea.com/wli/sb/services" xmlns:env="http://www.bea.com/wli/config/env" xmlns:http="http://www.bea.com/wli/sb/transports/http" xmlns:con6="http://www.bea.com/wli/sb/stages/transform/config" xmlns:oper="http://xmlns.oracle.com/servicebus/pipeline/operations" xmlns:con5="http://www.bea.com/wli/sb/stages/alert/config" xmlns:tran="http://www.bea.com/wli/sb/transports">
                        <con1:id>_ActionId-N3f57c7ff.N5c6fea04.0.1645fca4632.N7c25</con1:id>
                    </con1:reply>
                </con:actions>
            </con:stage>
        </con:pipeline>
        <con:pipeline type="response" name="response-N3f57c7ff.N5c6fea04.0.1645fca4632.N7e40" errorHandler="error-N3f57c7ff.N5c6fea04.0.1645fca4632.N7e2d">
            <con:stage id="_StageId-N3f57c7ff.N5c6fea04.0.1645fca4632.N7e3f" name="Response_cancelPublicKey">
                <con:context/>
                <con:actions>
                    <con3:assign varName="currentDatetime" xmlns:con4="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con6="http://www.bea.com/wli/sb/services/security/config" xmlns:con5="http://www.bea.com/wli/sb/typesystem/config" xmlns:ser="http://www.bea.com/wli/sb/services" xmlns:env="http://www.bea.com/wli/config/env" xmlns:http="http://www.bea.com/wli/sb/transports/http" xmlns:oper="http://xmlns.oracle.com/servicebus/pipeline/operations" xmlns:tran="http://www.bea.com/wli/sb/transports" xmlns:con1="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config">
                        <con2:id>_ActionId-N3f57c7ff.N5c6fea04.0.1645fca4632.N7e3e</con2:id>
                        <con3:expr>
                            <con2:xqueryText>&lt;a>{fn:current-dateTime()}&lt;/a></con2:xqueryText>
                        </con3:expr>
                    </con3:assign>
                    <con1:log xmlns:con4="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con3="http://www.bea.com/wli/sb/stages/routing/config" xmlns:con6="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con5="http://www.bea.com/wli/sb/typesystem/config" xmlns:ser="http://www.bea.com/wli/sb/services" xmlns:env="http://www.bea.com/wli/config/env" xmlns:http="http://www.bea.com/wli/sb/transports/http" xmlns:oper="http://xmlns.oracle.com/servicebus/pipeline/operations" xmlns:tran="http://www.bea.com/wli/sb/transports" xmlns:con1="http://www.bea.com/wli/sb/stages/logging/config">
                        <con2:id>_ActionId-N3f57c7ff.N5c6fea04.0.1645fca4632.N7e3d</con2:id>
                        <con1:logLevel>info</con1:logLevel>
                        <con1:expr>
                            <con2:xqueryText>&lt;root>
&lt;log>
{fn:concat(
data($msgId), '|$/', 
data($currentDatetime), '|$/', 
if($inbound/ctx:transport/ctx:request/tp:headers/tp:user-header[@name="X-Forwarded-For"])
then
($inbound/ctx:transport/ctx:request/tp:headers/tp:user-header[@name="X-Forwarded-For"]/@value)
else
($inbound/ctx:transport/ctx:request/http:client-address), '|$/', 
$inbound/@name,'|$/',
if($inbound/ctx:service/ctx:operation) 
then ($inbound/ctx:service/ctx:operation)
else (fn:concat($inbound/ctx:transport/ctx:request/http:http-method,' ',$inbound/ctx:transport/ctx:uri)), '|$/',
'id=',fn:replace($id,'\|\$\/',';'),
',basketId=',fn:replace($basketId,'\|\$\/',';'),
',defaultChannel=',fn:replace($defaultChannel,'\|\$\/',';')
)}
&lt;/log>
{$body}
&lt;/root></con2:xqueryText>
                        </con1:expr>
                        <con1:message>[Orange][CCU][1.1][PublicKey_PS][cancel][Response][Body before transformation]</con1:message>
                    </con1:log>
                    <con1:ifThenElse>
                        <con2:id>_ActionId-N3f57c7ff.N5c6fea04.0.1645fca4632.N7e3b</con2:id>
                        <con1:case id="_BranchId-N3f57c7ff.N5c6fea04.0.1645fca4632.N7e3a">
                            <con1:condition>
                                <con2:xqueryText>fn:local-name($body/*)='error'</con2:xqueryText>
                            </con1:condition>
                            <con1:actions>
                                <con1:nxsdTranslation>
                                    <con2:id>_ActionId-N3f57c7ff.N5c6fea04.0.1645fca4632.N7e39</con2:id>
                                    <con1:type>XML-To-Native</con1:type>
                                    <con1:sourceExpr>
                                        <con2:xqueryText>$body/*</con2:xqueryText>
                                    </con1:sourceExpr>
                                    <con1:nxsd ref="CCU/Resources/nXSDs/PublicKey/api_YAML"/>
                                    <con1:schemaElement xmlns:rest="http://orange.com/OrangeMaroc_APIs/api/publicKey/v0/model/rest">rest:error</con1:schemaElement>
                                    <con1:replace-body-content/>
                                    <con1:enforceSchemaOrder>false</con1:enforceSchemaOrder>
                                </con1:nxsdTranslation>
                                <con3:replace contents-only="true" varName="body" xmlns:con1="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config" xmlns:ser="http://www.bea.com/wli/sb/services" xmlns:http="http://www.bea.com/wli/sb/transports/http" xmlns:oper="http://xmlns.oracle.com/servicebus/pipeline/operations" xmlns:env="http://www.bea.com/wli/config/env" xmlns:tran="http://www.bea.com/wli/sb/transports">
                                    <con2:id>_ActionId-N3f57c7ff.N5c6fea04.0.1645fca4632.N7e38</con2:id>
                                    <con3:location>
                                        <con2:xpathText>.</con2:xpathText>
                                    </con3:location>
                                    <con3:expr>
                                        <con2:xqueryText>fn-bea:binary-to-text($body/*, 'UTF-8')</con2:xqueryText>
                                    </con3:expr>
                                </con3:replace>
                                <con3:insert varName="inbound" xmlns:ser="http://www.bea.com/wli/sb/services" xmlns:http="http://www.bea.com/wli/sb/transports/http" xmlns:oper="http://xmlns.oracle.com/servicebus/pipeline/operations" xmlns:env="http://www.bea.com/wli/config/env" xmlns:con4="http://www.bea.com/wli/sb/stages/logging/config" xmlns:tran="http://www.bea.com/wli/sb/transports" xmlns:con1="http://www.bea.com/wli/sb/stages/routing/config" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config">
                                    <con2:id>_ActionId-N3f57c7ff.N5c6fea04.0.1645fca4632.N7e37</con2:id>
                                    <con3:location>
                                        <con2:xpathText>./ctx:transport/ctx:response</con2:xpathText>
                                    </con3:location>
                                    <con3:where>first-child</con3:where>
                                    <con3:expr>
                                        <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">&lt;http:http-response-code>422&lt;/http:http-response-code></con:xqueryText>
                                    </con3:expr>
                                </con3:insert>
                            </con1:actions>
                        </con1:case>
                        <con1:default>
                            <con1:nxsdTranslation>
                                <con2:id>_ActionId-N3f57c7ff.N5c6fea04.0.1645fca4632.N7e34</con2:id>
                                <con1:type>XML-To-Native</con1:type>
                                <con1:sourceExpr>
                                    <con2:xqueryText>$body/*/*</con2:xqueryText>
                                </con1:sourceExpr>
                                <con1:nxsd ref="CCU/Resources/nXSDs/PublicKey/api_YAML"/>
                                <con1:schemaElement xmlns:rest="http://orange.com/OrangeMaroc_APIs/api/publicKey/v0/model/rest">rest:PublicKey</con1:schemaElement>
                                <con1:replace-body-content/>
                                <con1:enforceSchemaOrder>false</con1:enforceSchemaOrder>
                            </con1:nxsdTranslation>
                            <con3:replace contents-only="true" varName="body" xmlns:con1="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config" xmlns:ser="http://www.bea.com/wli/sb/services" xmlns:http="http://www.bea.com/wli/sb/transports/http" xmlns:oper="http://xmlns.oracle.com/servicebus/pipeline/operations" xmlns:env="http://www.bea.com/wli/config/env" xmlns:tran="http://www.bea.com/wli/sb/transports">
                                <con2:id>_ActionId-N3f57c7ff.N5c6fea04.0.1645fca4632.N7e33</con2:id>
                                <con3:location>
                                    <con2:xpathText>.</con2:xpathText>
                                </con3:location>
                                <con3:expr>
                                    <con2:xqueryText>fn-bea:binary-to-text($body/*, 'UTF-8')</con2:xqueryText>
                                </con3:expr>
                            </con3:replace>
                            <con1:javaScript>
                                <con2:id>_ActionId-N3f57c7ff.N5c6fea04.0.1645fca4632.N7e32</con2:id>
                                <con1:script>var json = JSON.parse(process.body);
process.body = json.SimCard;</con1:script>
                            </con1:javaScript>
                        </con1:default>
                    </con1:ifThenElse>
                    <con1:log xmlns:con4="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con3="http://www.bea.com/wli/sb/stages/routing/config" xmlns:con6="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con5="http://www.bea.com/wli/sb/typesystem/config" xmlns:ser="http://www.bea.com/wli/sb/services" xmlns:env="http://www.bea.com/wli/config/env" xmlns:http="http://www.bea.com/wli/sb/transports/http" xmlns:oper="http://xmlns.oracle.com/servicebus/pipeline/operations" xmlns:tran="http://www.bea.com/wli/sb/transports" xmlns:con1="http://www.bea.com/wli/sb/stages/logging/config">
                        <con2:id>_ActionId-N3f57c7ff.N5c6fea04.0.1645fca4632.N7e31</con2:id>
                        <con1:logLevel>info</con1:logLevel>
                        <con1:expr>
                            <con2:xqueryText>&lt;root>
&lt;log>
{fn:concat(
data($msgId), '|$/', 
fn:current-dateTime(), '|$/', 
if($inbound/ctx:transport/ctx:request/tp:headers/tp:user-header[@name="X-Forwarded-For"])
then
($inbound/ctx:transport/ctx:request/tp:headers/tp:user-header[@name="X-Forwarded-For"]/@value)
else
($inbound/ctx:transport/ctx:request/http:client-address), '|$/', 
$inbound/@name,'|$/',
if($inbound/ctx:service/ctx:operation) 
then ($inbound/ctx:service/ctx:operation)
else (fn:concat($inbound/ctx:transport/ctx:request/http:http-method,' ',$inbound/ctx:transport/ctx:uri)), '|$/',
'id=',fn:replace($id,'\|\$\/',';'),
',basketId=',fn:replace($basketId,'\|\$\/',';'),
',defaultChannel=',fn:replace($defaultChannel,'\|\$\/',';')
)}
&lt;/log>
{$body}
&lt;/root></con2:xqueryText>
                        </con1:expr>
                        <con1:message>[Orange][CCU][1.1][PublicKey_PS][cancel][Response][Body after transformation]</con1:message>
                    </con1:log>
                    <con1:report xmlns:con4="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con3="http://www.bea.com/wli/sb/stages/routing/config" xmlns:con6="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con5="http://www.bea.com/wli/sb/typesystem/config" xmlns:ser="http://www.bea.com/wli/sb/services" xmlns:env="http://www.bea.com/wli/config/env" xmlns:http="http://www.bea.com/wli/sb/transports/http" xmlns:oper="http://xmlns.oracle.com/servicebus/pipeline/operations" xmlns:tran="http://www.bea.com/wli/sb/transports" xmlns:con1="http://www.bea.com/wli/sb/stages/logging/config">
                        <con2:id>_ActionId-N3f57c7ff.N5c6fea04.0.1645fca4632.N7e30</con2:id>
                        <con1:expr>
                            <con2:xqueryText>&lt;ReportResponse>
{$body}
&lt;/ReportResponse></con2:xqueryText>
                        </con1:expr>
                        <con1:labels>
                            <con1:key>messageId</con1:key>
                            <con1:varName>msgId</con1:varName>
                            <con1:value>
                                <con2:xpathText>.</con2:xpathText>
                            </con1:value>
                        </con1:labels>
                        <con1:labels>
                            <con1:key>startDateTime</con1:key>
                            <con1:varName>currentDatetime</con1:varName>
                            <con1:value>
                                <con2:xpathText>.</con2:xpathText>
                            </con1:value>
                        </con1:labels>
                        <con1:labels>
                            <con1:key>ipXForwardedFor</con1:key>
                            <con1:varName>inbound</con1:varName>
                            <con1:value>
                                <con2:xpathText>if(./ctx:transport/ctx:request/tp:headers/tp:user-header[@name="X-Forwarded-For"])
then
(./ctx:transport/ctx:request/tp:headers/tp:user-header[@name="X-Forwarded-For"]/@value)
else
(./ctx:transport/ctx:request/http:client-address)</con2:xpathText>
                            </con1:value>
                        </con1:labels>
                        <con1:labels>
                            <con1:key>operationName</con1:key>
                            <con1:varName>inbound</con1:varName>
                            <con1:value>
                                <con2:xpathText>if(./ctx:service/ctx:operation) 
then (./ctx:service/ctx:operation)
else (./ctx:transport/ctx:request/http:http-method)</con2:xpathText>
                            </con1:value>
                        </con1:labels>
                        <con1:labels>
                            <con1:key>id</con1:key>
                            <con1:varName>id</con1:varName>
                            <con1:value>
                                <con2:xpathText>.</con2:xpathText>
                            </con1:value>
                        </con1:labels>
                        <con1:labels>
                            <con1:key>basketId</con1:key>
                            <con1:varName>basketId</con1:varName>
                            <con1:value>
                                <con2:xpathText>.</con2:xpathText>
                            </con1:value>
                        </con1:labels>
                        <con1:labels>
                            <con1:key>defaultChannel</con1:key>
                            <con1:varName>defaultChannel</con1:varName>
                            <con1:value>
                                <con2:xpathText>.</con2:xpathText>
                            </con1:value>
                        </con1:labels>
                    </con1:report>
                    <con3:transport-headers copy-all="false" xmlns:ser="http://www.bea.com/wli/sb/services" xmlns:con1="http://www.bea.com/wli/sb/stages/routing/config" xmlns:http="http://www.bea.com/wli/sb/transports/http" xmlns:oper="http://xmlns.oracle.com/servicebus/pipeline/operations" xmlns:env="http://www.bea.com/wli/config/env" xmlns:con4="http://www.bea.com/wli/sb/stages/logging/config" xmlns:tran="http://www.bea.com/wli/sb/transports" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config">
                        <con2:id>_ActionId-N3f57c7ff.N5c6fea04.0.1645fca4632.N7e2f</con2:id>
                        <con3:header-set>inbound-response</con3:header-set>
                        <con3:header name="Content-Type" value="expression">
                            <con2:xqueryText>'application/json; charset=utf-8'</con2:xqueryText>
                        </con3:header>
                    </con3:transport-headers>
                </con:actions>
            </con:stage>
        </con:pipeline>
        <con:pipeline type="error" name="error-a80144d.N4531b017.0.161039720ae.N7dfc">
            <con:stage name="ResponseProblem" id="_StageId-a80144d.N4531b017.0.161039720ae.N7dfb" xmlns:ser="http://www.bea.com/wli/sb/services" xmlns:con1="http://www.bea.com/wli/sb/stages/routing/config" xmlns:http="http://www.bea.com/wli/sb/transports/http" xmlns:oper="http://xmlns.oracle.com/servicebus/pipeline/operations" xmlns:env="http://www.bea.com/wli/config/env" xmlns:con4="http://www.bea.com/wli/sb/stages/logging/config" xmlns:tran="http://www.bea.com/wli/sb/transports" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config">
                <con:context/>
                <con:actions>
                    <con4:assign varName="currentDatetime" xmlns:con1="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con4="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con6="http://www.bea.com/wli/sb/services/security/config" xmlns:con5="http://www.bea.com/wli/sb/typesystem/config">
                        <con2:id>_ActionId-a80144d.N4531b017.0.161039720ae.N7dfa</con2:id>
                        <con3:expr>
                            <con2:xqueryText>&lt;a>{fn:current-dateTime()}&lt;/a></con2:xqueryText>
                        </con3:expr>
                    </con4:assign>
                    <con6:log xmlns:con6="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con5="http://www.bea.com/wli/sb/stages/alert/config" xmlns:con2="http://www.bea.com/wli/sb/stages/routing/config" xmlns:con3="http://www.bea.com/wli/sb/stages/config" xmlns:con7="http://www.bea.com/wli/sb/stages/logging/config" xmlns:aler="http://www.bea.com/wli/monitoring/alert" xmlns:con4="http://www.bea.com/wli/sb/stages/routing/config">
                        <con3:id>_ActionId-a80144d.N4531b017.0.161039720ae.N7df9</con3:id>
                        <con6:logLevel>error</con6:logLevel>
                        <con6:expr>
                            <con3:xqueryText>&lt;root>
&lt;log>
{fn:concat(
data($msgId), '|$/', 
data($currentDatetime), '|$/', 
if($inbound/ctx:transport/ctx:request/tp:headers/tp:user-header[@name="X-Forwarded-For"])
then
($inbound/ctx:transport/ctx:request/tp:headers/tp:user-header[@name="X-Forwarded-For"]/@value)
else
($inbound/ctx:transport/ctx:request/http:client-address), '|$/', 
$inbound/@name,'|$/',
if($inbound/ctx:service/ctx:operation) 
then ($inbound/ctx:service/ctx:operation)
else (fn:concat($inbound/ctx:transport/ctx:request/http:http-method,' ',$inbound/ctx:transport/ctx:uri)), '|$/',
'name=',fn:replace($name,'\|\$\/',';'),
',affix=',fn:replace($affix,'\|\$\/',';')
)}
&lt;/log>
{$fault}
&lt;/root></con3:xqueryText>
                        </con6:expr>
                        <con6:message>[Orange][CCU][1.1][PublicKey_PS][publicKeyFind][Response][Fault]</con6:message>
                    </con6:log>
                    <con3:assign varName="ErrorTrace" xmlns:con2="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con1="http://www.bea.com/wli/sb/stages/config">
                        <con1:id>_ActionId-a80144d.N4531b017.0.161039720ae.N7df8</con1:id>
                        <con3:expr>
                            <con1:xqueryText><![CDATA[<soap-env:Fault>
         <faultcode>{fn:concat($fault/ctx:errorCode/text(), ' ', $body/soap-env:Fault/faultcode/text())}</faultcode>
         <faultstring>{fn:concat($body/soap-env:Fault/faultstring/text(), ' ' , $fault/ctx:reason/text())}</faultstring>
         <detail>
			{$body/soap-env:Fault/detail/*} { $fault/ctx:location}
         </detail>
</soap-env:Fault>]]></con1:xqueryText>
                        </con3:expr>
                    </con3:assign>
                    <con6:log xmlns:con6="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con5="http://www.bea.com/wli/sb/stages/alert/config" xmlns:con2="http://www.bea.com/wli/sb/stages/routing/config" xmlns:con3="http://www.bea.com/wli/sb/stages/config" xmlns:con7="http://www.bea.com/wli/sb/stages/logging/config" xmlns:aler="http://www.bea.com/wli/monitoring/alert" xmlns:con4="http://www.bea.com/wli/sb/stages/routing/config">
                        <con3:id>_ActionId-a80144d.N4531b017.0.161039720ae.N7df7</con3:id>
                        <con6:logLevel>error</con6:logLevel>
                        <con6:expr>
                            <con3:xqueryText>&lt;root>
&lt;log>
{fn:concat(
data($msgId), '|$/', 
fn:current-dateTime(), '|$/', 
if($inbound/ctx:transport/ctx:request/tp:headers/tp:user-header[@name="X-Forwarded-For"])
then
($inbound/ctx:transport/ctx:request/tp:headers/tp:user-header[@name="X-Forwarded-For"]/@value)
else
($inbound/ctx:transport/ctx:request/http:client-address), '|$/', 
$inbound/@name,'|$/',
if($inbound/ctx:service/ctx:operation) 
then ($inbound/ctx:service/ctx:operation)
else (fn:concat($inbound/ctx:transport/ctx:request/http:http-method,' ',$inbound/ctx:transport/ctx:uri)), '|$/',
'name=',fn:replace($name,'\|\$\/',';'),
',affix=',fn:replace($affix,'\|\$\/',';')
)}
&lt;/log>
{$ErrorTrace}
&lt;/root></con3:xqueryText>
                        </con6:expr>
                        <con6:message>[Orange][CCU][1.1][PublicKey_PS][publicKeyFind][Response][ErrorTrace]</con6:message>
                    </con6:log>
                    <con5:alert xmlns:con2="http://www.bea.com/wli/sb/stages/routing/config" xmlns:con5="http://www.bea.com/wli/sb/stages/alert/config" xmlns:con1="http://www.bea.com/wli/sb/stages/config">
                        <con1:id>_ActionId-a80144d.N4531b017.0.161039720ae.N7df6</con1:id>
                        <con5:destination ref="Common/Resources/Alerts/Echange_AD"/>
                        <con5:description>[Orange][CCU][1.1][PublicKey_PS][publicKeyFind][Response][ErrorTrace]</con5:description>
                        <con5:severity>critical</con5:severity>
                        <con5:payload>
                            <con1:xqueryText>$ErrorTrace</con1:xqueryText>
                        </con5:payload>
                    </con5:alert>
                    <con1:report xmlns:con4="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con3="http://www.bea.com/wli/sb/stages/routing/config" xmlns:con6="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con5="http://www.bea.com/wli/sb/typesystem/config" xmlns:con1="http://www.bea.com/wli/sb/stages/logging/config">
                        <con2:id>_ActionId-a80144d.N4531b017.0.161039720ae.N7df5</con2:id>
                        <con1:expr>
                            <con2:xqueryText>&lt;ReportResponseError>
{$ErrorTrace}
&lt;/ReportResponseError></con2:xqueryText>
                        </con1:expr>
                        <con1:labels>
                            <con1:key>messageId</con1:key>
                            <con1:varName>msgId</con1:varName>
                            <con1:value>
                                <con2:xpathText>.</con2:xpathText>
                            </con1:value>
                        </con1:labels>
                        <con1:labels>
                            <con1:key>startDateTime</con1:key>
                            <con1:varName>currentDatetime</con1:varName>
                            <con1:value>
                                <con2:xpathText>.</con2:xpathText>
                            </con1:value>
                        </con1:labels>
                        <con1:labels>
                            <con1:key>ipXForwardedFor</con1:key>
                            <con1:varName>inbound</con1:varName>
                            <con1:value>
                                <con2:xpathText>if(./ctx:transport/ctx:request/tp:headers/tp:user-header[@name="X-Forwarded-For"])
then
(./ctx:transport/ctx:request/tp:headers/tp:user-header[@name="X-Forwarded-For"]/@value)
else
(./ctx:transport/ctx:request/http:client-address)</con2:xpathText>
                            </con1:value>
                        </con1:labels>
                        <con1:labels>
                            <con1:key>operationName</con1:key>
                            <con1:varName>inbound</con1:varName>
                            <con1:value>
                                <con2:xpathText>if(./ctx:service/ctx:operation) 
then (./ctx:service/ctx:operation)
else (./ctx:transport/ctx:request/http:http-method)</con2:xpathText>
                            </con1:value>
                        </con1:labels>
                        <con1:labels>
                            <con1:key>name</con1:key>
                            <con1:varName>name</con1:varName>
                            <con1:value>
                                <con2:xpathText>.</con2:xpathText>
                            </con1:value>
                        </con1:labels>
                        <con1:labels>
                            <con1:key>affix</con1:key>
                            <con1:varName>affix</con1:varName>
                            <con1:value>
                                <con2:xpathText>.</con2:xpathText>
                            </con1:value>
                        </con1:labels>
                    </con1:report>
                    <con3:replace varName="body" contents-only="true" xmlns:con2="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con1="http://www.bea.com/wli/sb/stages/config">
                        <con1:id>_ActionId-a80144d.N4531b017.0.161039720ae.N7df4</con1:id>
                        <con3:location>
                            <con1:xpathText>.</con1:xpathText>
                        </con3:location>
                        <con3:expr>
                            <con1:xqueryText>'{
	"code": "12508",
        "message": "Response Problem",
	"infoURL": "",
	"description": ""
}'</con1:xqueryText>
                        </con3:expr>
                    </con3:replace>
                    <con3:transport-headers>
                        <con2:id>_ActionId-a80144d.N4531b017.0.161039720ae.N7df3</con2:id>
                        <con3:header-set>inbound-response</con3:header-set>
                        <con3:header name="Content-Type" value="expression">
                            <con2:xqueryText>'application/json; charset=utf-8'</con2:xqueryText>
                        </con3:header>
                    </con3:transport-headers>
                    <con6:log xmlns:con6="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con5="http://www.bea.com/wli/sb/stages/alert/config" xmlns:con2="http://www.bea.com/wli/sb/stages/routing/config" xmlns:con3="http://www.bea.com/wli/sb/stages/config" xmlns:con7="http://www.bea.com/wli/sb/stages/logging/config" xmlns:aler="http://www.bea.com/wli/monitoring/alert" xmlns:con4="http://www.bea.com/wli/sb/stages/routing/config">
                        <con3:id>_ActionId-a80144d.N4531b017.0.161039720ae.N7df2</con3:id>
                        <con6:logLevel>error</con6:logLevel>
                        <con6:expr>
                            <con3:xqueryText>&lt;root>
&lt;log>
{fn:concat(
data($msgId), '|$/', 
fn:current-dateTime(), '|$/', 
if($inbound/ctx:transport/ctx:request/tp:headers/tp:user-header[@name="X-Forwarded-For"])
then
($inbound/ctx:transport/ctx:request/tp:headers/tp:user-header[@name="X-Forwarded-For"]/@value)
else
($inbound/ctx:transport/ctx:request/http:client-address), '|$/', 
$inbound/@name,'|$/',
if($inbound/ctx:service/ctx:operation) 
then ($inbound/ctx:service/ctx:operation)
else (fn:concat($inbound/ctx:transport/ctx:request/http:http-method,' ',$inbound/ctx:transport/ctx:uri)), '|$/',
'name=',fn:replace($name,'\|\$\/',';'),
',affix=',fn:replace($affix,'\|\$\/',';')
)}
&lt;/log>
{$body}
&lt;/root></con3:xqueryText>
                        </con6:expr>
                        <con6:message>[Orange][CCU][1.1][PublicKey_PS][publicKeyFind][Response][Fault][Body after transformation]</con6:message>
                    </con6:log>
                    <con1:reply isError="true" xmlns:con2="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con1="http://www.bea.com/wli/sb/stages/config">
                        <con1:id>_ActionId-a80144d.N4531b017.0.161039720ae.N7df1</con1:id>
                    </con1:reply>
                </con:actions>
            </con:stage>
        </con:pipeline>
        <con:pipeline type="error" name="error-N3f57c7ff.N5c6fea04.0.1645fca4632.N7e2d">
            <con:stage name="ResponseProblem_cancelPublicKey" id="_StageId-N3f57c7ff.N5c6fea04.0.1645fca4632.N7e2c" xmlns:ser="http://www.bea.com/wli/sb/services" xmlns:con1="http://www.bea.com/wli/sb/stages/routing/config" xmlns:http="http://www.bea.com/wli/sb/transports/http" xmlns:oper="http://xmlns.oracle.com/servicebus/pipeline/operations" xmlns:env="http://www.bea.com/wli/config/env" xmlns:con4="http://www.bea.com/wli/sb/stages/logging/config" xmlns:tran="http://www.bea.com/wli/sb/transports" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config">
                <con:context/>
                <con:actions>
                    <con4:assign varName="currentDatetime" xmlns:con1="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con4="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con6="http://www.bea.com/wli/sb/services/security/config" xmlns:con5="http://www.bea.com/wli/sb/typesystem/config">
                        <con2:id>_ActionId-N3f57c7ff.N5c6fea04.0.1645fca4632.N7e2b</con2:id>
                        <con3:expr>
                            <con2:xqueryText>&lt;a>{fn:current-dateTime()}&lt;/a></con2:xqueryText>
                        </con3:expr>
                    </con4:assign>
                    <con6:log xmlns:con6="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con5="http://www.bea.com/wli/sb/stages/alert/config" xmlns:con2="http://www.bea.com/wli/sb/stages/routing/config" xmlns:con3="http://www.bea.com/wli/sb/stages/config" xmlns:con7="http://www.bea.com/wli/sb/stages/logging/config" xmlns:aler="http://www.bea.com/wli/monitoring/alert" xmlns:con4="http://www.bea.com/wli/sb/stages/routing/config">
                        <con3:id>_ActionId-N3f57c7ff.N5c6fea04.0.1645fca4632.N7e2a</con3:id>
                        <con6:logLevel>error</con6:logLevel>
                        <con6:expr>
                            <con3:xqueryText>&lt;root>
&lt;log>
{fn:concat(
data($msgId), '|$/', 
data($currentDatetime), '|$/', 
if($inbound/ctx:transport/ctx:request/tp:headers/tp:user-header[@name="X-Forwarded-For"])
then
($inbound/ctx:transport/ctx:request/tp:headers/tp:user-header[@name="X-Forwarded-For"]/@value)
else
($inbound/ctx:transport/ctx:request/http:client-address), '|$/', 
$inbound/@name,'|$/',
if($inbound/ctx:service/ctx:operation) 
then ($inbound/ctx:service/ctx:operation)
else (fn:concat($inbound/ctx:transport/ctx:request/http:http-method,' ',$inbound/ctx:transport/ctx:uri)), '|$/',
'id=',fn:replace($id,'\|\$\/',';'),
',basketId=',fn:replace($basketId,'\|\$\/',';'),
',defaultChannel=',fn:replace($defaultChannel,'\|\$\/',';')
)}
&lt;/log>
{$fault}
&lt;/root></con3:xqueryText>
                        </con6:expr>
                        <con6:message>[Orange][CCU][1.1][PublicKey_PS][cancel][Response][Fault]</con6:message>
                    </con6:log>
                    <con3:assign varName="ErrorTrace" xmlns:con2="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con1="http://www.bea.com/wli/sb/stages/config">
                        <con1:id>_ActionId-N3f57c7ff.N5c6fea04.0.1645fca4632.N7e29</con1:id>
                        <con3:expr>
                            <con1:xqueryText><![CDATA[<soap-env:Fault>
         <faultcode>{fn:concat($fault/ctx:errorCode/text(), ' ', $body/soap-env:Fault/faultcode/text())}</faultcode>
         <faultstring>{fn:concat($body/soap-env:Fault/faultstring/text(), ' ' , $fault/ctx:reason/text())}</faultstring>
         <detail>
			{$body/soap-env:Fault/detail/*} { $fault/ctx:location}
         </detail>
</soap-env:Fault>]]></con1:xqueryText>
                        </con3:expr>
                    </con3:assign>
                    <con6:log xmlns:con6="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con5="http://www.bea.com/wli/sb/stages/alert/config" xmlns:con2="http://www.bea.com/wli/sb/stages/routing/config" xmlns:con3="http://www.bea.com/wli/sb/stages/config" xmlns:con7="http://www.bea.com/wli/sb/stages/logging/config" xmlns:aler="http://www.bea.com/wli/monitoring/alert" xmlns:con4="http://www.bea.com/wli/sb/stages/routing/config">
                        <con3:id>_ActionId-N3f57c7ff.N5c6fea04.0.1645fca4632.N7e28</con3:id>
                        <con6:logLevel>error</con6:logLevel>
                        <con6:expr>
                            <con3:xqueryText>&lt;root>
&lt;log>
{fn:concat(
data($msgId), '|$/', 
fn:current-dateTime(), '|$/', 
if($inbound/ctx:transport/ctx:request/tp:headers/tp:user-header[@name="X-Forwarded-For"])
then
($inbound/ctx:transport/ctx:request/tp:headers/tp:user-header[@name="X-Forwarded-For"]/@value)
else
($inbound/ctx:transport/ctx:request/http:client-address), '|$/', 
$inbound/@name,'|$/',
if($inbound/ctx:service/ctx:operation) 
then ($inbound/ctx:service/ctx:operation)
else (fn:concat($inbound/ctx:transport/ctx:request/http:http-method,' ',$inbound/ctx:transport/ctx:uri)), '|$/',
'id=',fn:replace($id,'\|\$\/',';'),
',basketId=',fn:replace($basketId,'\|\$\/',';'),
',defaultChannel=',fn:replace($defaultChannel,'\|\$\/',';')
)}
&lt;/log>
{$ErrorTrace}
&lt;/root></con3:xqueryText>
                        </con6:expr>
                        <con6:message>[Orange][CCU][1.1][PublicKey_PS][cancel][Response][ErrorTrace]</con6:message>
                    </con6:log>
                    <con5:alert xmlns:con2="http://www.bea.com/wli/sb/stages/routing/config" xmlns:con5="http://www.bea.com/wli/sb/stages/alert/config" xmlns:con1="http://www.bea.com/wli/sb/stages/config">
                        <con1:id>_ActionId-N3f57c7ff.N5c6fea04.0.1645fca4632.N7e27</con1:id>
                        <con5:destination ref="Common/Resources/Alerts/Echange_AD"/>
                        <con5:description>[Orange][CCU][1.1][PublicKey_PS][cancel][Response][ErrorTrace]</con5:description>
                        <con5:severity>critical</con5:severity>
                        <con5:payload>
                            <con1:xqueryText>$ErrorTrace</con1:xqueryText>
                        </con5:payload>
                    </con5:alert>
                    <con1:report xmlns:con4="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con3="http://www.bea.com/wli/sb/stages/routing/config" xmlns:con6="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con5="http://www.bea.com/wli/sb/typesystem/config" xmlns:con1="http://www.bea.com/wli/sb/stages/logging/config">
                        <con2:id>_ActionId-N3f57c7ff.N5c6fea04.0.1645fca4632.N7e26</con2:id>
                        <con1:expr>
                            <con2:xqueryText>&lt;ReportResponseError>
{$ErrorTrace}
&lt;/ReportResponseError></con2:xqueryText>
                        </con1:expr>
                        <con1:labels>
                            <con1:key>messageId</con1:key>
                            <con1:varName>msgId</con1:varName>
                            <con1:value>
                                <con2:xpathText>.</con2:xpathText>
                            </con1:value>
                        </con1:labels>
                        <con1:labels>
                            <con1:key>startDateTime</con1:key>
                            <con1:varName>currentDatetime</con1:varName>
                            <con1:value>
                                <con2:xpathText>.</con2:xpathText>
                            </con1:value>
                        </con1:labels>
                        <con1:labels>
                            <con1:key>ipXForwardedFor</con1:key>
                            <con1:varName>inbound</con1:varName>
                            <con1:value>
                                <con2:xpathText>if(./ctx:transport/ctx:request/tp:headers/tp:user-header[@name="X-Forwarded-For"])
then
(./ctx:transport/ctx:request/tp:headers/tp:user-header[@name="X-Forwarded-For"]/@value)
else
(./ctx:transport/ctx:request/http:client-address)</con2:xpathText>
                            </con1:value>
                        </con1:labels>
                        <con1:labels>
                            <con1:key>operationName</con1:key>
                            <con1:varName>inbound</con1:varName>
                            <con1:value>
                                <con2:xpathText>if(./ctx:service/ctx:operation) 
then (./ctx:service/ctx:operation)
else (./ctx:transport/ctx:request/http:http-method)</con2:xpathText>
                            </con1:value>
                        </con1:labels>
                        <con1:labels>
                            <con1:key>id</con1:key>
                            <con1:varName>id</con1:varName>
                            <con1:value>
                                <con2:xpathText>.</con2:xpathText>
                            </con1:value>
                        </con1:labels>
                        <con1:labels>
                            <con1:key>basketId</con1:key>
                            <con1:varName>basketId</con1:varName>
                            <con1:value>
                                <con2:xpathText>.</con2:xpathText>
                            </con1:value>
                        </con1:labels>
                        <con1:labels>
                            <con1:key>defaultChannel</con1:key>
                            <con1:varName>defaultChannel</con1:varName>
                            <con1:value>
                                <con2:xpathText>.</con2:xpathText>
                            </con1:value>
                        </con1:labels>
                    </con1:report>
                    <con3:replace varName="body" contents-only="true" xmlns:con2="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con1="http://www.bea.com/wli/sb/stages/config">
                        <con1:id>_ActionId-N3f57c7ff.N5c6fea04.0.1645fca4632.N7e25</con1:id>
                        <con3:location>
                            <con1:xpathText>.</con1:xpathText>
                        </con3:location>
                        <con3:expr>
                            <con1:xqueryText>'{
	"code": "12508",
        "message": "Response Problem",
	"infoURL": "",
	"description": ""
}'</con1:xqueryText>
                        </con3:expr>
                    </con3:replace>
                    <con3:transport-headers>
                        <con2:id>_ActionId-N3f57c7ff.N5c6fea04.0.1645fca4632.N7e24</con2:id>
                        <con3:header-set>inbound-response</con3:header-set>
                        <con3:header name="Content-Type" value="expression">
                            <con2:xqueryText>'application/json; charset=utf-8'</con2:xqueryText>
                        </con3:header>
                    </con3:transport-headers>
                    <con6:log xmlns:con6="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con5="http://www.bea.com/wli/sb/stages/alert/config" xmlns:con2="http://www.bea.com/wli/sb/stages/routing/config" xmlns:con3="http://www.bea.com/wli/sb/stages/config" xmlns:con7="http://www.bea.com/wli/sb/stages/logging/config" xmlns:aler="http://www.bea.com/wli/monitoring/alert" xmlns:con4="http://www.bea.com/wli/sb/stages/routing/config">
                        <con3:id>_ActionId-N3f57c7ff.N5c6fea04.0.1645fca4632.N7e23</con3:id>
                        <con6:logLevel>error</con6:logLevel>
                        <con6:expr>
                            <con3:xqueryText>&lt;root>
&lt;log>
{fn:concat(
data($msgId), '|$/', 
fn:current-dateTime(), '|$/', 
if($inbound/ctx:transport/ctx:request/tp:headers/tp:user-header[@name="X-Forwarded-For"])
then
($inbound/ctx:transport/ctx:request/tp:headers/tp:user-header[@name="X-Forwarded-For"]/@value)
else
($inbound/ctx:transport/ctx:request/http:client-address), '|$/', 
$inbound/@name,'|$/',
if($inbound/ctx:service/ctx:operation) 
then ($inbound/ctx:service/ctx:operation)
else (fn:concat($inbound/ctx:transport/ctx:request/http:http-method,' ',$inbound/ctx:transport/ctx:uri)), '|$/',
'id=',fn:replace($id,'\|\$\/',';'),
',basketId=',fn:replace($basketId,'\|\$\/',';'),
',defaultChannel=',fn:replace($defaultChannel,'\|\$\/',';')
)}
&lt;/log>
{$body}
&lt;/root></con3:xqueryText>
                        </con6:expr>
                        <con6:message>[Orange][CCU][1.1][PublicKey_PS][cancel][Response][Fault][Body after transformation]</con6:message>
                    </con6:log>
                    <con1:reply isError="true" xmlns:con2="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con1="http://www.bea.com/wli/sb/stages/config">
                        <con1:id>_ActionId-N3f57c7ff.N5c6fea04.0.1645fca4632.N7e22</con1:id>
                    </con1:reply>
                </con:actions>
            </con:stage>
        </con:pipeline>
        <con:pipeline type="error" name="error-N3f57d476.5236328e.0.15fa1055b7f.N7ac7">
            <con:stage id="_StageId-N3f57c7ff.46346a1f.0.163823b1586.N7efe" name="InvocationProblem_findPublicKey">
                <con:context/>
                <con:actions>
                    <con3:assign varName="currentDatetime" xmlns:con1="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con4="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con6="http://www.bea.com/wli/sb/services/security/config" xmlns:con5="http://www.bea.com/wli/sb/typesystem/config" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config" xmlns:ser="http://www.bea.com/wli/sb/services" xmlns:env="http://www.bea.com/wli/config/env" xmlns:http="http://www.bea.com/wli/sb/transports/http" xmlns:oper="http://xmlns.oracle.com/servicebus/pipeline/operations" xmlns:tran="http://www.bea.com/wli/sb/transports">
                        <con2:id>_ActionId-a80144d.N4531b017.0.161039720ae.N7d0b</con2:id>
                        <con3:expr>
                            <con2:xqueryText>&lt;a>{fn:current-dateTime()}&lt;/a></con2:xqueryText>
                        </con3:expr>
                    </con3:assign>
                    <con7:log xmlns:con6="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con2="http://www.bea.com/wli/sb/stages/routing/config" xmlns:con3="http://www.bea.com/wli/sb/stages/config" xmlns:con7="http://www.bea.com/wli/sb/stages/logging/config" xmlns:aler="http://www.bea.com/wli/monitoring/alert" xmlns:ser="http://www.bea.com/wli/sb/services" xmlns:env="http://www.bea.com/wli/config/env" xmlns:http="http://www.bea.com/wli/sb/transports/http" xmlns:oper="http://xmlns.oracle.com/servicebus/pipeline/operations" xmlns:con5="http://www.bea.com/wli/sb/stages/alert/config" xmlns:tran="http://www.bea.com/wli/sb/transports">
                        <con3:id>_ActionId-a80144d.N4531b017.0.161039720ae.N7d0a</con3:id>
                        <con6:logLevel>error</con6:logLevel>
                        <con6:expr>
                            <con3:xqueryText>&lt;root>
&lt;log>
{fn:concat(
data($msgId), '|$/', 
data($currentDatetime), '|$/', 
if($inbound/ctx:transport/ctx:request/tp:headers/tp:user-header[@name="X-Forwarded-For"])
then
($inbound/ctx:transport/ctx:request/tp:headers/tp:user-header[@name="X-Forwarded-For"]/@value)
else
($inbound/ctx:transport/ctx:request/http:client-address), '|$/', 
$inbound/@name,'|$/',
if($inbound/ctx:service/ctx:operation) 
then ($inbound/ctx:service/ctx:operation)
else (fn:concat($inbound/ctx:transport/ctx:request/http:http-method,' ',$inbound/ctx:transport/ctx:uri)), '|$/',
'name=',fn:replace($name,'\|\$\/',';'),
',affix=',fn:replace($affix,'\|\$\/',';')
)}
&lt;/log>
{$fault}
&lt;/root></con3:xqueryText>
                        </con6:expr>
                        <con6:message>[Orange][CCU][1.1][PublicKey_PS][publicKeyFind][Invocation][Fault]</con6:message>
                    </con7:log>
                    <con6:assign varName="ErrorTrace" xmlns:con2="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con1="http://www.bea.com/wli/sb/stages/config" xmlns:con4="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config" xmlns:ser="http://www.bea.com/wli/sb/services" xmlns:env="http://www.bea.com/wli/config/env" xmlns:http="http://www.bea.com/wli/sb/transports/http" xmlns:con6="http://www.bea.com/wli/sb/stages/transform/config" xmlns:oper="http://xmlns.oracle.com/servicebus/pipeline/operations" xmlns:con5="http://www.bea.com/wli/sb/stages/alert/config" xmlns:tran="http://www.bea.com/wli/sb/transports">
                        <con1:id>_ActionId-a80144d.N4531b017.0.161039720ae.N7d09</con1:id>
                        <con3:expr>
                            <con1:xqueryText><![CDATA[<soap-env:Fault>
         <faultcode>{fn:concat($fault/ctx:errorCode/text(), ' ', $body/soap-env:Fault/faultcode/text())}</faultcode>
         <faultstring>{fn:concat($body/soap-env:Fault/faultstring/text(), ' ' , $fault/ctx:reason/text())}</faultstring>
         <detail>
			{$body/soap-env:Fault/detail/*} { $fault/ctx:location}
         </detail>
</soap-env:Fault>]]></con1:xqueryText>
                        </con3:expr>
                    </con6:assign>
                    <con7:log xmlns:con6="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con2="http://www.bea.com/wli/sb/stages/routing/config" xmlns:con3="http://www.bea.com/wli/sb/stages/config" xmlns:con7="http://www.bea.com/wli/sb/stages/logging/config" xmlns:aler="http://www.bea.com/wli/monitoring/alert" xmlns:ser="http://www.bea.com/wli/sb/services" xmlns:env="http://www.bea.com/wli/config/env" xmlns:http="http://www.bea.com/wli/sb/transports/http" xmlns:oper="http://xmlns.oracle.com/servicebus/pipeline/operations" xmlns:con5="http://www.bea.com/wli/sb/stages/alert/config" xmlns:tran="http://www.bea.com/wli/sb/transports">
                        <con3:id>_ActionId-a80144d.N4531b017.0.161039720ae.N7d08</con3:id>
                        <con6:logLevel>error</con6:logLevel>
                        <con6:expr>
                            <con3:xqueryText>&lt;root>
&lt;log>
{fn:concat(
data($msgId), '|$/', 
fn:current-dateTime(), '|$/', 
if($inbound/ctx:transport/ctx:request/tp:headers/tp:user-header[@name="X-Forwarded-For"])
then
($inbound/ctx:transport/ctx:request/tp:headers/tp:user-header[@name="X-Forwarded-For"]/@value)
else
($inbound/ctx:transport/ctx:request/http:client-address), '|$/', 
$inbound/@name,'|$/',
if($inbound/ctx:service/ctx:operation) 
then ($inbound/ctx:service/ctx:operation)
else (fn:concat($inbound/ctx:transport/ctx:request/http:http-method,' ',$inbound/ctx:transport/ctx:uri)), '|$/',
'name=',fn:replace($name,'\|\$\/',';'),
',affix=',fn:replace($affix,'\|\$\/',';')
)}
&lt;/log>
{$ErrorTrace}
&lt;/root></con3:xqueryText>
                        </con6:expr>
                        <con6:message>[Orange][CCU][1.1][PublicKey_PS][publicKeyFind][Invocation][ErrorTrace]</con6:message>
                    </con7:log>
                    <con5:alert xmlns:con2="http://www.bea.com/wli/sb/stages/routing/config" xmlns:con1="http://www.bea.com/wli/sb/stages/config" xmlns:con4="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config" xmlns:ser="http://www.bea.com/wli/sb/services" xmlns:env="http://www.bea.com/wli/config/env" xmlns:http="http://www.bea.com/wli/sb/transports/http" xmlns:con6="http://www.bea.com/wli/sb/stages/transform/config" xmlns:oper="http://xmlns.oracle.com/servicebus/pipeline/operations" xmlns:con5="http://www.bea.com/wli/sb/stages/alert/config" xmlns:tran="http://www.bea.com/wli/sb/transports">
                        <con1:id>_ActionId-a80144d.N4531b017.0.161039720ae.N7d07</con1:id>
                        <con5:destination ref="Common/Resources/Alerts/Echange_AD"/>
                        <con5:description>[Orange][CCU][1.1][PublicKey_PS][publicKeyFind][Invocation][ErrorTrace]</con5:description>
                        <con5:severity>critical</con5:severity>
                        <con5:payload>
                            <con1:xqueryText>$ErrorTrace</con1:xqueryText>
                        </con5:payload>
                    </con5:alert>
                    <con1:report xmlns:con4="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con3="http://www.bea.com/wli/sb/stages/routing/config" xmlns:con6="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con5="http://www.bea.com/wli/sb/typesystem/config" xmlns:con1="http://www.bea.com/wli/sb/stages/logging/config" xmlns:ser="http://www.bea.com/wli/sb/services" xmlns:env="http://www.bea.com/wli/config/env" xmlns:http="http://www.bea.com/wli/sb/transports/http" xmlns:oper="http://xmlns.oracle.com/servicebus/pipeline/operations" xmlns:tran="http://www.bea.com/wli/sb/transports">
                        <con2:id>_ActionId-a80144d.N4531b017.0.161039720ae.N7d06</con2:id>
                        <con1:expr>
                            <con2:xqueryText>&lt;ReportInvocationError>
{$ErrorTrace}
&lt;/ReportInvocationError></con2:xqueryText>
                        </con1:expr>
                        <con1:labels>
                            <con1:key>messageId</con1:key>
                            <con1:varName>msgId</con1:varName>
                            <con1:value>
                                <con2:xpathText>.</con2:xpathText>
                            </con1:value>
                        </con1:labels>
                        <con1:labels>
                            <con1:key>startDateTime</con1:key>
                            <con1:varName>currentDatetime</con1:varName>
                            <con1:value>
                                <con2:xpathText>.</con2:xpathText>
                            </con1:value>
                        </con1:labels>
                        <con1:labels>
                            <con1:key>ipXForwardedFor</con1:key>
                            <con1:varName>inbound</con1:varName>
                            <con1:value>
                                <con2:xpathText>if(./ctx:transport/ctx:request/tp:headers/tp:user-header[@name="X-Forwarded-For"])
then
(./ctx:transport/ctx:request/tp:headers/tp:user-header[@name="X-Forwarded-For"]/@value)
else
(./ctx:transport/ctx:request/http:client-address)</con2:xpathText>
                            </con1:value>
                        </con1:labels>
                        <con1:labels>
                            <con1:key>operationName</con1:key>
                            <con1:varName>inbound</con1:varName>
                            <con1:value>
                                <con2:xpathText>if(./ctx:service/ctx:operation) 
then (./ctx:service/ctx:operation)
else (./ctx:transport/ctx:request/http:http-method)</con2:xpathText>
                            </con1:value>
                        </con1:labels>
                        <con1:labels>
                            <con1:key>name</con1:key>
                            <con1:varName>name</con1:varName>
                            <con1:value>
                                <con2:xpathText>.</con2:xpathText>
                            </con1:value>
                        </con1:labels>
                        <con1:labels>
                            <con1:key>affix</con1:key>
                            <con1:varName>affix</con1:varName>
                            <con1:value>
                                <con2:xpathText>.</con2:xpathText>
                            </con1:value>
                        </con1:labels>
                    </con1:report>
                    <con6:replace varName="body" contents-only="true" xmlns:con1="http://www.bea.com/wli/sb/stages/routing/config" xmlns:con4="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config" xmlns:ser="http://www.bea.com/wli/sb/services" xmlns:env="http://www.bea.com/wli/config/env" xmlns:http="http://www.bea.com/wli/sb/transports/http" xmlns:con6="http://www.bea.com/wli/sb/stages/transform/config" xmlns:oper="http://xmlns.oracle.com/servicebus/pipeline/operations" xmlns:con5="http://www.bea.com/wli/sb/stages/alert/config" xmlns:tran="http://www.bea.com/wli/sb/transports">
                        <con2:id>_ActionId-a80144d.N4531b017.0.161039720ae.N7d05</con2:id>
                        <con3:location>
                            <con2:xpathText>.</con2:xpathText>
                        </con3:location>
                        <con3:expr>
                            <con2:xqueryText>'{
	"code": "12501",
        "message": "Invocation problem",
	"infoURL": "",
	"description": ""
}'</con2:xqueryText>
                        </con3:expr>
                    </con6:replace>
                    <con6:transport-headers xmlns:con1="http://www.bea.com/wli/sb/stages/routing/config" xmlns:con4="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config" xmlns:ser="http://www.bea.com/wli/sb/services" xmlns:env="http://www.bea.com/wli/config/env" xmlns:http="http://www.bea.com/wli/sb/transports/http" xmlns:con6="http://www.bea.com/wli/sb/stages/transform/config" xmlns:oper="http://xmlns.oracle.com/servicebus/pipeline/operations" xmlns:con5="http://www.bea.com/wli/sb/stages/alert/config" xmlns:tran="http://www.bea.com/wli/sb/transports">
                        <con2:id>_ActionId-a80144d.N4531b017.0.161039720ae.N7d04</con2:id>
                        <con3:header-set>inbound-response</con3:header-set>
                        <con3:header name="Content-Type" value="expression">
                            <con2:xqueryText>'application/json; charset=utf-8'</con2:xqueryText>
                        </con3:header>
                    </con6:transport-headers>
                    <con7:log xmlns:con6="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con2="http://www.bea.com/wli/sb/stages/routing/config" xmlns:con3="http://www.bea.com/wli/sb/stages/config" xmlns:con7="http://www.bea.com/wli/sb/stages/logging/config" xmlns:aler="http://www.bea.com/wli/monitoring/alert" xmlns:ser="http://www.bea.com/wli/sb/services" xmlns:env="http://www.bea.com/wli/config/env" xmlns:http="http://www.bea.com/wli/sb/transports/http" xmlns:oper="http://xmlns.oracle.com/servicebus/pipeline/operations" xmlns:con5="http://www.bea.com/wli/sb/stages/alert/config" xmlns:tran="http://www.bea.com/wli/sb/transports">
                        <con3:id>_ActionId-a80144d.N4531b017.0.161039720ae.N7d03</con3:id>
                        <con6:logLevel>error</con6:logLevel>
                        <con6:expr>
                            <con3:xqueryText>&lt;root>
&lt;log>
{fn:concat(
data($msgId), '|$/', 
fn:current-dateTime(), '|$/', 
if($inbound/ctx:transport/ctx:request/tp:headers/tp:user-header[@name="X-Forwarded-For"])
then
($inbound/ctx:transport/ctx:request/tp:headers/tp:user-header[@name="X-Forwarded-For"]/@value)
else
($inbound/ctx:transport/ctx:request/http:client-address), '|$/', 
$inbound/@name,'|$/',
if($inbound/ctx:service/ctx:operation) 
then ($inbound/ctx:service/ctx:operation)
else (fn:concat($inbound/ctx:transport/ctx:request/http:http-method,' ',$inbound/ctx:transport/ctx:uri)), '|$/',
'name=',fn:replace($name,'\|\$\/',';'),
',affix=',fn:replace($affix,'\|\$\/',';')
)}
&lt;/log>
{$body}
&lt;/root></con3:xqueryText>
                        </con6:expr>
                        <con6:message>[Orange][CCU][1.1][PublicKey_PS][publicKeyFind][Invocation][Fault][Body after transformation]</con6:message>
                    </con7:log>
                    <con1:reply isError="true" xmlns:con2="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con1="http://www.bea.com/wli/sb/stages/config" xmlns:con4="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config" xmlns:ser="http://www.bea.com/wli/sb/services" xmlns:env="http://www.bea.com/wli/config/env" xmlns:http="http://www.bea.com/wli/sb/transports/http" xmlns:con6="http://www.bea.com/wli/sb/stages/transform/config" xmlns:oper="http://xmlns.oracle.com/servicebus/pipeline/operations" xmlns:con5="http://www.bea.com/wli/sb/stages/alert/config" xmlns:tran="http://www.bea.com/wli/sb/transports">
                        <con1:id>_ActionId-a80144d.N4531b017.0.161039720ae.N7d02</con1:id>
                    </con1:reply>
                </con:actions>
            </con:stage>
        </con:pipeline>
        <con:pipeline type="error" name="error-N53efef3d.3f35d53b.0.16b88fa0ffb.N7ea8">
            <con:stage name="RequestProblem_reservePublicKey" id="_StageId-N53efef3d.3f35d53b.0.16b88fa0ffb.N7ea7" xmlns:ser="http://www.bea.com/wli/sb/services" xmlns:con1="http://www.bea.com/wli/sb/stages/routing/config" xmlns:http="http://www.bea.com/wli/sb/transports/http" xmlns:oper="http://xmlns.oracle.com/servicebus/pipeline/operations" xmlns:env="http://www.bea.com/wli/config/env" xmlns:con4="http://www.bea.com/wli/sb/stages/logging/config" xmlns:tran="http://www.bea.com/wli/sb/transports" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config">
                <con:context/>
                <con:actions>
                    <con4:assign varName="currentDatetime" xmlns:con1="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con4="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con6="http://www.bea.com/wli/sb/services/security/config" xmlns:con5="http://www.bea.com/wli/sb/typesystem/config">
                        <con2:id>_ActionId-N53efef3d.3f35d53b.0.16b88fa0ffb.N7ea6</con2:id>
                        <con3:expr>
                            <con2:xqueryText>&lt;a>{fn:current-dateTime()}&lt;/a></con2:xqueryText>
                        </con3:expr>
                    </con4:assign>
                    <con6:log xmlns:con6="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con5="http://www.bea.com/wli/sb/stages/alert/config" xmlns:con2="http://www.bea.com/wli/sb/stages/routing/config" xmlns:con3="http://www.bea.com/wli/sb/stages/config" xmlns:con7="http://www.bea.com/wli/sb/stages/logging/config" xmlns:aler="http://www.bea.com/wli/monitoring/alert" xmlns:con4="http://www.bea.com/wli/sb/stages/routing/config">
                        <con3:id>_ActionId-N53efef3d.3f35d53b.0.16b88fa0ffb.N7ea5</con3:id>
                        <con6:logLevel>error</con6:logLevel>
                        <con6:expr>
                            <con3:xqueryText>&lt;root>
&lt;log>
{fn:concat(
data($msgId), '|$/', 
data($currentDatetime), '|$/', 
if($inbound/ctx:transport/ctx:request/tp:headers/tp:user-header[@name="X-Forwarded-For"])
then
($inbound/ctx:transport/ctx:request/tp:headers/tp:user-header[@name="X-Forwarded-For"]/@value)
else
($inbound/ctx:transport/ctx:request/http:client-address), '|$/', 
$inbound/@name,'|$/',
if($inbound/ctx:service/ctx:operation) 
then ($inbound/ctx:service/ctx:operation)
else (fn:concat($inbound/ctx:transport/ctx:request/http:http-method,' ',$inbound/ctx:transport/ctx:uri)), '|$/',
'id=',fn:replace($id,'\|\$\/',';'),
',basketId=',fn:replace($basketId,'\|\$\/',';'),
',defaultChannel=',fn:replace($defaultChannel,'\|\$\/',';')
)}
&lt;/log>
{$fault}
&lt;/root></con3:xqueryText>
                        </con6:expr>
                        <con6:message>[Orange][CCU][1.1][PublicKey_PS][reserve][Request][Fault]</con6:message>
                    </con6:log>
                    <con3:assign varName="ErrorTrace" xmlns:con2="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con1="http://www.bea.com/wli/sb/stages/config">
                        <con1:id>_ActionId-N53efef3d.3f35d53b.0.16b88fa0ffb.N7ea4</con1:id>
                        <con3:expr>
                            <con1:xqueryText><![CDATA[<soap-env:Fault>
         <faultcode>{fn:concat($fault/ctx:errorCode/text(), ' ', $body/soap-env:Fault/faultcode/text())}</faultcode>
         <faultstring>{fn:concat($body/soap-env:Fault/faultstring/text(), ' ' , $fault/ctx:reason/text())}</faultstring>
         <detail>
			{$body/soap-env:Fault/detail/*} { $fault/ctx:location}
         </detail>
</soap-env:Fault>]]></con1:xqueryText>
                        </con3:expr>
                    </con3:assign>
                    <con6:log xmlns:con6="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con5="http://www.bea.com/wli/sb/stages/alert/config" xmlns:con2="http://www.bea.com/wli/sb/stages/routing/config" xmlns:con3="http://www.bea.com/wli/sb/stages/config" xmlns:con7="http://www.bea.com/wli/sb/stages/logging/config" xmlns:aler="http://www.bea.com/wli/monitoring/alert" xmlns:con4="http://www.bea.com/wli/sb/stages/routing/config">
                        <con3:id>_ActionId-N53efef3d.3f35d53b.0.16b88fa0ffb.N7ea3</con3:id>
                        <con6:logLevel>error</con6:logLevel>
                        <con6:expr>
                            <con3:xqueryText>&lt;root>
&lt;log>
{fn:concat(
data($msgId), '|$/', 
fn:current-dateTime(), '|$/', 
if($inbound/ctx:transport/ctx:request/tp:headers/tp:user-header[@name="X-Forwarded-For"])
then
($inbound/ctx:transport/ctx:request/tp:headers/tp:user-header[@name="X-Forwarded-For"]/@value)
else
($inbound/ctx:transport/ctx:request/http:client-address), '|$/', 
$inbound/@name,'|$/',
if($inbound/ctx:service/ctx:operation) 
then ($inbound/ctx:service/ctx:operation)
else (fn:concat($inbound/ctx:transport/ctx:request/http:http-method,' ',$inbound/ctx:transport/ctx:uri)), '|$/',
'id=',fn:replace($id,'\|\$\/',';'),
',basketId=',fn:replace($basketId,'\|\$\/',';'),
',defaultChannel=',fn:replace($defaultChannel,'\|\$\/',';')
)}
&lt;/log>
{$ErrorTrace}
&lt;/root></con3:xqueryText>
                        </con6:expr>
                        <con6:message>[Orange][CCU][1.1][PublicKey_PS][reserve][Request][ErrorTrace]</con6:message>
                    </con6:log>
                    <con5:alert xmlns:con2="http://www.bea.com/wli/sb/stages/routing/config" xmlns:con5="http://www.bea.com/wli/sb/stages/alert/config" xmlns:con1="http://www.bea.com/wli/sb/stages/config">
                        <con1:id>_ActionId-N53efef3d.3f35d53b.0.16b88fa0ffb.N7ea2</con1:id>
                        <con5:destination ref="Common/Resources/Alerts/Echange_AD"/>
                        <con5:description>[Orange][CCU][1.1][PublicKey_PS][reserve][Request][ErrorTrace]</con5:description>
                        <con5:severity>critical</con5:severity>
                        <con5:payload>
                            <con1:xqueryText>$ErrorTrace</con1:xqueryText>
                        </con5:payload>
                    </con5:alert>
                    <con1:report xmlns:con4="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con3="http://www.bea.com/wli/sb/stages/routing/config" xmlns:con6="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con5="http://www.bea.com/wli/sb/typesystem/config" xmlns:con1="http://www.bea.com/wli/sb/stages/logging/config">
                        <con2:id>_ActionId-N53efef3d.3f35d53b.0.16b88fa0ffb.N7ea1</con2:id>
                        <con1:expr>
                            <con2:xqueryText>&lt;ReportRequestError>
{$ErrorTrace}
&lt;/ReportRequestError></con2:xqueryText>
                        </con1:expr>
                        <con1:labels>
                            <con1:key>messageId</con1:key>
                            <con1:varName>msgId</con1:varName>
                            <con1:value>
                                <con2:xpathText>.</con2:xpathText>
                            </con1:value>
                        </con1:labels>
                        <con1:labels>
                            <con1:key>startDateTime</con1:key>
                            <con1:varName>currentDatetime</con1:varName>
                            <con1:value>
                                <con2:xpathText>.</con2:xpathText>
                            </con1:value>
                        </con1:labels>
                        <con1:labels>
                            <con1:key>ipXForwardedFor</con1:key>
                            <con1:varName>inbound</con1:varName>
                            <con1:value>
                                <con2:xpathText>if(./ctx:transport/ctx:request/tp:headers/tp:user-header[@name="X-Forwarded-For"])
then
(./ctx:transport/ctx:request/tp:headers/tp:user-header[@name="X-Forwarded-For"]/@value)
else
(./ctx:transport/ctx:request/http:client-address)</con2:xpathText>
                            </con1:value>
                        </con1:labels>
                        <con1:labels>
                            <con1:key>operationName</con1:key>
                            <con1:varName>inbound</con1:varName>
                            <con1:value>
                                <con2:xpathText>if(./ctx:service/ctx:operation) 
then (./ctx:service/ctx:operation)
else (./ctx:transport/ctx:request/http:http-method)</con2:xpathText>
                            </con1:value>
                        </con1:labels>
                        <con1:labels>
                            <con1:key>id</con1:key>
                            <con1:varName>id</con1:varName>
                            <con1:value>
                                <con2:xpathText>.</con2:xpathText>
                            </con1:value>
                        </con1:labels>
                        <con1:labels>
                            <con1:key>basketId</con1:key>
                            <con1:varName>basketId</con1:varName>
                            <con1:value>
                                <con2:xpathText>.</con2:xpathText>
                            </con1:value>
                        </con1:labels>
                        <con1:labels>
                            <con1:key>defaultChannel</con1:key>
                            <con1:varName>defaultChannel</con1:varName>
                            <con1:value>
                                <con2:xpathText>.</con2:xpathText>
                            </con1:value>
                        </con1:labels>
                    </con1:report>
                    <con3:replace varName="body" contents-only="true">
                        <con2:id>_ActionId-N53efef3d.3f35d53b.0.16b88fa0ffb.N7ea0</con2:id>
                        <con3:location>
                            <con2:xpathText>.</con2:xpathText>
                        </con3:location>
                        <con3:expr>
                            <con2:xqueryText>'{
	"code": "12507",
        "message": "Request Problem",
	"infoURL": "",
	"description": ""
}'</con2:xqueryText>
                        </con3:expr>
                    </con3:replace>
                    <con3:transport-headers>
                        <con2:id>_ActionId-N53efef3d.3f35d53b.0.16b88fa0ffb.N7e9f</con2:id>
                        <con3:header-set>inbound-response</con3:header-set>
                        <con3:header name="Content-Type" value="expression">
                            <con2:xqueryText>'application/json; charset=utf-8'</con2:xqueryText>
                        </con3:header>
                    </con3:transport-headers>
                    <con6:log xmlns:con6="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con5="http://www.bea.com/wli/sb/stages/alert/config" xmlns:con2="http://www.bea.com/wli/sb/stages/routing/config" xmlns:con3="http://www.bea.com/wli/sb/stages/config" xmlns:con7="http://www.bea.com/wli/sb/stages/logging/config" xmlns:aler="http://www.bea.com/wli/monitoring/alert" xmlns:con4="http://www.bea.com/wli/sb/stages/routing/config">
                        <con3:id>_ActionId-N53efef3d.3f35d53b.0.16b88fa0ffb.N7e9e</con3:id>
                        <con6:logLevel>error</con6:logLevel>
                        <con6:expr>
                            <con3:xqueryText>&lt;root>
&lt;log>
{fn:concat(
data($msgId), '|$/', 
fn:current-dateTime(), '|$/', 
if($inbound/ctx:transport/ctx:request/tp:headers/tp:user-header[@name="X-Forwarded-For"])
then
($inbound/ctx:transport/ctx:request/tp:headers/tp:user-header[@name="X-Forwarded-For"]/@value)
else
($inbound/ctx:transport/ctx:request/http:client-address), '|$/', 
$inbound/@name,'|$/',
if($inbound/ctx:service/ctx:operation) 
then ($inbound/ctx:service/ctx:operation)
else (fn:concat($inbound/ctx:transport/ctx:request/http:http-method,' ',$inbound/ctx:transport/ctx:uri)), '|$/',
'id=',fn:replace($id,'\|\$\/',';'),
',basketId=',fn:replace($basketId,'\|\$\/',';'),
',defaultChannel=',fn:replace($defaultChannel,'\|\$\/',';')
)}
&lt;/log>
{$body}
&lt;/root></con3:xqueryText>
                        </con6:expr>
                        <con6:message>[Orange][CCU][1.1][PublicKey_PS][reserve][Request][Fault][Body after transformation]</con6:message>
                    </con6:log>
                    <con1:reply isError="true" xmlns:con2="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con1="http://www.bea.com/wli/sb/stages/config">
                        <con1:id>_ActionId-N53efef3d.3f35d53b.0.16b88fa0ffb.N7e9d</con1:id>
                    </con1:reply>
                </con:actions>
            </con:stage>
        </con:pipeline>
        <con:pipeline type="error" name="error-N3f57c7ff.N5c6fea04.0.1645fca4632.N7e4c">
            <con:stage name="RequestProblem_cancelPublicKey" id="_StageId-N3f57c7ff.N5c6fea04.0.1645fca4632.N7e4b" xmlns:ser="http://www.bea.com/wli/sb/services" xmlns:con1="http://www.bea.com/wli/sb/stages/routing/config" xmlns:http="http://www.bea.com/wli/sb/transports/http" xmlns:oper="http://xmlns.oracle.com/servicebus/pipeline/operations" xmlns:env="http://www.bea.com/wli/config/env" xmlns:con4="http://www.bea.com/wli/sb/stages/logging/config" xmlns:tran="http://www.bea.com/wli/sb/transports" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config">
                <con:context/>
                <con:actions>
                    <con4:assign varName="currentDatetime" xmlns:con1="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con4="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con6="http://www.bea.com/wli/sb/services/security/config" xmlns:con5="http://www.bea.com/wli/sb/typesystem/config">
                        <con2:id>_ActionId-N3f57c7ff.N5c6fea04.0.1645fca4632.N7e4a</con2:id>
                        <con3:expr>
                            <con2:xqueryText>&lt;a>{fn:current-dateTime()}&lt;/a></con2:xqueryText>
                        </con3:expr>
                    </con4:assign>
                    <con6:log xmlns:con6="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con5="http://www.bea.com/wli/sb/stages/alert/config" xmlns:con2="http://www.bea.com/wli/sb/stages/routing/config" xmlns:con3="http://www.bea.com/wli/sb/stages/config" xmlns:con7="http://www.bea.com/wli/sb/stages/logging/config" xmlns:aler="http://www.bea.com/wli/monitoring/alert" xmlns:con4="http://www.bea.com/wli/sb/stages/routing/config">
                        <con3:id>_ActionId-N3f57c7ff.N5c6fea04.0.1645fca4632.N7e49</con3:id>
                        <con6:logLevel>error</con6:logLevel>
                        <con6:expr>
                            <con3:xqueryText>&lt;root>
&lt;log>
{fn:concat(
data($msgId), '|$/', 
data($currentDatetime), '|$/', 
if($inbound/ctx:transport/ctx:request/tp:headers/tp:user-header[@name="X-Forwarded-For"])
then
($inbound/ctx:transport/ctx:request/tp:headers/tp:user-header[@name="X-Forwarded-For"]/@value)
else
($inbound/ctx:transport/ctx:request/http:client-address), '|$/', 
$inbound/@name,'|$/',
if($inbound/ctx:service/ctx:operation) 
then ($inbound/ctx:service/ctx:operation)
else (fn:concat($inbound/ctx:transport/ctx:request/http:http-method,' ',$inbound/ctx:transport/ctx:uri)), '|$/',
'id=',fn:replace($id,'\|\$\/',';'),
',basketId=',fn:replace($basketId,'\|\$\/',';'),
',defaultChannel=',fn:replace($defaultChannel,'\|\$\/',';')
)}
&lt;/log>
{$fault}
&lt;/root></con3:xqueryText>
                        </con6:expr>
                        <con6:message>[Orange][CCU][1.1][PublicKey_PS][cancel][Request][Fault]</con6:message>
                    </con6:log>
                    <con3:assign varName="ErrorTrace" xmlns:con2="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con1="http://www.bea.com/wli/sb/stages/config">
                        <con1:id>_ActionId-N3f57c7ff.N5c6fea04.0.1645fca4632.N7e48</con1:id>
                        <con3:expr>
                            <con1:xqueryText><![CDATA[<soap-env:Fault>
         <faultcode>{fn:concat($fault/ctx:errorCode/text(), ' ', $body/soap-env:Fault/faultcode/text())}</faultcode>
         <faultstring>{fn:concat($body/soap-env:Fault/faultstring/text(), ' ' , $fault/ctx:reason/text())}</faultstring>
         <detail>
			{$body/soap-env:Fault/detail/*} { $fault/ctx:location}
         </detail>
</soap-env:Fault>]]></con1:xqueryText>
                        </con3:expr>
                    </con3:assign>
                    <con6:log xmlns:con6="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con5="http://www.bea.com/wli/sb/stages/alert/config" xmlns:con2="http://www.bea.com/wli/sb/stages/routing/config" xmlns:con3="http://www.bea.com/wli/sb/stages/config" xmlns:con7="http://www.bea.com/wli/sb/stages/logging/config" xmlns:aler="http://www.bea.com/wli/monitoring/alert" xmlns:con4="http://www.bea.com/wli/sb/stages/routing/config">
                        <con3:id>_ActionId-N3f57c7ff.N5c6fea04.0.1645fca4632.N7e47</con3:id>
                        <con6:logLevel>error</con6:logLevel>
                        <con6:expr>
                            <con3:xqueryText>&lt;root>
&lt;log>
{fn:concat(
data($msgId), '|$/', 
fn:current-dateTime(), '|$/', 
if($inbound/ctx:transport/ctx:request/tp:headers/tp:user-header[@name="X-Forwarded-For"])
then
($inbound/ctx:transport/ctx:request/tp:headers/tp:user-header[@name="X-Forwarded-For"]/@value)
else
($inbound/ctx:transport/ctx:request/http:client-address), '|$/', 
$inbound/@name,'|$/',
if($inbound/ctx:service/ctx:operation) 
then ($inbound/ctx:service/ctx:operation)
else (fn:concat($inbound/ctx:transport/ctx:request/http:http-method,' ',$inbound/ctx:transport/ctx:uri)), '|$/',
'id=',fn:replace($id,'\|\$\/',';'),
',basketId=',fn:replace($basketId,'\|\$\/',';'),
',defaultChannel=',fn:replace($defaultChannel,'\|\$\/',';')
)}
&lt;/log>
{$ErrorTrace}
&lt;/root></con3:xqueryText>
                        </con6:expr>
                        <con6:message>[Orange][CCU][1.1][PublicKey_PS][cancel][Request][ErrorTrace]</con6:message>
                    </con6:log>
                    <con5:alert xmlns:con2="http://www.bea.com/wli/sb/stages/routing/config" xmlns:con5="http://www.bea.com/wli/sb/stages/alert/config" xmlns:con1="http://www.bea.com/wli/sb/stages/config">
                        <con1:id>_ActionId-N3f57c7ff.N5c6fea04.0.1645fca4632.N7e46</con1:id>
                        <con5:destination ref="Common/Resources/Alerts/Echange_AD"/>
                        <con5:description>[Orange][CCU][1.1][PublicKey_PS][cancel][Request][ErrorTrace]</con5:description>
                        <con5:severity>critical</con5:severity>
                        <con5:payload>
                            <con1:xqueryText>$ErrorTrace</con1:xqueryText>
                        </con5:payload>
                    </con5:alert>
                    <con1:report xmlns:con4="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con3="http://www.bea.com/wli/sb/stages/routing/config" xmlns:con6="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con5="http://www.bea.com/wli/sb/typesystem/config" xmlns:con1="http://www.bea.com/wli/sb/stages/logging/config">
                        <con2:id>_ActionId-N3f57c7ff.N5c6fea04.0.1645fca4632.N7e45</con2:id>
                        <con1:expr>
                            <con2:xqueryText>&lt;ReportRequestError>
{$ErrorTrace}
&lt;/ReportRequestError></con2:xqueryText>
                        </con1:expr>
                        <con1:labels>
                            <con1:key>messageId</con1:key>
                            <con1:varName>msgId</con1:varName>
                            <con1:value>
                                <con2:xpathText>.</con2:xpathText>
                            </con1:value>
                        </con1:labels>
                        <con1:labels>
                            <con1:key>startDateTime</con1:key>
                            <con1:varName>currentDatetime</con1:varName>
                            <con1:value>
                                <con2:xpathText>.</con2:xpathText>
                            </con1:value>
                        </con1:labels>
                        <con1:labels>
                            <con1:key>ipXForwardedFor</con1:key>
                            <con1:varName>inbound</con1:varName>
                            <con1:value>
                                <con2:xpathText>if(./ctx:transport/ctx:request/tp:headers/tp:user-header[@name="X-Forwarded-For"])
then
(./ctx:transport/ctx:request/tp:headers/tp:user-header[@name="X-Forwarded-For"]/@value)
else
(./ctx:transport/ctx:request/http:client-address)</con2:xpathText>
                            </con1:value>
                        </con1:labels>
                        <con1:labels>
                            <con1:key>operationName</con1:key>
                            <con1:varName>inbound</con1:varName>
                            <con1:value>
                                <con2:xpathText>if(./ctx:service/ctx:operation) 
then (./ctx:service/ctx:operation)
else (./ctx:transport/ctx:request/http:http-method)</con2:xpathText>
                            </con1:value>
                        </con1:labels>
                        <con1:labels>
                            <con1:key>id</con1:key>
                            <con1:varName>id</con1:varName>
                            <con1:value>
                                <con2:xpathText>.</con2:xpathText>
                            </con1:value>
                        </con1:labels>
                        <con1:labels>
                            <con1:key>basketId</con1:key>
                            <con1:varName>basketId</con1:varName>
                            <con1:value>
                                <con2:xpathText>.</con2:xpathText>
                            </con1:value>
                        </con1:labels>
                        <con1:labels>
                            <con1:key>defaultChannel</con1:key>
                            <con1:varName>defaultChannel</con1:varName>
                            <con1:value>
                                <con2:xpathText>.</con2:xpathText>
                            </con1:value>
                        </con1:labels>
                    </con1:report>
                    <con3:replace varName="body" contents-only="true">
                        <con2:id>_ActionId-N3f57c7ff.N5c6fea04.0.1645fca4632.N7e44</con2:id>
                        <con3:location>
                            <con2:xpathText>.</con2:xpathText>
                        </con3:location>
                        <con3:expr>
                            <con2:xqueryText>'{
	"code": "12507",
        "message": "Request Problem",
	"infoURL": "",
	"description": ""
}'</con2:xqueryText>
                        </con3:expr>
                    </con3:replace>
                    <con3:transport-headers>
                        <con2:id>_ActionId-N3f57c7ff.N5c6fea04.0.1645fca4632.N7e43</con2:id>
                        <con3:header-set>inbound-response</con3:header-set>
                        <con3:header name="Content-Type" value="expression">
                            <con2:xqueryText>'application/json; charset=utf-8'</con2:xqueryText>
                        </con3:header>
                    </con3:transport-headers>
                    <con6:log xmlns:con6="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con5="http://www.bea.com/wli/sb/stages/alert/config" xmlns:con2="http://www.bea.com/wli/sb/stages/routing/config" xmlns:con3="http://www.bea.com/wli/sb/stages/config" xmlns:con7="http://www.bea.com/wli/sb/stages/logging/config" xmlns:aler="http://www.bea.com/wli/monitoring/alert" xmlns:con4="http://www.bea.com/wli/sb/stages/routing/config">
                        <con3:id>_ActionId-N3f57c7ff.N5c6fea04.0.1645fca4632.N7e42</con3:id>
                        <con6:logLevel>error</con6:logLevel>
                        <con6:expr>
                            <con3:xqueryText>&lt;root>
&lt;log>
{fn:concat(
data($msgId), '|$/', 
fn:current-dateTime(), '|$/', 
if($inbound/ctx:transport/ctx:request/tp:headers/tp:user-header[@name="X-Forwarded-For"])
then
($inbound/ctx:transport/ctx:request/tp:headers/tp:user-header[@name="X-Forwarded-For"]/@value)
else
($inbound/ctx:transport/ctx:request/http:client-address), '|$/', 
$inbound/@name,'|$/',
if($inbound/ctx:service/ctx:operation) 
then ($inbound/ctx:service/ctx:operation)
else (fn:concat($inbound/ctx:transport/ctx:request/http:http-method,' ',$inbound/ctx:transport/ctx:uri)), '|$/',
'id=',fn:replace($id,'\|\$\/',';'),
',basketId=',fn:replace($basketId,'\|\$\/',';'),
',defaultChannel=',fn:replace($defaultChannel,'\|\$\/',';')
)}
&lt;/log>
{$body}
&lt;/root></con3:xqueryText>
                        </con6:expr>
                        <con6:message>[Orange][CCU][1.1][PublicKey_PS][cancel][Request][Fault][Body after transformation]</con6:message>
                    </con6:log>
                    <con1:reply isError="true" xmlns:con2="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con1="http://www.bea.com/wli/sb/stages/config">
                        <con1:id>_ActionId-N3f57c7ff.N5c6fea04.0.1645fca4632.N7e41</con1:id>
                    </con1:reply>
                </con:actions>
            </con:stage>
        </con:pipeline>
        <con:pipeline type="request" name="request-N53efef3d.3f35d53b.0.16b88fa0ffb.N7eb5" errorHandler="error-N53efef3d.3f35d53b.0.16b88fa0ffb.N7ea8">
            <con:stage id="_StageId-N53efef3d.3f35d53b.0.16b88fa0ffb.N7eb4" name="RequÃªte_reservePublicKey">
                <con:context/>
                <con:actions>
                    <con3:assign varName="currentDatetime" xmlns:con4="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con6="http://www.bea.com/wli/sb/services/security/config" xmlns:con5="http://www.bea.com/wli/sb/typesystem/config" xmlns:ser="http://www.bea.com/wli/sb/services" xmlns:env="http://www.bea.com/wli/config/env" xmlns:http="http://www.bea.com/wli/sb/transports/http" xmlns:oper="http://xmlns.oracle.com/servicebus/pipeline/operations" xmlns:tran="http://www.bea.com/wli/sb/transports" xmlns:con1="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config">
                        <con2:id>_ActionId-N53efef3d.3f35d53b.0.16b88fa0ffb.N7eb3</con2:id>
                        <con3:expr>
                            <con2:xqueryText>&lt;a>{fn:current-dateTime()}&lt;/a></con2:xqueryText>
                        </con3:expr>
                    </con3:assign>
                    <con3:assign varName="msgId" xmlns:con4="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con6="http://www.bea.com/wli/sb/services/security/config" xmlns:con5="http://www.bea.com/wli/sb/typesystem/config" xmlns:ser="http://www.bea.com/wli/sb/services" xmlns:env="http://www.bea.com/wli/config/env" xmlns:http="http://www.bea.com/wli/sb/transports/http" xmlns:oper="http://xmlns.oracle.com/servicebus/pipeline/operations" xmlns:tran="http://www.bea.com/wli/sb/transports" xmlns:con1="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config">
                        <con2:id>_ActionId-N53efef3d.3f35d53b.0.16b88fa0ffb.N7eb2</con2:id>
                        <con3:expr>
                            <con2:xqueryText>&lt;a>{$messageID}&lt;/a></con2:xqueryText>
                        </con3:expr>
                    </con3:assign>
                    <con3:javaScript xmlns:con4="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con1="http://www.bea.com/wli/sb/stages/routing/config" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config">
                        <con2:id>_ActionId-N53efef3d.3f35d53b.0.16b88fa0ffb.N7eb1</con2:id>
                        <con3:script><![CDATA[var content = process.body;
if(content != 'undefined' && content != null && content){
	var id = content.id;
	var basket = content.basket;
	var defaultChannel = content.defaultChannel;
	if(id != 'undefined' && id != null && id)
		process.idJS = id;
	if(basket != 'undefined' && basket != null && basket){
		if(basket.length)
		basket = basket[0];
		var basketId = basket.id;
		if(basketId != 'undefined' && basketId != null && basketId){
			process.basketIdJS = basketId;
		}
	}
	if(defaultChannel != 'undefined' && defaultChannel != null && defaultChannel)
		process.defaultChannelJS = defaultChannel;
}]]></con3:script>
                    </con3:javaScript>
                    <con3:assign varName="id" xmlns:con1="http://www.bea.com/wli/sb/stages/routing/config" xmlns:con4="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config">
                        <con2:id>_ActionId-N53efef3d.3f35d53b.0.16b88fa0ffb.N7eb0</con2:id>
                        <con3:expr>
                            <con2:xqueryText>&lt;id>
{fn:replace($idJS,
';', 
'|\$/')}
&lt;/id></con2:xqueryText>
                        </con3:expr>
                    </con3:assign>
                    <con3:assign varName="basketId" xmlns:con1="http://www.bea.com/wli/sb/stages/routing/config" xmlns:con4="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config">
                        <con2:id>_ActionId-N53efef3d.3f35d53b.0.16b88fa0ffb.N7eaf</con2:id>
                        <con3:expr>
                            <con2:xqueryText>&lt;basketId>
{fn:replace($basketIdJS,
';', 
'|\$/')}
&lt;/basketId></con2:xqueryText>
                        </con3:expr>
                    </con3:assign>
                    <con3:assign varName="defaultChannel" xmlns:con1="http://www.bea.com/wli/sb/stages/routing/config" xmlns:con4="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config">
                        <con2:id>_ActionId-N53efef3d.3f35d53b.0.16b88fa0ffb.N7eae</con2:id>
                        <con3:expr>
                            <con2:xqueryText>&lt;defaultChannel>
{fn:replace($defaultChannelJS,
';', 
'|\$/')}
&lt;/defaultChannel></con2:xqueryText>
                        </con3:expr>
                    </con3:assign>
                    <con1:log xmlns:con4="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con3="http://www.bea.com/wli/sb/stages/routing/config" xmlns:con6="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con5="http://www.bea.com/wli/sb/typesystem/config" xmlns:ser="http://www.bea.com/wli/sb/services" xmlns:env="http://www.bea.com/wli/config/env" xmlns:http="http://www.bea.com/wli/sb/transports/http" xmlns:oper="http://xmlns.oracle.com/servicebus/pipeline/operations" xmlns:tran="http://www.bea.com/wli/sb/transports" xmlns:con1="http://www.bea.com/wli/sb/stages/logging/config">
                        <con2:id>_ActionId-N53efef3d.3f35d53b.0.16b88fa0ffb.N7ead</con2:id>
                        <con1:logLevel>info</con1:logLevel>
                        <con1:expr>
                            <con2:xqueryText>&lt;root>
&lt;log>
{fn:concat(
data($msgId), '|$/', 
data($currentDatetime), '|$/', 
if($inbound/ctx:transport/ctx:request/tp:headers/tp:user-header[@name="X-Forwarded-For"])
then
($inbound/ctx:transport/ctx:request/tp:headers/tp:user-header[@name="X-Forwarded-For"]/@value)
else
($inbound/ctx:transport/ctx:request/http:client-address), '|$/', 
$inbound/@name,'|$/',
if($inbound/ctx:service/ctx:operation) 
then ($inbound/ctx:service/ctx:operation)
else (fn:concat($inbound/ctx:transport/ctx:request/http:http-method,' ',$inbound/ctx:transport/ctx:uri)), '|$/',
'id=',fn:replace($id,'\|\$\/',';'),
',basketId=',fn:replace($basketId,'\|\$\/',';'),
',defaultChannel=',fn:replace($defaultChannel,'\|\$\/',';')
)}
&lt;/log>
{$body}
&lt;/root></con2:xqueryText>
                        </con1:expr>
                        <con1:message>[Orange][CCU][1.1][PublicKey_PS][reserve][Entry]</con1:message>
                    </con1:log>
                    <con1:report xmlns:con4="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con3="http://www.bea.com/wli/sb/stages/routing/config" xmlns:con6="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con5="http://www.bea.com/wli/sb/typesystem/config" xmlns:ser="http://www.bea.com/wli/sb/services" xmlns:env="http://www.bea.com/wli/config/env" xmlns:http="http://www.bea.com/wli/sb/transports/http" xmlns:oper="http://xmlns.oracle.com/servicebus/pipeline/operations" xmlns:tran="http://www.bea.com/wli/sb/transports" xmlns:con1="http://www.bea.com/wli/sb/stages/logging/config">
                        <con2:id>_ActionId-N53efef3d.3f35d53b.0.16b88fa0ffb.N7eac</con2:id>
                        <con1:expr>
                            <con2:xqueryText>&lt;ReportRequest>
{$body}
&lt;/ReportRequest></con2:xqueryText>
                        </con1:expr>
                        <con1:labels>
                            <con1:key>messageId</con1:key>
                            <con1:varName>msgId</con1:varName>
                            <con1:value>
                                <con2:xpathText>.</con2:xpathText>
                            </con1:value>
                        </con1:labels>
                        <con1:labels>
                            <con1:key>startDateTime</con1:key>
                            <con1:varName>currentDatetime</con1:varName>
                            <con1:value>
                                <con2:xpathText>.</con2:xpathText>
                            </con1:value>
                        </con1:labels>
                        <con1:labels>
                            <con1:key>ipXForwardedFor</con1:key>
                            <con1:varName>inbound</con1:varName>
                            <con1:value>
                                <con2:xpathText>if(./ctx:transport/ctx:request/tp:headers/tp:user-header[@name="X-Forwarded-For"])
then
(./ctx:transport/ctx:request/tp:headers/tp:user-header[@name="X-Forwarded-For"]/@value)
else
(./ctx:transport/ctx:request/http:client-address)</con2:xpathText>
                            </con1:value>
                        </con1:labels>
                        <con1:labels>
                            <con1:key>operationName</con1:key>
                            <con1:varName>inbound</con1:varName>
                            <con1:value>
                                <con2:xpathText>if(./ctx:service/ctx:operation) 
then (./ctx:service/ctx:operation)
else (./ctx:transport/ctx:request/http:http-method)</con2:xpathText>
                            </con1:value>
                        </con1:labels>
                        <con1:labels>
                            <con1:key>id</con1:key>
                            <con1:varName>id</con1:varName>
                            <con1:value>
                                <con2:xpathText>.</con2:xpathText>
                            </con1:value>
                        </con1:labels>
                        <con1:labels>
                            <con1:key>basketId</con1:key>
                            <con1:varName>basketId</con1:varName>
                            <con1:value>
                                <con2:xpathText>.</con2:xpathText>
                            </con1:value>
                        </con1:labels>
                        <con1:labels>
                            <con1:key>defaultChannel</con1:key>
                            <con1:varName>defaultChannel</con1:varName>
                            <con1:value>
                                <con2:xpathText>.</con2:xpathText>
                            </con1:value>
                        </con1:labels>
                    </con1:report>
                    <con1:nxsdTranslation>
                        <con2:id>_ActionId-N53efef3d.3f35d53b.0.16b88fa0ffb.N7d54</con2:id>
                        <con1:type>Native-To-XML</con1:type>
                        <con1:sourceExpr>
                            <con2:xqueryText>data($body)</con2:xqueryText>
                        </con1:sourceExpr>
                        <con1:nxsd ref="CCU/Resources/nXSDs/PublicKey/api_YAML"/>
                        <con1:schemaElement xmlns:rest="http://orange.com/OrangeMaroc_APIs/api/publicKey/v0/model/rest">rest:reserveConstraints</con1:schemaElement>
                        <con1:replace-body-content/>
                    </con1:nxsdTranslation>
                    <con3:log>
                        <con2:id>_ActionId-N53efef3d.3f35d53b.0.16b88fa0ffb.N7d4e</con2:id>
                        <con3:logLevel>info</con3:logLevel>
                        <con3:expr>
                            <con2:xqueryText>&lt;root>
&lt;log>
{fn:concat(
data($msgId), '|$/', 
fn:current-dateTime(), '|$/', 
if($inbound/ctx:transport/ctx:request/tp:headers/tp:user-header[@name="X-Forwarded-For"])
then
($inbound/ctx:transport/ctx:request/tp:headers/tp:user-header[@name="X-Forwarded-For"]/@value)
else
($inbound/ctx:transport/ctx:request/http:client-address), '|$/', 
$inbound/@name,'|$/',
if($inbound/ctx:service/ctx:operation) 
then ($inbound/ctx:service/ctx:operation)
else (fn:concat($inbound/ctx:transport/ctx:request/http:http-method,' ',$inbound/ctx:transport/ctx:uri)), '|$/',
'id=',fn:replace($id,'\|\$\/',';'),
',basketId=',fn:replace($basketId,'\|\$\/',';'),
',defaultChannel=',fn:replace($defaultChannel,'\|\$\/',';')
)}
&lt;/log>
{$body}
&lt;/root></con2:xqueryText>
                        </con3:expr>
                        <con3:message>[Orange][CCU][1.1][PublicKey_PS][reserve][Request][Body after translation]</con3:message>
                    </con3:log>
                    <con1:replace contents-only="true" varName="body">
                        <con2:id>_ActionId-N53efef3d.3f35d53b.0.16b88fa0ffb.N7d51</con2:id>
                        <con1:expr>
                            <con2:xqueryTransform>
                                <con2:resource ref="CCU/1.1/Resources/XQueries/PublicKey/PublicKeyReserve_TReq"/>
                                <con2:param name="req">
                                    <con2:path>$body/*</con2:path>
                                </con2:param>
                            </con2:xqueryTransform>
                        </con1:expr>
                    </con1:replace>
                    <con3:log>
                        <con2:id>_ActionId-N53efef3d.3f35d53b.0.16b88fa0ffb.N7eaa</con2:id>
                        <con3:logLevel>info</con3:logLevel>
                        <con3:expr>
                            <con2:xqueryText>&lt;root>
&lt;log>
{fn:concat(
data($msgId), '|$/', 
fn:current-dateTime(), '|$/', 
if($inbound/ctx:transport/ctx:request/tp:headers/tp:user-header[@name="X-Forwarded-For"])
then
($inbound/ctx:transport/ctx:request/tp:headers/tp:user-header[@name="X-Forwarded-For"]/@value)
else
($inbound/ctx:transport/ctx:request/http:client-address), '|$/', 
$inbound/@name,'|$/',
if($inbound/ctx:service/ctx:operation) 
then ($inbound/ctx:service/ctx:operation)
else (fn:concat($inbound/ctx:transport/ctx:request/http:http-method,' ',$inbound/ctx:transport/ctx:uri)), '|$/',
'id=',fn:replace($id,'\|\$\/',';'),
',basketId=',fn:replace($basketId,'\|\$\/',';'),
',defaultChannel=',fn:replace($defaultChannel,'\|\$\/',';')
)}
&lt;/log>
{$body}
&lt;/root></con2:xqueryText>
                        </con3:expr>
                        <con3:message>[Orange][CCU][1.1][PublicKey_PS][reserve][Request][Body after transformation]</con3:message>
                    </con3:log>
                </con:actions>
            </con:stage>
        </con:pipeline>
        <con:pipeline type="request" name="request-N3f57d476.56e11d53.0.15f964226c4.N7ef5" xmlns:con1="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config"/>
        <con:pipeline type="request" name="request-a80144d.N4531b017.0.161039720ae.N7e26" errorHandler="error-a80144d.N4531b017.0.161039720ae.N7e19">
            <con:stage id="_StageId-a80144d.N4531b017.0.161039720ae.N7e25" name="Stage1">
                <con:context/>
                <con:actions>
                    <con3:assign varName="currentDatetime" xmlns:con4="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con6="http://www.bea.com/wli/sb/services/security/config" xmlns:con5="http://www.bea.com/wli/sb/typesystem/config" xmlns:ser="http://www.bea.com/wli/sb/services" xmlns:env="http://www.bea.com/wli/config/env" xmlns:http="http://www.bea.com/wli/sb/transports/http" xmlns:oper="http://xmlns.oracle.com/servicebus/pipeline/operations" xmlns:tran="http://www.bea.com/wli/sb/transports" xmlns:con1="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config">
                        <con2:id>_ActionId-a80144d.N4531b017.0.161039720ae.N7e24</con2:id>
                        <con3:expr>
                            <con2:xqueryText>&lt;a>{fn:current-dateTime()}&lt;/a></con2:xqueryText>
                        </con3:expr>
                    </con3:assign>
                    <con3:assign varName="msgId" xmlns:con4="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con6="http://www.bea.com/wli/sb/services/security/config" xmlns:con5="http://www.bea.com/wli/sb/typesystem/config" xmlns:ser="http://www.bea.com/wli/sb/services" xmlns:env="http://www.bea.com/wli/config/env" xmlns:http="http://www.bea.com/wli/sb/transports/http" xmlns:oper="http://xmlns.oracle.com/servicebus/pipeline/operations" xmlns:tran="http://www.bea.com/wli/sb/transports" xmlns:con1="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config">
                        <con2:id>_ActionId-a80144d.N4531b017.0.161039720ae.N7e23</con2:id>
                        <con3:expr>
                            <con2:xqueryText>&lt;a>{$messageID}&lt;/a></con2:xqueryText>
                        </con3:expr>
                    </con3:assign>
                    <con3:assign varName="name" xmlns:con4="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con1="http://www.bea.com/wli/sb/stages/routing/config" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config">
                        <con2:id>_ActionId-a80144d.N4531b017.0.161039720ae.N7e1f</con2:id>
                        <con3:expr>
                            <con2:xqueryText>&lt;name>
{fn:replace($inbound/ctx:transport/ctx:request/http:query-parameters/http:parameter[@name="name"]/@value,
';', 
'|\$/')}
&lt;/name></con2:xqueryText>
                        </con3:expr>
                    </con3:assign>
                    <con3:assign varName="affix" xmlns:con4="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con1="http://www.bea.com/wli/sb/stages/routing/config" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config">
                        <con2:id>_ActionId-a801460.72dfd2fa.0.1624d5abd93.N7ffe</con2:id>
                        <con3:expr>
                            <con2:xqueryText>&lt;affix>
{fn:replace($inbound/ctx:transport/ctx:request/http:query-parameters/http:parameter[@name="affix"]/@value,
';', 
'|\$/')}
&lt;/affix></con2:xqueryText>
                        </con3:expr>
                    </con3:assign>
                    <con1:log xmlns:con4="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con3="http://www.bea.com/wli/sb/stages/routing/config" xmlns:con6="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con5="http://www.bea.com/wli/sb/typesystem/config" xmlns:ser="http://www.bea.com/wli/sb/services" xmlns:env="http://www.bea.com/wli/config/env" xmlns:http="http://www.bea.com/wli/sb/transports/http" xmlns:oper="http://xmlns.oracle.com/servicebus/pipeline/operations" xmlns:tran="http://www.bea.com/wli/sb/transports" xmlns:con1="http://www.bea.com/wli/sb/stages/logging/config">
                        <con2:id>_ActionId-a80144d.N4531b017.0.161039720ae.N7e1e</con2:id>
                        <con1:logLevel>info</con1:logLevel>
                        <con1:expr>
                            <con2:xqueryText>&lt;root>
&lt;log>
{fn:concat(
data($msgId), '|$/', 
data($currentDatetime), '|$/', 
if($inbound/ctx:transport/ctx:request/tp:headers/tp:user-header[@name="X-Forwarded-For"])
then
($inbound/ctx:transport/ctx:request/tp:headers/tp:user-header[@name="X-Forwarded-For"]/@value)
else
($inbound/ctx:transport/ctx:request/http:client-address), '|$/', 
$inbound/@name,'|$/',
if($inbound/ctx:service/ctx:operation) 
then ($inbound/ctx:service/ctx:operation)
else (fn:concat($inbound/ctx:transport/ctx:request/http:http-method,' ',$inbound/ctx:transport/ctx:uri)), '|$/',
'name=',fn:replace($name,'\|\$\/',';'),
',affix=',fn:replace($affix,'\|\$\/',';')
)}
&lt;/log>
{$inbound}
&lt;/root></con2:xqueryText>
                        </con1:expr>
                        <con1:message>[Orange][CCU][1.1][PublicKey_PS][publicKeyFind][Entry]</con1:message>
                    </con1:log>
                    <con1:report xmlns:con4="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con3="http://www.bea.com/wli/sb/stages/routing/config" xmlns:con6="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con5="http://www.bea.com/wli/sb/typesystem/config" xmlns:ser="http://www.bea.com/wli/sb/services" xmlns:env="http://www.bea.com/wli/config/env" xmlns:http="http://www.bea.com/wli/sb/transports/http" xmlns:oper="http://xmlns.oracle.com/servicebus/pipeline/operations" xmlns:tran="http://www.bea.com/wli/sb/transports" xmlns:con1="http://www.bea.com/wli/sb/stages/logging/config">
                        <con2:id>_ActionId-a80144d.N4531b017.0.161039720ae.N7e1d</con2:id>
                        <con1:expr>
                            <con2:xqueryText>&lt;ReportRequest>
{$body}
&lt;/ReportRequest></con2:xqueryText>
                        </con1:expr>
                        <con1:labels>
                            <con1:key>messageId</con1:key>
                            <con1:varName>msgId</con1:varName>
                            <con1:value>
                                <con2:xpathText>.</con2:xpathText>
                            </con1:value>
                        </con1:labels>
                        <con1:labels>
                            <con1:key>startDateTime</con1:key>
                            <con1:varName>currentDatetime</con1:varName>
                            <con1:value>
                                <con2:xpathText>.</con2:xpathText>
                            </con1:value>
                        </con1:labels>
                        <con1:labels>
                            <con1:key>ipXForwardedFor</con1:key>
                            <con1:varName>inbound</con1:varName>
                            <con1:value>
                                <con2:xpathText>if(./ctx:transport/ctx:request/tp:headers/tp:user-header[@name="X-Forwarded-For"])
then
(./ctx:transport/ctx:request/tp:headers/tp:user-header[@name="X-Forwarded-For"]/@value)
else
(./ctx:transport/ctx:request/http:client-address)</con2:xpathText>
                            </con1:value>
                        </con1:labels>
                        <con1:labels>
                            <con1:key>operationName</con1:key>
                            <con1:varName>inbound</con1:varName>
                            <con1:value>
                                <con2:xpathText>if(./ctx:service/ctx:operation) 
then (./ctx:service/ctx:operation)
else (./ctx:transport/ctx:request/http:http-method)</con2:xpathText>
                            </con1:value>
                        </con1:labels>
                        <con1:labels>
                            <con1:key>name</con1:key>
                            <con1:varName>name</con1:varName>
                            <con1:value>
                                <con2:xpathText>.</con2:xpathText>
                            </con1:value>
                        </con1:labels>
                        <con1:labels>
                            <con1:key>affix</con1:key>
                            <con1:varName>affix</con1:varName>
                            <con1:value>
                                <con2:xpathText>.</con2:xpathText>
                            </con1:value>
                        </con1:labels>
                    </con1:report>
                    <con5:replace contents-only="true" varName="body" xmlns:con5="http://www.bea.com/wli/sb/stages/transform/config">
                        <con2:id>_ActionId-a801448.N481a1717.0.1610e0cb222.N7ffe</con2:id>
                        <con5:location>
                            <con2:xpathText>.</con2:xpathText>
                        </con5:location>
                        <con1:expr>
                            <con:xqueryTransform xmlns:con="http://www.bea.com/wli/sb/stages/config">
                                <con:resource ref="CCU/Resources/XQueries/PublicKey/PublicKeyFind_TReq"/>
                                <con:param name="lifecycleState">
                                    <con:path>$inbound/ctx:transport/ctx:request/http:query-parameters/http:parameter[@name="lifecycleState"]/@value</con:path>
                                </con:param>
                                <con:param name="affix">
                                    <con:path>$inbound/ctx:transport/ctx:request/http:query-parameters/http:parameter[@name="affix"]/@value</con:path>
                                </con:param>
                                <con:param name="limit">
                                    <con:path>$inbound/ctx:transport/ctx:request/http:query-parameters/http:parameter[@name="limit"]/@value</con:path>
                                </con:param>
                                <con:param name="name">
                                    <con:path>$inbound/ctx:transport/ctx:request/http:query-parameters/http:parameter[@name="name"]/@value</con:path>
                                </con:param>
                                <con:param name="publicKeyPool.name">
                                    <con:path>$inbound/ctx:transport/ctx:request/http:query-parameters/http:parameter[@name="PublicKeyPool.name"]/@value</con:path>
                                </con:param>
                                <con:param name="category">
                                    <con:path>$inbound/ctx:transport/ctx:request/http:query-parameters/http:parameter[@name="category"]/@value</con:path>
                                </con:param>
                            </con:xqueryTransform>
                        </con1:expr>
                    </con5:replace>
                    <con3:log>
                        <con2:id>_ActionId-a80144d.N4531b017.0.161039720ae.N7e1a</con2:id>
                        <con3:logLevel>info</con3:logLevel>
                        <con3:expr>
                            <con2:xqueryText>&lt;root>
&lt;log>
{fn:concat(
data($msgId), '|$/', 
fn:current-dateTime(), '|$/', 
if($inbound/ctx:transport/ctx:request/tp:headers/tp:user-header[@name="X-Forwarded-For"])
then
($inbound/ctx:transport/ctx:request/tp:headers/tp:user-header[@name="X-Forwarded-For"]/@value)
else
($inbound/ctx:transport/ctx:request/http:client-address), '|$/', 
$inbound/@name,'|$/',
if($inbound/ctx:service/ctx:operation) 
then ($inbound/ctx:service/ctx:operation)
else (fn:concat($inbound/ctx:transport/ctx:request/http:http-method,' ',$inbound/ctx:transport/ctx:uri)), '|$/',
'name=',fn:replace($name,'\|\$\/',';'),
',affix=',fn:replace($affix,'\|\$\/',';')
)}
&lt;/log>
{$body}
&lt;/root></con2:xqueryText>
                        </con3:expr>
                        <con3:message>[Orange][CCU][1.1][PublicKey_PS][publicKeyFind][Request][Body after transformation]</con3:message>
                    </con3:log>
                    <con3:log>
                        <con2:id>_ActionId-N3f57c7ff.N5c6fea04.0.1645fca4632.N7ffe</con2:id>
                        <con3:logLevel>info</con3:logLevel>
                        <con3:expr>
                            <con2:xqueryText>&lt;root>
&lt;log>
{fn:concat(
data($msgId), '|$/', 
fn:current-dateTime(), '|$/', 
if($inbound/ctx:transport/ctx:request/tp:headers/tp:user-header[@name="X-Forwarded-For"])
then
($inbound/ctx:transport/ctx:request/tp:headers/tp:user-header[@name="X-Forwarded-For"]/@value)
else
($inbound/ctx:transport/ctx:request/http:client-address), '|$/', 
$inbound/@name,'|$/',
if($inbound/ctx:service/ctx:operation) 
then ($inbound/ctx:service/ctx:operation)
else (fn:concat($inbound/ctx:transport/ctx:request/http:http-method,' ',$inbound/ctx:transport/ctx:uri)), '|$/',
'name=',fn:replace($name,'\|\$\/',';'),
',affix=',fn:replace($affix,'\|\$\/',';')
)}
&lt;/log>
&lt;/root></con2:xqueryText>
                        </con3:expr>
                        <con3:message>[Orange][CCU][1.1][PublicKey_PS][publicKeyFind][Request][Last]</con3:message>
                    </con3:log>
                </con:actions>
            </con:stage>
        </con:pipeline>
        <con:pipeline type="response" name="response-N3f57d476.56e11d53.0.15f964226c4.N7ef4" xmlns:con1="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config">
            <con:stage name="Default_PublicKey" id="_StageId-N3f57d476.56e11d53.0.15f964226c4.N7ef3" xmlns:ser="http://www.bea.com/wli/sb/services" xmlns:con1="http://www.bea.com/wli/sb/stages/routing/config" xmlns:http="http://www.bea.com/wli/sb/transports/http" xmlns:oper="http://xmlns.oracle.com/servicebus/pipeline/operations" xmlns:env="http://www.bea.com/wli/config/env" xmlns:con4="http://www.bea.com/wli/sb/stages/logging/config" xmlns:tran="http://www.bea.com/wli/sb/transports">
                <con:context/>
                <con:actions>
                    <con3:replace contents-only="true" varName="body">
                        <con2:id>_ActionId-N3f57d476.56e11d53.0.15f964226c4.N7ef2</con2:id>
                        <con3:location>
                            <con2:xpathText>.</con2:xpathText>
                        </con3:location>
                        <con3:expr>
                            <con2:xqueryText>'{
	"code": "12509",
        "message": "Default operation",
	"infoURL": "/CCU/SimCard",
	"description": "Invalid http verb"
}'</con2:xqueryText>
                        </con3:expr>
                    </con3:replace>
                    <con6:log xmlns:con1="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con4="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con3="http://www.bea.com/wli/sb/stages/routing/config" xmlns:con6="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con5="http://www.bea.com/wli/sb/typesystem/config">
                        <con2:id>_ActionId-N3f57d476.56e11d53.0.15f964226c4.N7ef1</con2:id>
                        <con1:logLevel>info</con1:logLevel>
                        <con1:expr>
                            <con2:xqueryText>&lt;root>
&lt;log>
{fn:concat(
data($msgId), '|$/', 
fn:current-dateTime(), '|$/', 
if($inbound/ctx:transport/ctx:request/tp:headers/tp:user-header[@name="X-Forwarded-For"])
then
($inbound/ctx:transport/ctx:request/tp:headers/tp:user-header[@name="X-Forwarded-For"]/@value)
else
($inbound/ctx:transport/ctx:request/http:client-address), '|$/', 
$inbound/@name,'|$/',
if($inbound/ctx:service/ctx:operation) 
then ($inbound/ctx:service/ctx:operation)
else (fn:concat($inbound/ctx:transport/ctx:request/http:http-method,' ',$inbound/ctx:transport/ctx:uri))
)}
&lt;/log>
{$body}
&lt;/root></con2:xqueryText>
                        </con1:expr>
                        <con1:message>[Orange][CCU][1.1][PublicKey_PS][DefaultBranch]</con1:message>
                    </con6:log>
                    <con3:transport-headers>
                        <con2:id>_ActionId-N3f57d476.56e11d53.0.15f964226c4.N7ef0</con2:id>
                        <con3:header-set>inbound-response</con3:header-set>
                        <con3:header name="Content-Type" value="expression">
                            <con2:xqueryText>'application/json; charset=utf-8'</con2:xqueryText>
                        </con3:header>
                    </con3:transport-headers>
                    <con2:reply isError="true">
                        <con2:id>_ActionId-N3f57d476.56e11d53.0.15f964226c4.N7eef</con2:id>
                    </con2:reply>
                </con:actions>
            </con:stage>
        </con:pipeline>
        <con:flow>
            <con:branch-node type="rest" id="_FlowId-N3f57d476.56e11d53.0.15f964226c4.N7fcf" name="RestBranch">
                <con:context/>
                <con:branch-table>
                    <con:branch name="findPublicKey">
                        <con:operator>equals</con:operator>
                        <con:rest-values>
                            <con:path>publicKey</con:path>
                            <con:verb>GET</con:verb>
                        </con:rest-values>
                        <con:flow>
                            <con:pipeline-node name="PipelinePair_findPublicKey ">
                                <con:request>request-a80144d.N4531b017.0.161039720ae.N7e26</con:request>
                                <con:response>response-a80144d.N4531b017.0.161039720ae.N7e0d</con:response>
                            </con:pipeline-node>
                            <con:route-node name="RouteNode_findPublicKey" error-handler="error-N3f57d476.5236328e.0.15fa1055b7f.N7ac7">
                                <con:context/>
                                <con:actions>
                                    <con4:route>
                                        <con2:id>_ActionId-N3f57d476.5236328e.0.15fa1055b7f.N7c57</con2:id>
                                        <con4:service ref="Common/Business/CCU/PublicKey/PublicKeyFind_SIRIO_BS" xsi:type="ref:BusinessServiceRef" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                                        <con4:outboundTransform/>
                                        <con4:responseTransform/>
                                    </con4:route>
                                </con:actions>
                            </con:route-node>
                        </con:flow>
                    </con:branch>
                    <con:branch name="cancelPublicKey">
                        <con:operator>equals</con:operator>
                        <con:rest-values>
                            <con:mediaType>application/json</con:mediaType>
                            <con:path>publicKey/cancel</con:path>
                            <con:verb>POST</con:verb>
                        </con:rest-values>
                        <con:flow>
                            <con:pipeline-node name="PipelinePair_cancelPublicKey">
                                <con:request>request-N3f57c7ff.N5c6fea04.0.1645fca4632.N7e57</con:request>
                                <con:response>response-N3f57c7ff.N5c6fea04.0.1645fca4632.N7e40</con:response>
                            </con:pipeline-node>
                            <con:route-node name="RouteNode_cancelPublicKey" error-handler="error-N3f57c7ff.N5c6fea04.0.1645fca4632.N7ce2">
                                <con:context/>
                                <con:actions>
                                    <con4:route>
                                        <con2:id>_ActionId-N3f57c7ff.N5c6fea04.0.1645fca4632.N7ce3</con2:id>
                                        <con4:service ref="Common/Business/CCU/1.1/PublicKey/PublicKeyCancel_BS" xsi:type="ref:BusinessServiceRef" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                                        <con4:outboundTransform/>
                                        <con4:responseTransform/>
                                    </con4:route>
                                </con:actions>
                            </con:route-node>
                        </con:flow>
                    </con:branch>
                    <con:branch name="reservePublicKey">
                        <con:operator>equals</con:operator>
                        <con:rest-values>
                            <con:mediaType>application/json</con:mediaType>
                            <con:path>publicKey/reserve</con:path>
                            <con:verb>POST</con:verb>
                        </con:rest-values>
                        <con:flow>
                            <con:pipeline-node name="Pipeline Pair Node1">
                                <con:request>request-N53efef3d.3f35d53b.0.16b88fa0ffb.N7eb5</con:request>
                                <con:response>response-N53efef3d.3f35d53b.0.16b88fa0ffb.N7e9c</con:response>
                            </con:pipeline-node>
                            <con:route-node name="RouteNode1" error-handler="error-N53efef3d.3f35d53b.0.16b88fa0ffb.N7e14">
                                <con:context/>
                                <con:actions>
                                    <con4:route>
                                        <con2:id>_ActionId-N53efef3d.3f35d53b.0.16b88fa0ffb.N7e77</con2:id>
                                        <con4:service ref="Common/Business/CCU/1.1/PublicKey/PublicKeyReserve_BS" xsi:type="ref:BusinessServiceRef" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                                        <con4:outboundTransform/>
                                        <con4:responseTransform/>
                                    </con4:route>
                                </con:actions>
                            </con:route-node>
                        </con:flow>
                    </con:branch>
                    <con:default-branch>
                        <con:flow>
                            <con:pipeline-node name="PipelinePair_Default_PublicKey" xmlns:con1="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config">
                                <con:request>request-N3f57d476.56e11d53.0.15f964226c4.N7ef5</con:request>
                                <con:response>response-N3f57d476.56e11d53.0.15f964226c4.N7ef4</con:response>
                            </con:pipeline-node>
                        </con:flow>
                    </con:default-branch>
                </con:branch-table>
            </con:branch-node>
        </con:flow>
    </con:router>
    <aler:alertRules xsi:nil="true" xmlns:aler="http://xmlns.oracle.com/servicebus/monitoring/alert"/>
</con:pipelineEntry>